<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="TaskFlow">
    <meta name="theme-color" content="#3B82F6">
    
    <!-- Permissions Policyå¯¾å¿œ -->
    <!-- browsing-topicsã¯æ¨™æº–åŒ–ã•ã‚Œã¦ã„ãªã„ãŸã‚å‰Šé™¤ -->
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.svg" type="image/svg+xml">
    
    <!-- PWAç”¨ã®ã‚¢ã‚¤ã‚³ãƒ³ -->
    <link rel="apple-touch-icon" href="icon-192.svg">
    <link rel="apple-touch-icon" sizes="120x120" href="icon-192.svg">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-192.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-192.svg">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.svg">
    <meta name="msapplication-TileImage" content="icon-512.svg">
    <meta name="msapplication-TileColor" content="#3B82F6">
    <link rel="manifest" href="manifest.json">
    
    <title>TaskFlow Pro - å®Œå…¨ç‰ˆ</title>
    
    <!-- ã‚³ãƒ³ã‚½ãƒ¼ãƒ«è­¦å‘Šãƒ»ã‚¨ãƒ©ãƒ¼ã®å®Œå…¨æŠ‘åˆ¶ï¼ˆTailwind CSSèª­ã¿è¾¼ã¿å‰ã«å®Ÿè¡Œï¼‰ -->
    <script>
        (function() {
            if (typeof console !== 'undefined') {
                const originalWarn = console.warn;
                const originalError = console.error;
                const originalLog = console.log;
                
                // ä¸è¦ãªè­¦å‘Šã®å®Œå…¨æŠ‘åˆ¶
                const suppressedMessages = [
                    'cdn.tailwindcss.com should not be used in production',
                    'tailwindcss',
                    'production',
                    'Cross-Origin-Opener-Policy',
                    'window.opener',
                    'Uncaught (in promise)',
                    'workbox-',
                    'Found 2 elements with non-unique id',
                    'non-unique id',
                    'manifest.json',
                    'Failed to load resource',
                    'the server responded with a status of 401'
                ];
                
                console.warn = function(...args) {
                    const message = args.join(' ');
                    if (suppressedMessages.some(msg => message.includes(msg))) {
                        return; // å®Œå…¨ã«æŠ‘åˆ¶
                    }
                    originalWarn.apply(console, args);
                };
                
                console.error = function(...args) {
                    const message = args.join(' ');
                    if (suppressedMessages.some(msg => message.includes(msg))) {
                        return; // å®Œå…¨ã«æŠ‘åˆ¶
                    }
                    originalError.apply(console, args);
                };
                
                // Promiseã‚¨ãƒ©ãƒ¼ã‚‚æŠ‘åˆ¶
                window.addEventListener('unhandledrejection', function(event) {
                    const message = event.reason ? event.reason.toString() : '';
                    if (suppressedMessages.some(msg => message.includes(msg))) {
                        event.preventDefault(); // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’é˜²ã
                    }
                });
                
                // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®æŠ‘åˆ¶ï¼ˆmanifest.jsonç­‰ï¼‰
                window.addEventListener('error', function(event) {
                    const message = event.message || '';
                    const filename = event.filename || '';
                    if (filename.includes('manifest.json') || 
                        message.includes('401') || 
                        message.includes('Failed to load resource')) {
                        event.preventDefault(); // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’é˜²ã
                    }
                });
            }
        })();
    </script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS CDNã®èª­ã¿è¾¼ã¿ç¢ºèªã¨è¨­å®š
        (function() {
            function configureTailwind() {
                if (typeof tailwind !== 'undefined' && tailwind.config) {
                    try {
                        tailwind.config = {
                            corePlugins: {
                                preflight: false
                            },
                            content: ["./index.html"],
                            theme: {
                                extend: {
                                    fontFamily: {
                                        'sans': ['Inter', 'system-ui', 'sans-serif']
                                    }
                                }
                            }
                        };
                        console.log('Tailwind CSS loaded and configured successfully');
                    } catch (error) {
                        console.error('Tailwind CSS configuration error:', error);
                    }
                } else {
                    // tailwindã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã¾ã åˆ©ç”¨å¯èƒ½ã§ãªã„å ´åˆã€å°‘ã—å¾…ã£ã¦å†è©¦è¡Œ
                    setTimeout(configureTailwind, 50);
                }
            }
            
            // DOMContentLoadedã¾ãŸã¯tailwindã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚‹ã¾ã§å¾…æ©Ÿ
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    // è¨­å®šã‚’è©¦è¡Œï¼ˆæœ€å¤§10å›ã€500msã¾ã§å¾…æ©Ÿï¼‰
                    let attempts = 0;
                    const maxAttempts = 10;
                    const checkInterval = setInterval(function() {
                        attempts++;
                        if (typeof tailwind !== 'undefined' && tailwind.config) {
                            clearInterval(checkInterval);
                            configureTailwind();
                        } else if (attempts >= maxAttempts) {
                            clearInterval(checkInterval);
                            console.warn('Tailwind CSS object not available after loading');
                        }
                    }, 50);
                });
            } else {
                // æ—¢ã«DOMãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆ
                let attempts = 0;
                const maxAttempts = 10;
                const checkInterval = setInterval(function() {
                    attempts++;
                    if (typeof tailwind !== 'undefined' && tailwind.config) {
                        clearInterval(checkInterval);
                        configureTailwind();
                    } else if (attempts >= maxAttempts) {
                        clearInterval(checkInterval);
                        console.warn('Tailwind CSS object not available after loading');
                    }
                }, 50);
            }
        })();
    </script>
    
    <!-- Chart.js -->
    <script>
        // Chart.js CDNã®èª­ã¿è¾¼ã¿ç¢ºèª
        (function() {
            const chartScript = document.createElement('script');
            chartScript.src = 'https://cdn.jsdelivr.net/npm/chart.js';
            
            chartScript.onload = function() {
                if (typeof Chart !== 'undefined') {
                    console.log('Chart.js loaded successfully');
                }
            };
            
            chartScript.onerror = function() {
                console.error('Failed to load Chart.js from CDN');
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: åˆ¥ã®CDNã‚’è©¦ã™
                const fallbackScript = document.createElement('script');
                fallbackScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js';
                fallbackScript.onload = function() {
                    console.log('Chart.js loaded from fallback CDN');
                };
                fallbackScript.onerror = function() {
                    console.error('Failed to load Chart.js from fallback CDN');
                };
                document.head.appendChild(fallbackScript);
            };
            
            document.head.appendChild(chartScript);
        })();
    </script>
    
    <!-- Font Awesome -->
    <script>
        // Font Awesome CDNã®èª­ã¿è¾¼ã¿ç¢ºèª
        (function() {
            const fontAwesomeLink = document.createElement('link');
            fontAwesomeLink.rel = 'stylesheet';
            fontAwesomeLink.href = 'https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css';
            
            fontAwesomeLink.onload = function() {
                console.log('Font Awesome loaded successfully');
            };
            
            fontAwesomeLink.onerror = function() {
                console.error('Failed to load Font Awesome from CDN');
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: åˆ¥ã®CDNã‚’è©¦ã™
                const fallbackLink = document.createElement('link');
                fallbackLink.rel = 'stylesheet';
                fallbackLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
                fallbackLink.onload = function() {
                    console.log('Font Awesome loaded from fallback CDN');
                };
                fallbackLink.onerror = function() {
                    console.error('Failed to load Font Awesome from fallback CDN');
                };
                document.head.appendChild(fallbackLink);
            };
            
            document.head.appendChild(fontAwesomeLink);
        })();
    </script>
    
    <!-- Google Fonts -->
    <script>
        // Google Fonts CDNã®èª­ã¿è¾¼ã¿ç¢ºèª
        (function() {
            const googleFontsLink = document.createElement('link');
            googleFontsLink.rel = 'stylesheet';
            googleFontsLink.href = 'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap';
            
            googleFontsLink.onload = function() {
                console.log('Google Fonts loaded successfully');
            };
            
            googleFontsLink.onerror = function() {
                console.error('Failed to load Google Fonts from CDN');
            };
            
            document.head.appendChild(googleFontsLink);
        })();
    </script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, getDocs, onSnapshot, collection, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult, signOut } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        window.FirebaseSDK = { initializeApp, getFirestore, doc, setDoc, getDoc, getDocs, onSnapshot, collection, query, orderBy, limit, getAuth, signInAnonymously, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult, signOut };
    </script>
    
    <!-- Google Calendar API -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* ãƒœã‚¿ãƒ³ã¨ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªè¦ç´ ã®ã¿é¸æŠã‚’ç„¡åŠ¹åŒ– */
        button, .tab-button, .custom-checkbox, .ios-tap {
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ã¯é¸æŠå¯èƒ½ã« */
        p, span, h1, h2, h3, h4, h5, h6, .selectable {
            -webkit-user-select: text;
            -moz-user-select: text;
            user-select: text;
        }
        
        /* iOSé¢¨ã®ãƒœã‚¿ãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .ios-tap {
            transition: all 0.1s ease;
        }
        
        .ios-tap:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
        
        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ï¼ˆiOSé¢¨ï¼‰ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 2px;
        }
        
        /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ãƒ‘ãƒ«ã‚¹åŠ¹æœ */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        
        .pulse-effect {
            animation: pulse 2s infinite;
        }
        
        /* æ—¥ä»˜å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 0.6;
        }
        
        /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        .custom-checkbox {
            appearance: none;
            width: 24px;
            height: 24px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 6px;
        }
        
        .custom-checkbox:checked {
            background: #3B82F6;
            border-color: #3B82F6;
        }
        
        .custom-checkbox:checked::after {
            content: 'âœ“';
            color: white;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        
        /* ã‚¿ãƒ–ã‚¹ã‚¿ã‚¤ãƒ« */
        .tab-button.active {
            border-bottom-color: #3B82F6 !important;
            color: #3B82F6 !important;
        }
        
        /* æ™‚é–“è¨ˆæ¸¬ãƒœã‚¿ãƒ³ */
        .timer-btn {
            transition: all 0.2s ease;
        }
        
        .timer-btn.running {
            background: #EF4444;
            color: white;
            animation: pulse-red 2s infinite;
        }
        
        .timer-btn.running:hover {
            background: #DC2626;
        }
        
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* Toggle Switch ã‚¹ã‚¿ã‚¤ãƒ« */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹æœ¬ä½“ã‚’å®Œå…¨ã«éè¡¨ç¤ºã«ã™ã‚‹ï¼ˆã‚¹ãƒãƒ›è¡¨ç¤ºã®è£å´è¡¨ç¤ºå•é¡Œã‚’ä¿®æ­£ï¼‰ */
        .toggle-switch input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #d1d5db;
            -webkit-transition: .3s;
            transition: .3s;
            border-radius: 20px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            -webkit-transition: .3s;
            transition: .3s;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        input:checked + .toggle-switch .toggle-slider {
            background-color: #3b82f6;
        }

        input:focus + .toggle-switch .toggle-slider {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        input:checked + .toggle-switch .toggle-slider:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }

        /* ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .toggle-switch:hover .toggle-slider {
            background-color: #9ca3af;
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«ç«¯æœ«ã§ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹è¡¨ç¤ºå•é¡Œã‚’é˜²ãè¿½åŠ è¨­å®š */
        @media screen and (max-width: 768px) {
            .toggle-switch input[type="checkbox"] {
                position: absolute !important;
                opacity: 0 !important;
                width: 0 !important;
                height: 0 !important;
                visibility: hidden !important;
                pointer-events: none !important;
                z-index: -1 !important;
                overflow: hidden !important;
                clip: rect(0, 0, 0, 0) !important;
                -webkit-clip-path: inset(50%) !important;
                clip-path: inset(50%) !important;
            }
            
            .toggle-switch {
                overflow: hidden !important;
            }
        }

        /* ã‚µãƒ–ã‚¿ã‚¹ã‚¯å…¥åŠ›é …ç›®ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æœ€é©åŒ– - 1è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        #subtasks-container > div {
            display: flex !important;
            flex-wrap: nowrap !important;
            align-items: center !important;
            gap: 6px !important;
            margin-bottom: 8px !important;
            width: calc(100% - 0px) !important;
            max-width: calc(100% - 0px) !important;
            padding: 5px !important;
            border: 1px solid #e5e7eb !important;
            border-radius: 6px !important;
            background-color: #fafafa !important;
            transition: background-color 0.2s ease !important;
            box-sizing: border-box !important;
            overflow: hidden !important;
        }

        #subtasks-container > div:hover {
            background-color: #f0f9ff !important;
            border-color: #bfdbfe !important;
        }

        /* ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚³ãƒ³ãƒ†ãƒŠå…¨ä½“ã®åˆ¶ç´„ */
        #subtasks-container {
            width: 100% !important;
            max-width: 100% !important;
            overflow: hidden !important;
            box-sizing: border-box !important;
        }

        /* ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã®å„å…¥åŠ›è¦ç´  - ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ä¸Šæ›¸ã */
        #subtasks-container input[type="checkbox"] {
            flex: 0 0 16px !important;
            width: 16px !important;
            max-width: 16px !important;
            min-width: 16px !important;
            height: 16px !important;
            margin: 0 !important;
        }

        #subtasks-container input[type="text"] {
            flex: 1 1 auto !important;
            min-width: 80px !important;
            width: 0 !important;
            max-width: none !important;
            padding: 4px 6px !important;
            font-size: 14px !important;
        }

        #subtasks-container input[type="date"] {
            flex: 0 0 110px !important;
            min-width: 110px !important;
            max-width: 110px !important;
            width: 110px !important;
            padding: 4px 4px !important;
            font-size: 13px !important;
        }

        #subtasks-container button.remove-subtask {
            flex: 0 0 28px !important;
            width: 28px !important;
            max-width: 28px !important;
            min-width: 28px !important;
            height: 28px !important;
            padding: 4px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 4px !important;
        }

        /* ã‚¹ãƒãƒ›è¡¨ç¤ºã§ã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯é …ç›®æœ€é©åŒ– - 1è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        @media screen and (max-width: 640px) {
            #subtasks-container > div {
                flex-wrap: nowrap !important;
                gap: 3px !important;
                padding: 4px !important;
                border: 1px solid #e5e7eb !important;
                border-radius: 4px !important;
                margin-bottom: 6px !important;
                background-color: #f9fafb !important;
                min-height: 32px !important;
                align-items: center !important;
                width: calc(100% - 0px) !important;
                max-width: calc(100% - 0px) !important;
                box-sizing: border-box !important;
                overflow: hidden !important;
            }
            
            #subtasks-container input[type="checkbox"] {
                flex: 0 0 14px !important;
                width: 14px !important;
                max-width: 14px !important;
                min-width: 14px !important;
                height: 14px !important;
                margin: 0 !important;
            }
            
            #subtasks-container input[type="text"] {
                flex: 1 1 auto !important;
                min-width: 60px !important;
                width: 0 !important;
                max-width: none !important;
                font-size: 13px !important;
                padding: 3px 4px !important;
            }
            
            #subtasks-container input[type="date"] {
                flex: 0 0 90px !important;
                min-width: 90px !important;
                max-width: 90px !important;
                width: 90px !important;
                font-size: 11px !important;
                padding: 3px 2px !important;
            }
            
            #subtasks-container button.remove-subtask {
                flex: 0 0 24px !important;
                width: 24px !important;
                max-width: 24px !important;
                min-width: 24px !important;
                height: 24px !important;
                padding: 2px !important;
                margin: 0 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            #subtasks-container button.remove-subtask i {
                font-size: 10px !important;
            }

            /* ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã®2åˆ—ã‚°ãƒªãƒƒãƒ‰èª¿æ•´ */
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 {
                grid-template-columns: 1fr !important;
                gap: 6px !important;
            }

            /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®æ–‡å­—ã‚µã‚¤ã‚ºèª¿æ•´ */
            #task-modal select {
                font-size: 14px !important;
                padding: 6px 8px !important;
                min-height: 36px !important;
            }
        }

        /* æ¥µå°ç”»é¢ï¼ˆ375pxä»¥ä¸‹ï¼‰ã§ã®æœ€é©åŒ– - ã‚ˆã‚Šå¯†ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        @media screen and (max-width: 375px) {
            #subtasks-container > div {
                gap: 2px !important;
                padding: 3px !important;
                width: calc(100% - 0px) !important;
                max-width: calc(100% - 0px) !important;
                min-height: 30px !important;
            }
            
            #subtasks-container input[type="checkbox"] {
                flex: 0 0 12px !important;
                width: 12px !important;
                max-width: 12px !important;
                min-width: 12px !important;
                height: 12px !important;
            }
            
            #subtasks-container input[type="text"] {
                flex: 1 1 auto !important;
                min-width: 50px !important;
                width: 0 !important;
                max-width: none !important;
                font-size: 12px !important;
                padding: 2px 3px !important;
            }
            
            #subtasks-container input[type="date"] {
                flex: 0 0 80px !important;
                min-width: 80px !important;
                max-width: 80px !important;
                width: 80px !important;
                font-size: 10px !important;
                padding: 2px 1px !important;
            }
            
            #subtasks-container button.remove-subtask {
                flex: 0 0 20px !important;
                width: 20px !important;
                max-width: 20px !important;
                min-width: 20px !important;
                height: 20px !important;
                padding: 1px !important;
            }

            #subtasks-container button.remove-subtask i {
                font-size: 8px !important;
            }

            /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®æ›´ãªã‚‹èª¿æ•´ */
            #task-modal select {
                font-size: 13px !important;
                padding: 5px 6px !important;
                min-height: 32px !important;
            }

            #task-modal select option {
                font-size: 12px !important;
            }
        }

        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã§ã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯é …ç›®æœ€é©åŒ– - 1è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        @media screen and (min-width: 641px) and (max-width: 1024px) {
            #subtasks-container > div {
                gap: 5px !important;
                padding: 5px !important;
                width: calc(100% - 0px) !important;
                max-width: calc(100% - 0px) !important;
            }
            
            #subtasks-container input[type="checkbox"] {
                flex: 0 0 15px !important;
                width: 15px !important;
                max-width: 15px !important;
                min-width: 15px !important;
                height: 15px !important;
            }
            
            #subtasks-container input[type="text"] {
                flex: 1 1 auto !important;
                min-width: 100px !important;
                width: 0 !important;
                max-width: none !important;
                font-size: 14px !important;
            }
            
            #subtasks-container input[type="date"] {
                flex: 0 0 100px !important;
                min-width: 100px !important;
                max-width: 100px !important;
                width: 100px !important;
                font-size: 13px !important;
            }
            
            #subtasks-container button.remove-subtask {
                flex: 0 0 26px !important;
                width: 26px !important;
                max-width: 26px !important;
                min-width: 26px !important;
                height: 26px !important;
            }

            /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¡¨ç¤ºæœ€é©åŒ– */
            #task-modal select {
                font-size: 14px !important;
                min-height: 38px !important;
                padding: 6px 10px !important;
            }
        }

        input:checked + .toggle-switch:hover .toggle-slider {
            background-color: #2563eb;
        }
        
        /* ç„¡åŠ¹çŠ¶æ…‹ã®ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ */
        .toggle-switch.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .toggle-switch.disabled .toggle-slider {
            background-color: #e5e7eb !important;
        }
        
        .toggle-switch.disabled .toggle-slider:before {
            background-color: #f3f4f6 !important;
        }
        
        /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã‚¹ã‚¿ã‚¤ãƒ« */
        .gantt-container {
            position: relative;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            height: 600px;
            min-height: 400px;
            overflow: hidden;
            z-index: 1;
        }

        .gantt-wrapper {
            display: flex;
            height: 100%;
        }

        .gantt-fixed-column {
            width: 300px;
            border-right: 2px solid #d1d5db;
            background: white;
            flex-shrink: 0;
            overflow: hidden;
            position: relative;
        }
        
        /* PCè¡¨ç¤ºã§ã®ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆèª¿æ•´ */
        .gantt-navigation button {
            padding: 4px 8px !important;
            font-size: 12px !important;
            height: 32px !important;
        }
        
        .gantt-navigation .text-lg {
            font-size: 14px !important;
        }
        
        /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
        .gantt-navigation {
            padding: 8px 16px !important;
            min-height: auto !important;
        }
        
        .gantt-navigation .flex.items-center.gap-4 {
            gap: 8px !important;
        }
        
        /* ã€Œä»Šæ—¥ã¸ã€ãƒœã‚¿ãƒ³ã‚’ä»–ã®ãƒœã‚¿ãƒ³ã¨å®Œå…¨ã«çµ±ä¸€ */
        #gantt-today-month {
            padding: 4px 8px !important;
            font-size: 12px !important;
            height: 32px !important;
            background-color: #f3f4f6 !important;
            color: #374151 !important;
            border: 1px solid #d1d5db !important;
            border-radius: 6px !important;
            box-sizing: border-box !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        #gantt-today-month:hover {
            background-color: #e5e7eb !important;
        }
        
        /* å‰æœˆãƒ»æ¬¡æœˆãƒœã‚¿ãƒ³ã‚‚åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ã«çµ±ä¸€ */
        #gantt-prev-month, #gantt-next-month {
            padding: 4px 8px !important;
            font-size: 12px !important;
            height: 32px !important;
            background-color: #f3f4f6 !important;
            color: #374151 !important;
            border: 1px solid #d1d5db !important;
            border-radius: 6px !important;
            box-sizing: border-box !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        #gantt-prev-month:hover, #gantt-next-month:hover {
            background-color: #e5e7eb !important;
        }
        
        /* PCè¡¨ç¤ºã§ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹èª¿æ•´ */
        input[type="checkbox"] {
            width: 16px !important;
            height: 16px !important;
            margin-right: 6px !important;
        }
        
        /* PCè¡¨ç¤ºã§ã®æ¤œç´¢çª“ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼èª¿æ•´ */
        .gantt-filters {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border: 1px solid #e5e7eb;
            position: relative;
            z-index: 10;
        }
        
        /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ã®z-indexã‚’å„ªå…ˆã—ã€ä¸€èˆ¬çš„ãªã‚«ãƒ¼ãƒ‰ã¯ä½ãè¨­å®š */
        .bg-white.rounded-lg.shadow-sm.border:not(.stats-card) {
            position: relative;
            z-index: 3;
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã®ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ */
        @media screen and (max-width: 640px) {
            .gantt-container {
                height: 400px;
            }
            
            .gantt-fixed-column {
                width: 200px;
            }
            
            .gantt-day-column {
                min-width: 35px;
                width: 35px;
                max-width: 35px;
                font-size: 10px;
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãƒ‘ãƒ‡ã‚£ãƒ³ã‚°èª¿æ•´ */
            .gantt-fixed-content {
                padding-top: 48px !important;
            }
            
            .gantt-scrollable-area {
                padding-top: 48px !important;
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼é«˜ã•çµ±ä¸€ */
            .gantt-header-row {
                height: 48px !important;
                min-height: 48px !important;
                max-height: 48px !important;
            }
            
            .gantt-header-cell {
                height: 48px !important;
                min-height: 48px !important;
                max-height: 48px !important;
            }
        }

        .gantt-fixed-content {
            height: 100%;
            overflow-y: auto;
        }

        .gantt-scrollable-wrapper {
            flex: 1;
            overflow: hidden;
            position: relative;
            border-left: 0;
        }

        .gantt-header-row {
            height: 48px !important;
            min-height: 48px !important;
            max-height: 48px !important;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb !important;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50 !important;
            overflow: hidden;
            flex-shrink: 0;
        }

        .gantt-scrollable-area {
            height: 100%;
            overflow-x: auto;
            overflow-y: auto;
            padding-top: 48px;
            padding-bottom: 20px;
        }

        .gantt-day-column {
            min-width: 40px;
            width: 40px;
            max-width: 40px;
            min-height: 48px;
            height: 48px;
            max-height: 48px;
            flex-shrink: 0;
            flex-grow: 0;
            padding: 0;
            border-right: 1px solid #e5e7eb;
            text-align: center;
            background: white;
            font-size: 11px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }
        
        .gantt-header-row .gantt-day-column {
            height: 48px;
            min-height: 48px;
            background: #f9fafb;
        }
        
        .gantt-header-cell {
            height: 48px !important;
            min-height: 48px !important;
            max-height: 48px !important;
            background: #f9fafb !important;
            border-right: 1px solid #e5e7eb !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: center !important;
            align-items: center !important;
            min-width: 40px !important;
            width: 40px !important;
            max-width: 40px !important;
            flex-shrink: 0 !important;
            flex-grow: 0 !important;
            padding: 0 !important;
            box-sizing: border-box !important;
        }
        
        .gantt-header-cell > div {
            display: block !important;
            text-align: center !important;
        }
        
        .gantt-scrollable-area .gantt-day-column {
            min-height: 40px !important;
            height: 40px !important;
            max-height: 40px !important;
        }

        .gantt-weekend {
            background-color: #fee2e2 !important;
        }

        .gantt-today {
            background-color: #dbeafe !important;
            border-left: 3px solid #3b82f6 !important;
        }

        .gantt-weekend.gantt-today {
            background-color: #fde68a !important;
            border-left: 3px solid #f59e0b !important;
        }
        
        .gantt-header-cell.gantt-weekend {
            background-color: #fee2e2 !important;
        }
        
        .gantt-header-cell.gantt-today {
            background-color: #dbeafe !important;
            border-left: 3px solid #3b82f6 !important;
            font-weight: 600 !important;
        }
        
        .gantt-header-cell.gantt-weekend.gantt-today {
            background-color: #fde68a !important;
            border-left: 3px solid #f59e0b !important;
        }

        .gantt-row {
            min-height: 48px;
            height: 48px;
            max-height: 48px;
            display: flex;
            align-items: stretch;
            border-bottom: 1px solid #e5e7eb;
            overflow: hidden;
            box-sizing: border-box;
        }
        
        .gantt-task-row {
            min-height: 48px !important;
            height: 48px !important;
            max-height: 48px !important;
            padding: 6px 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
            border-bottom: 1px solid #e5e7eb;
            line-height: 1.2;
            box-sizing: border-box;
        }
        

        
        /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ */
        #gantt-filter-client,
        #gantt-filter-status {
            position: relative !important;
            z-index: 50 !important;
            background-color: white !important;
            pointer-events: auto !important;
            appearance: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e") !important;
            background-position: right 10px center !important;
            background-repeat: no-repeat !important;
            background-size: 14px 14px !important;
            padding-right: 36px !important;
        }
        
        /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®z-indexè¨­å®šã‚’å‰Šé™¤ï¼ˆé‡ãªã‚Šé˜²æ­¢ï¼‰ */
        #gantt-filter-client:focus,
        #gantt-filter-status:focus {
            /* z-indexè¨­å®šã‚’å‰Šé™¤ã—ã¦é‡ãªã‚Šã‚’é˜²ã */
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ */
        .gantt-filters {
            position: relative;
            z-index: 25;
        }
        
        /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ãƒ›ãƒãƒ¼åŠ¹æœ */
        #gantt-filter-client:hover,
        #gantt-filter-status:hover {
            border-color: #3b82f6 !important;
            cursor: pointer !important;
        }
        
        .gantt-task-row {
            cursor: pointer;
            transition: background-color 0.2s ease;
            flex-shrink: 0 !important;
        }
        
        .gantt-task-row:hover {
            background-color: #f3f4f6;
        }
        
        /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯è¡Œ - ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¹ã‚¯ã¨åŒã˜ä½ç½®ã«è¡¨ç¤º */
        .gantt-row.gantt-subtask {
            min-height: 48px;
            height: 48px;
            max-height: 48px;
            overflow: hidden;
            display: flex;
            align-items: stretch;
            margin: 0 !important;
            padding: 0 !important;
            font-size: 11px;
            color: #6b7280;
            flex-shrink: 0 !important;
            box-sizing: border-box;
        }
        
        /* ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯é …ç›®ï¼ˆã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆä»˜ãï¼‰ */
        .gantt-subtask:not(.gantt-row) {
            padding-left: 20px;
            font-size: 11px;
            color: #6b7280;
            border-left: 2px solid #e5e7eb;
            margin-left: 10px;
            flex-shrink: 0 !important;
        }
        
        .gantt-subtask-bar {
            height: 14px;
            background: #9CA3AF;
            border-radius: 2px;
            font-size: 8px;
            color: white;
            padding: 0 2px;
            margin: 1px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            cursor: pointer;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: calc(100% - 2px);
            box-sizing: border-box;
        }
        
        .gantt-subtask-bar.completed {
            background: #6EE7B7;
        }
        
        .gantt-task-bar {
            height: 18px;
            background: #3b82f6;
            border-radius: 0; /* å¢ƒç•Œç·šã‚’æ»‘ã‚‰ã‹ã«ã™ã‚‹ãŸã‚è§’ä¸¸ã‚’ç„¡åŠ¹åŒ– */
            font-size: 9px;
            color: white;
            padding: 0 2px;
            margin: 1px 0; /* å·¦å³ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’é™¤å»ã—ã¦é€£ç¶šè¡¨ç¤º */
            display: flex;
            align-items: center;
            justify-content: flex-start;
            cursor: pointer;
            transition: background-color 0.2s ease;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 100%; /* ã‚»ãƒ«å¹…å…¨ä½“ã‚’ä½¿ç”¨ */
            box-sizing: border-box;
            border: none; /* å¢ƒç•Œç·šã‚’é™¤å» */
        }
        
        .gantt-task-bar:hover {
            background: #2563eb;
        }
        
        .gantt-task-bar.high-priority {
            background: #ef4444;
        }
        
        .gantt-task-bar.high-priority:hover {
            background: #dc2626;
        }
        
        .gantt-task-bar.completed {
            background: #10b981;
            opacity: 0.8;
        }
        
        .gantt-task-bar.completed:hover {
            background: #059669;
        }
        
        .gantt-wrapper {
            display: flex;
            height: 100%;
        }
        
        .gantt-fixed-column {
            width: 320px;
            background: white;
            border-right: 2px solid #d1d5db;
            z-index: 20;
            box-shadow: 2px 0 4px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã®æœ€é©åŒ– */
        @media screen and (max-width: 640px) {
            .gantt-fixed-column {
                width: 160px !important;
            }
        }
        
        @media screen and (max-width: 768px) {
            .gantt-fixed-column {
                width: 200px !important;
            }
        }
        
        /* ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®æ”¹å–„ */
        .tab-button {
            transition: all 0.2s ease;
            border-radius: 8px 8px 0 0;
            position: relative;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        
        /* ãƒœã‚¿ãƒ³å†…ã®è¦ç´ ãŒã‚¯ãƒªãƒƒã‚¯ã‚’é˜»å®³ã—ãªã„ã‚ˆã†ã« */
        .tab-button * {
            pointer-events: none;
        }
        
        /* ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯é ˜åŸŸã‚’ç¢ºå®Ÿã«è¨­å®š */
        .tab-button {
            position: relative;
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }
        
        .tab-button:active {
            transform: scale(0.95);
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .tab-button.active {
            background-color: rgba(59, 130, 246, 0.05);
            border-bottom-width: 3px !important;
        }
        
        /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã§ã®èª¿æ•´ */
        @media screen and (min-width: 641px) {
            .main-header {
                padding: 0 8px;
                gap: 12px;
            }
            
            .header-logo {
                flex-shrink: 0;
                min-width: auto;
            }
            
            .header-logo i {
                font-size: 24px;
                margin-right: 8px;
            }
            
            .header-title {
                font-size: 18px;
                white-space: nowrap;
            }
            
            .tab-navigation {
                max-width: none;
                justify-content: center !important; /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã¯ä¸­å¤®å¯„ã› */
            }
        }

        /* ã‚¹ãƒãƒ›ã§ã®ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ”¹å–„ - å…¨ã‚¿ãƒ–ä¸€ç”»é¢è¡¨ç¤º */
        @media screen and (max-width: 640px) {
            /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®èª¿æ•´ */
            .tab-navigation {
                padding: 0;
                overflow: visible; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç„¡åŠ¹åŒ– */
                flex: 1;
                min-width: 0;
                max-width: calc(100% - 60px); /* ãƒ­ã‚´ã‚¨ãƒªã‚¢åˆ†ã‚’ç¢ºä¿ï¼ˆç¸®å°ï¼‰ */
                display: flex;
                justify-content: flex-end; /* å³å¯„ã‚Šã«é…ç½® */
            }
            
            /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®æ”¹å–„ - 5åˆ†å‰²ã§å›ºå®š */
            .tab-grid {
                display: grid !important;
                grid-template-columns: repeat(5, 1fr); /* 5ç­‰åˆ† */
                gap: 1px;
                width: 100%;
                max-width: 280px; /* æœ€å¤§å¹…ã‚’è¨­å®šã—ã¦å³å¯„ã‚Šã« */
                margin-left: auto; /* å³å¯„ã› */
            }
            
            /* ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®æ”¹å–„ */
            .tab-button {
                min-width: 0; /* æœ€å°å¹…ãªã— */
                width: 100%; /* è¦ªã®å¹…ã«åˆã‚ã›ã‚‹ */
                padding: 3px 1px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°æœ€å°åŒ– */
                border-radius: 4px;
                min-height: 46px; /* ã‚¿ãƒƒãƒã—ã‚„ã™ã */
                font-size: 10px; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å°ã•ã */
                flex-shrink: 1; /* ç¸®å°è¨±å¯ */
                white-space: nowrap;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                overflow: hidden; /* ã¯ã¿å‡ºã—é˜²æ­¢ */
            }
            
            .tab-button i {
                font-size: 14px; /* ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºèª¿æ•´ */
                margin-bottom: 2px;
            }
            
            .tab-button span {
                font-size: 9px; /* ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºèª¿æ•´ */
                line-height: 1.1;
                text-align: center;
            }
            
            .tab-button.active {
                background-color: rgba(59, 130, 246, 0.1);
                border-bottom-width: 3px !important;
                color: #3b82f6;
            }
            
            /* ãƒ˜ãƒƒãƒ€ãƒ¼å…¨ä½“ã®èª¿æ•´ */
            .main-header {
                padding: 0 4px;
                gap: 4px; /* è¦ç´ é–“ã®é–“éš”ã‚’èª¿æ•´ */
            }
            
            .header-title {
                font-size: 14px; /* ã•ã‚‰ã«å°ã•ã */
                white-space: nowrap; /* æ”¹è¡Œé˜²æ­¢ */
                overflow: hidden; /* ã¯ã¿å‡ºã—é˜²æ­¢ */
                text-overflow: ellipsis; /* çœç•¥è¨˜å· */
            }
            
            /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ­ã‚´éƒ¨åˆ†ã®èª¿æ•´ */
            .header-logo {
                flex-shrink: 2; /* ã‚ˆã‚Šç©æ¥µçš„ã«ç¸®å° */
                min-width: 0;
                overflow: hidden; /* ã¯ã¿å‡ºã—é˜²æ­¢ */
            }
            
            .header-logo i {
                font-size: 16px; /* ã•ã‚‰ã«å°ã•ã */
                margin-right: 4px; /* ãƒãƒ¼ã‚¸ãƒ³å‰Šæ¸› */
            }
        }
        
        /* æ¥µå°ç”»é¢ã§ã®èª¿æ•´ */
        @media screen and (max-width: 480px) {
            .tab-navigation {
                max-width: calc(100% - 40px); /* ã•ã‚‰ã«å°ã•ã */
            }
            
            .tab-grid {
                max-width: 240px; /* æ¥µå°ç”»é¢ç”¨ã®æœ€å¤§å¹… */
            }
            
            .tab-button {
                min-height: 44px;
                padding: 3px 1px;
            }
            
            .tab-button i {
                font-size: 12px;
                margin-bottom: 1px;
            }
            
            .tab-button span {
                font-size: 8px;
                line-height: 1.0;
            }
            
            .main-header {
                padding: 0 2px;
                gap: 2px;
            }
            
            .header-title {
                font-size: 12px;
                display: none; /* æ¥µå°ç”»é¢ã§ã¯éè¡¨ç¤º */
            }
            
            .header-logo i {
                font-size: 14px;
                margin-right: 0;
            }
        }
        
        /* è¶…æ¥µå°ç”»é¢ã§ã®èª¿æ•´ */
        @media screen and (max-width: 360px) {
            .tab-button {
                min-height: 36px;
                padding: 1px;
            }
            
            .tab-button i {
                font-size: 10px;
                margin-bottom: 1px;
            }
            
            .tab-button span {
                font-size: 6px;
                line-height: 0.9;
            }
        }
        
        /* ã•ã‚‰ã«æ¥µå°ç”»é¢ã§ã®èª¿æ•´ï¼ˆ320pxä»¥ä¸‹ï¼‰ */
        @media screen and (max-width: 320px) {
            .tab-button {
                min-height: 34px;
                padding: 1px 0;
            }
            
            .tab-button i {
                font-size: 9px;
                margin-bottom: 0px;
            }
            
            .tab-button span {
                font-size: 5px;
                line-height: 0.8;
            }
            
            .main-header {
                padding: 0 2px;
            }
            
            .header-title {
                font-size: 12px;
            }
        }
        
        /* ğŸ”„ åŒæœŸã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .sync-status {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .sync-status.success {
            background-color: rgba(34, 197, 94, 0.2);
            animation: pulse-success 2s ease-in-out;
        }
        
        .sync-status.error {
            background-color: rgba(239, 68, 68, 0.2);
            animation: pulse-error 2s ease-in-out;
        }
        
        .sync-status.syncing {
            animation: spin 1s linear infinite;
        }
        
        @keyframes pulse-success {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes pulse-error {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .gantt-scrollable-area {
            flex: 1;
            overflow: auto;
            position: relative;
        }
        
        .gantt-content {
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }
        
        .gantt-row {
            height: 48px;
            min-height: 48px;
            max-height: 48px;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            align-items: center;
        }
        
        .gantt-header {
            height: 48px;
            background: #f9fafb;
            border-bottom: 2px solid #d1d5db;
            display: flex;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        

        
        .gantt-task-bar.high-priority {
            background: #EF4444;
        }
        
        .gantt-task-bar.high-priority:hover {
            background: #DC2626;
        }
        
        .gantt-day-column {
            min-width: 50px;
            width: 50px;
            height: 100%;
            border-right: 1px solid #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #6b7280;
            flex-shrink: 0;
            padding: 2px;
        }
        
        .gantt-weekend {
            background: #f9fafb;
        }
        
        .gantt-today {
            background: #fef3c7;
            border-right: 2px solid #f59e0b;
        }
        
        /* ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒã‚¹ã‚¿ã‚¤ãƒ« */
        input[type="checkbox"]:checked + div {
            background-color: #10b981;
        }
        
        input[type="checkbox"]:checked + div .dot {
            transform: translateX(24px);
        }
        
        /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        .stats-card {
            --fa-style-family-brands: "Font Awesome 6 Brands";
            --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
            --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Free";
            --fa-style-family-classic: "Font Awesome 6 Free";
            --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Free";
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style: ;
            border-radius: 0.5rem;
            border-width: 1px;
            --tw-border-opacity: 1;
            border-color: rgb(229 231 235 / var(--tw-border-opacity, 1));
            --tw-bg-opacity: 1;
            background-color: rgb(255 255 255 / var(--tw-bg-opacity, 1));
            padding: 0.5rem;
            --tw-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);
            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);
            position: relative;
            z-index: 5;
        }

        /* ã‚¿ã‚¹ã‚¯ã‚¢ã‚¤ãƒ†ãƒ åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        .task-item {
            --fa-style-family-brands: "Font Awesome 6 Brands";
            --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
            --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Free";
            --fa-style-family-classic: "Font Awesome 6 Free";
            --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Free";
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style: ;
            border-radius: 0.5rem;
            border-width: 1px;
            --tw-border-opacity: 1;
            border-color: rgb(229 231 235 / var(--tw-border-opacity, 1));
            --tw-bg-opacity: 1;
            background-color: rgb(255 255 255 / var(--tw-bg-opacity, 1));
            padding: 0.3rem;
            --tw-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);
            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);
            position: relative;
            z-index: 5;
        }

        /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç‰ˆ - ã‚¿ã‚¹ã‚¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã‚¿ã‚¤ãƒˆãƒ«ã®èª¿æ•´ */
        .task-content {
            margin-left: 16px !important; /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã®é©åˆ‡ãªé–“éš” */
        }
        
        .task-title {
            margin-top: 6px !important;
            margin-bottom: 6px !important;
        }
        
        /* APIã‚­ãƒ¼è¡¨ç¤º/éè¡¨ç¤ºãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .relative input[type="password"],
        .relative input[type="text"] {
            padding-right: 2.5rem !important;
        }
        
        .relative button {
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .relative button:hover i {
            color: #4B5563 !important;
        }

        /* è¨­å®šç”»é¢ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æœ€é©åŒ– */
        #settings-view .bg-white {
            overflow: hidden; /* ã¯ã¿å‡ºã—é˜²æ­¢ */
        }
        
        #settings-view input,
        #settings-view textarea,
        #settings-view select {
            max-width: 100% !important;
            box-sizing: border-box !important;
        }
        
        #settings-view .relative {
            width: 100% !important;
            max-width: 100% !important;
        }

        /* ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ«å…¨ä½“ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æœ€é©åŒ– */
        #task-modal input,
        #task-modal textarea,
        #task-modal select {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            min-height: 38px !important;
            padding: 6px 12px !important;
            font-size: 14px !important;
            line-height: 1.5 !important;
        }
        
        /* ãƒ•ã‚©ãƒ¼ãƒ å†…ã®è¦ç´ ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¼·åˆ¶ä¸Šæ›¸ã */
        #task-form input[style*="width"],
        #task-form textarea[style*="width"],
        #task-form select[style*="width"] {
            width: 100% !important;
            max-width: 100% !important;
        }
        
        /* ã‚°ãƒªãƒƒãƒ‰å†…è¦ç´ ã®çµ±ä¸€å¹…è¨­å®š - æœ€é«˜å„ªå…ˆåº¦ */
        #task-form .grid input[style*="width"],
        #task-form .grid select[style*="width"] {
            width: 100% !important;
            max-width: 100% !important;
        }

        /* å…¨ç”»é¢ã‚µã‚¤ã‚ºã§ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«å®Œå…¨ç„¡åŠ¹åŒ– - æœ€é«˜å„ªå…ˆåº¦ */
        #task-modal #task-priority,
        #task-modal #task-client,
        #task-modal #task-deadline, 
        #task-modal #task-scheduled {
            width: 100% !important;
            max-width: 100% !important;
            min-width: 0 !important;
            box-sizing: border-box !important;
            min-height: 38px !important;
            height: auto !important;
            padding: 6px 12px !important;
            font-size: 14px !important;
            line-height: 1.5 !important;
        }

        /* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«å±æ€§ã‚’æŒã¤è¦ç´ ã®å¼·åˆ¶ä¸Šæ›¸ã - è¶…é«˜å„ªå…ˆåº¦ */
        #task-modal select[style*="90%"],
        #task-modal input[style*="90%"],
        #task-modal select[style*="width"],
        #task-modal input[style*="width"] {
            width: 100% !important;
            max-width: 100% !important;
        }

        /* ã‚°ãƒªãƒƒãƒ‰å†…è¦ç´ ã®çµ¶å¯¾çš„çµ±ä¸€ */
        #task-modal .grid > div > select,
        #task-modal .grid > div > input {
            width: 100% !important;
            max-width: 100% !important;
            min-width: 0 !important;
        }

        /* JavaScriptã§è¿½åŠ ã•ã‚Œã‚‹å¼·åˆ¶ã‚¯ãƒ©ã‚¹ */
        .grid-element-forced {
            width: 100% !important;
            max-width: 100% !important;
        }

        /* ç‰¹å®šIDã«ã‚ˆã‚‹çµ¶å¯¾åˆ¶å¾¡ */
        #task-priority.grid-element-forced,
        #task-client.grid-element-forced,
        #task-deadline.grid-element-forced,
        #task-scheduled.grid-element-forced {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
        }

        /* å¤§ç”»é¢ã§ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«å¼·åˆ¶ä¸Šæ›¸ã */
        @media screen and (min-width: 1200px) {
            #task-form input[style],
            #task-form select[style],
            #task-form textarea[style] {
                width: 100% !important;
                max-width: 100% !important;
            }
            
            #task-form .grid input[style],
            #task-form .grid select[style] {
                width: 100% !important;
                max-width: 350px !important;
            }
        }
        
        /* ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚³ãƒ³ãƒ†ãƒŠã®åŸºæœ¬è¨­å®š */
        #subtasks-container {
            width: 100% !important;
            overflow-x: hidden !important;
        }
        
        /* ã‚µãƒ–ã‚¿ã‚¹ã‚¯å†…ã®è¦ç´ ã‚‚å¼·åˆ¶çš„ã«é©æ­£ã‚µã‚¤ã‚ºã« */
        #subtasks-container input[style*="width"] {
            width: auto !important;
            max-width: none !important;
        }

        /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ãƒ†ã‚­ã‚¹ãƒˆçœç•¥å¯¾å¿œ */
        #task-modal select {
            text-overflow: ellipsis !important;
            white-space: nowrap !important;
            overflow: visible !important;
        }

        #task-modal select option {
            max-width: none !important;
            white-space: nowrap !important;
            overflow: visible !important;
            text-overflow: ellipsis !important;
        }

        /* PCç”»é¢ã§ã®ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ çµ±ä¸€æœ€é©åŒ– */
        @media screen and (min-width: 769px) {
            /* ã‚°ãƒªãƒƒãƒ‰å†…ã®ã™ã¹ã¦ã®å…¥åŠ›è¦ç´ ã‚’çµ±ä¸€ - è¶…é«˜å„ªå…ˆåº¦ */
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 input,
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 select,
            #task-modal .grid input,
            #task-modal .grid select {
                width: 100% !important;
                max-width: 100% !important;
                min-width: 180px !important;
                padding: 6px 12px !important;
                font-size: 14px !important;
                line-height: 1.5 !important;
                min-height: 38px !important;
                height: auto !important;
                box-sizing: border-box !important;
            }
            
            /* ç‰¹å®šè¦ç´ ã®å€‹åˆ¥è¨­å®šã‚’å‰Šé™¤ã—ã¦çµ±ä¸€æ€§ã‚’ç¢ºä¿ */
            #task-deadline,
            #task-priority,
            #task-scheduled,
            #task-client {
                width: 100% !important;
                max-width: 100% !important;
            }
            
            /* ã‚°ãƒªãƒƒãƒ‰ã‚¢ã‚¤ãƒ†ãƒ ã®å¹…ç¢ºä¿ */
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 > div {
                min-width: 0 !important;
                width: 100% !important;
                flex: 1 !important;
                display: flex !important;
                flex-direction: column !important;
            }
            
            /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè‡ªä½“ã®æœ€é©åŒ– */
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 20px !important;
                width: 100% !important;
                align-items: stretch !important;
            }
            
            /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³æœ€é©åŒ– */
            #task-modal select option {
                padding: 4px 8px !important;
                font-size: 14px !important;
                white-space: nowrap !important;
            }
            
            /* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã®ä¸Šæ›¸ãå¼·åˆ¶ */
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 [style*="width"] {
                width: 100% !important;
                max-width: 100% !important;
            }
        }

        /* å¤§ç”»é¢ï¼ˆ1200pxä»¥ä¸Šï¼‰ã§ã®è¿½åŠ æœ€é©åŒ– */
        @media screen and (min-width: 1200px) {
            /* ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ«å…¨ä½“ã®å¹…åˆ¶é™ */
            #task-modal .bg-white {
                max-width: 800px !important;
                width: 90vw !important;
                margin: 0 auto !important;
            }
            
            /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®æœ€å¤§å¹…åˆ¶é™ */
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 input,
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 select {
                max-width: 350px !important;
                width: 100% !important;
                min-height: 40px !important;
                padding: 8px 12px !important;
                font-size: 14px !important;
            }
            
            /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®èª¿æ•´ */
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 {
                gap: 24px !important;
            }
            
            /* 90%å¹…è¨­å®šã®ä¸Šæ›¸ã */
            #task-modal input[style*="90%"],
            #task-modal select[style*="90%"],
            #task-modal textarea[style*="90%"] {
                width: 100% !important;
                max-width: 100% !important;
                min-height: 40px !important;
            }
            
            /* ã‚°ãƒªãƒƒãƒ‰å†…è¦ç´ ã®å¼·åˆ¶è¨­å®š */
            #task-modal .grid input,
            #task-modal .grid select {
                width: 100% !important;
                max-width: 350px !important;
                min-height: 40px !important;
            }
        }

        /* è¶…å¤§ç”»é¢ï¼ˆ1600pxä»¥ä¸Šï¼‰ã§ã®æœ€é©åŒ– */
        @media screen and (min-width: 1600px) {
            #task-modal .bg-white {
                max-width: 900px !important;
                width: 60vw !important;
            }
            
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 input,
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 select {
                max-width: 400px !important;
            }
        }

        /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®èª¿æ•´ */
        #task-modal .grid.grid-cols-1.md\\:grid-cols-2 {
            gap: 16px !important;
        }

        @media screen and (max-width: 768px) {
            #task-modal .grid.grid-cols-1.md\\:grid-cols-2 {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
            }
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã®è¨­å®šç”»é¢æœ€é©åŒ– */
        @media screen and (max-width: 640px) {
            #settings-view {
                padding: 0 !important;
            }
            
            #settings-view > div {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }
            
            #settings-view .bg-white {
                margin-left: 0 !important;
                margin-right: 0 !important;
                border-left: none !important;
                border-right: none !important;
                border-radius: 0 !important;
            }
            
            #settings-view .space-x-2 {
                flex-direction: column !important;
            }
            
            #settings-view .space-x-2 > * {
                margin-left: 0 !important;
                margin-bottom: 0.5rem !important;
                width: 100% !important;
            }
            
            /* è¨­å®šç”»é¢ã®ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒã‚µã‚¤ã‚ºçµ±ä¸€ */
            #settings-view .toggle-switch {
                width: 40px !important;
                height: 20px !important;
                flex-shrink: 0 !important;
            }
            
            /* ã‚¹ãƒãƒ›è¡¨ç¤ºã§ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹è£å´è¡¨ç¤ºå•é¡Œã‚’å®Œå…¨ã«ä¿®æ­£ */
            #settings-view .toggle-switch input[type="checkbox"] {
                position: absolute !important;
                opacity: 0 !important;
                width: 0 !important;
                height: 0 !important;
                visibility: hidden !important;
                pointer-events: none !important;
                z-index: -1 !important;
                overflow: hidden !important;
                clip: rect(0, 0, 0, 0) !important;
            }
            
            /* è¨­å®šé …ç›®ã®é…ç½®èª¿æ•´ */
            #settings-view .flex.items-center.justify-between {
                align-items: flex-start !important;
            }
            
            #settings-view .flex.items-center.justify-between > div:first-child {
                flex: 1 !important;
                margin-right: 1rem !important;
            }
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«å†…å›ºå®šãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢æœ€é©åŒ– - æœ€å¼·å„ªå…ˆåº¦ */
        div#task-modal .modal-footer,
        div#client-modal .modal-footer,
        #task-modal .modal-footer,
        #client-modal .modal-footer {
            position: sticky !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            width: 100% !important;
            max-width: none !important;
            margin: 0 !important;
            padding: 1rem 1.5rem !important;
            background-color: white !important;
            border-top: 1px solid #e5e7eb !important;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1) !important;
            z-index: 50 !important;
            box-sizing: border-box !important;
            overflow: hidden !important;
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«èª¿æ•´ */
        @media screen and (max-width: 640px) {
            div#task-modal .modal-footer,
            div#client-modal .modal-footer,
            #task-modal .modal-footer,
            #client-modal .modal-footer {
                padding: 0.75rem 1rem !important;
            }
        }

        /* ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã®çµ±è¨ˆã‚«ãƒ¼ãƒ‰æœ€é©åŒ– */
        @media screen and (max-width: 640px) {
            .stats-card {
                padding: 0.375rem !important; /* p-1.5ç›¸å½“ */
            }
            
            .stats-card .text-xs {
                font-size: 10px !important;
            }
            
            .stats-card .text-sm {
                font-size: 11px !important;
            }
            
            .stats-card i {
                font-size: 12px !important;
            }
        }

        /* ã‚¹ãƒãƒ›ã§ã®ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆæœ€é©åŒ– */
        @media screen and (max-width: 640px) {
            /* ã‚¿ã‚¹ã‚¯ã‚¢ã‚¤ãƒ†ãƒ å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
            .task-item {
                display: flex !important;
                align-items: flex-start !important;
                padding: 12px 8px !important;
                min-height: auto !important;
                gap: 8px;
            }
            
            /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹éƒ¨åˆ† */
            .task-checkbox {
                flex-shrink: 0;
                margin-top: 4px;
            }
            
            /* ã‚¿ã‚¹ã‚¯æƒ…å ±éƒ¨åˆ†ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰ */
            .task-content {
                flex: 1;
                min-width: 0; /* ã¯ã¿å‡ºã—é˜²æ­¢ */
                overflow: hidden;
                display: flex;
                flex-direction: column;
                justify-content: flex-start; /* ä¸Šå¯„ã›ã§çµ±ä¸€ */
                margin-left: 12px !important; /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¨ã®é–“éš” */
            }
            
            /* ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒˆãƒ« */
            .task-title {
                font-size: 14px !important;
                line-height: 1.4 !important;
                margin-top: 6px !important;
                margin-bottom: 2px !important;
                word-break: break-all !important;
                overflow-wrap: break-word !important;
                display: -webkit-box !important;
                -webkit-line-clamp: 2 !important; /* æœ€å¤§2è¡Œ */
                line-clamp: 2 !important; /* æ¨™æº–ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ */
                -webkit-box-orient: vertical !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                /* å‚ç›´ä½ç½®ã®èª¿æ•´ */
                -webkit-box-align: start !important;
                vertical-align: top !important;
                position: relative !important;
                top: -1px !important; /* å¾®èª¿æ•´ã§ä¸Šæ–¹å‘ã«ç§»å‹• */
            }
            
            /* ã‚¿ã‚¹ã‚¯ãƒ¡ã‚¿æƒ…å ± */
            .task-meta {
                display: flex;
                flex-wrap: wrap;
                gap: 4px;
                align-items: center;
                font-size: 11px !important;
                margin-top: 4px;
            }
            
            .task-meta > * {
                flex-shrink: 0;
                white-space: nowrap;
            }
            
            /* é¡§å®¢å */
            .task-client {
                max-width: 120px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
            .task-status {
                padding: 1px 6px !important;
                font-size: 10px !important;
                border-radius: 12px !important;
            }
            
            /* å„ªå…ˆåº¦ãƒãƒƒã‚¸ */
            .task-priority {
                padding: 1px 6px !important;
                font-size: 10px !important;
                border-radius: 12px !important;
            }
            
            /* æœŸé™è¡¨ç¤º */
            .task-deadline {
                font-size: 10px !important;
            }
            
            /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ç¾¤ */
            .task-actions {
                flex-shrink: 0;
                display: flex;
                flex-direction: column;
                gap: 4px;
                align-items: center;
                justify-content: flex-start;
                margin-left: 4px;
                position: relative;
                top: 0px; /* ãƒœã‚¿ãƒ³ä½ç½®ã®å¾®èª¿æ•´ */
            }
            
            .task-actions button {
                width: 32px !important;
                height: 32px !important;
                padding: 0 !important;
                font-size: 12px !important;
                border-radius: 6px !important;
                flex-shrink: 0;
                min-width: 32px;
            }
            
            /* ã‚¿ã‚¤ãƒãƒ¼ãƒœã‚¿ãƒ³ã®ç‰¹åˆ¥èª¿æ•´ */
            .task-actions .timer-btn {
                border-width: 2px !important;
            }
            
            .task-actions .timer-btn.running {
                background-color: #fef2f2 !important;
                border-color: #ef4444 !important;
            }
            
            .task-actions .timer-btn.paused {
                background-color: #fef3c7 !important;
                border-color: #f59e0b !important;
            }
            
            /* äºˆæƒ³æ™‚é–“ãƒ»å®Ÿç¸¾æ™‚é–“ */
            .task-time {
                font-size: 10px !important;
                color: #6B7280;
            }
        }
        
        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ä¸­ç¨‹åº¦ã®ç”»é¢èª¿æ•´ */
        @media screen and (max-width: 640px) {
            .task-item {
                padding: 8px !important;
            }
            
            .task-content {
                min-width: 0; /* ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹å­è¦ç´ ã®ç¸®å°ã‚’è¨±å¯ */
                flex: 1;
                margin-right: 8px;
                margin-left: 10px !important; /* ã‚¹ãƒãƒ›ã§ã®é–“éš”èª¿æ•´ */
            }
            
            .task-title {
                font-size: 14px !important;
                margin-top: 6px !important;
                margin-bottom: 2px !important;
            }
            
            .task-meta {
                gap: 3px;
            }
            
            .task-actions {
                margin-left: 2px;
                gap: 3px;
            }
        }
        
        /* æ¥µå°ç”»é¢ã§ã®èª¿æ•´ */
        @media screen and (max-width: 480px) {
            .task-title {
                font-size: 13px !important;
                line-height: 1.3 !important;
                margin-top: 6px !important;
                -webkit-line-clamp: 1 !important; /* 1è¡Œã«åˆ¶é™ */
                line-clamp: 1 !important; /* æ¨™æº–ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ */
                max-height: 1.3em; /* 1è¡Œåˆ†ã®é«˜ã•åˆ¶é™ */
                /* å˜è¡Œè¡¨ç¤ºã§ã®å‚ç›´ä½ç½®èª¿æ•´ */
                -webkit-box-align: start !important;
                vertical-align: top !important;
                top: 0px !important; /* å˜è¡Œã§ã¯å¾®èª¿æ•´ãªã— */
            }
            
            .task-meta {
                font-size: 10px !important;
            }
            
            /* ãƒ¡ã‚¿æƒ…å ±ã®é…ç½®æœ€é©åŒ– */
            .task-meta > * {
                margin-right: 2px;
            }
            
            .task-client {
                max-width: 100px;
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’æ¨ªä¸¦ã³ã«é…ç½® */
            .task-actions {
                flex-direction: row !important;
                gap: 2px !important;
                justify-content: flex-end !important;
                align-items: flex-start !important;
                margin-left: 8px !important;
                margin-top: 0px !important;
            }
            
            .task-actions button {
                width: 24px !important;
                height: 24px !important;
                font-size: 10px !important;
                min-width: 24px !important;
                border-radius: 4px !important;
            }
            
            /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒœã‚¿ãƒ³èª¿æ•´ */
            .flex.justify-end.space-x-3 {
                flex-direction: column !important;
                gap: 8px;
            }
            
            .flex.justify-end.space-x-3 button {
                width: 100% !important;
                padding: 12px !important;
                font-size: 16px !important;
                min-height: 44px; /* ã‚¿ãƒƒãƒãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªæœ€å°ã‚¿ãƒƒãƒ—é ˜åŸŸ */
            }
            
            /* ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›è¦ç´ ã®ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
            input[type="text"], input[type="date"], input[type="datetime-local"], 
            input[type="number"], input[type="email"], input[type="tel"], 
            select, textarea {
                font-size: 16px !important; /* iOSã‚ºãƒ¼ãƒ é˜²æ­¢ */
                min-height: 44px !important; /* ã‚¿ãƒƒãƒãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªé«˜ã• */
                padding: 12px 16px !important; /* ã‚ˆã‚Šå¤§ããªã‚¿ãƒƒãƒé ˜åŸŸ */
                border-radius: 8px !important; /* è¦‹ã‚„ã™ã„è§’ä¸¸ */
                -webkit-appearance: none !important; /* iOSç‹¬è‡ªã‚¹ã‚¿ã‚¤ãƒ«ç„¡åŠ¹åŒ– */
                appearance: none !important;
            }
            
            /* ğŸ”§ ãƒ¢ãƒ¼ãƒ€ãƒ«å®Œå…¨æœ€é©åŒ– - ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼å•é¡Œå®Œå…¨è§£æ±º */
            #task-modal, #client-modal {
                padding: 10px !important;
            }
            
            /* PCè¡¨ç¤ºã§ã®ãƒ¢ãƒ¼ãƒ€ãƒ«æœ€é©åŒ– - æœ€å¼·å„ªå…ˆåº¦è¨­å®š */
            @media screen and (min-width: 769px) {
                /* ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–å´ã‚³ãƒ³ãƒ†ãƒŠã®èª¿æ•´ - ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹è¨­å®šã‚’ä¸Šæ›¸ã */
                div#task-modal.fixed {
                    align-items: flex-start !important; /* center ã‹ã‚‰ flex-start ã« */
                    padding-top: 2.5vh !important; /* ä¸Šéƒ¨ã«ä½™ç™½ã‚’è¿½åŠ  */
                }
                
                /* ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« - PCè¡¨ç¤ºã§ååˆ†ãªå›ºå®šã‚µã‚¤ã‚º - æœ€å¼·ã‚»ãƒ¬ã‚¯ã‚¿ */
                div#task-modal.fixed div.bg-white.rounded-lg {
                    width: 850px !important;
                    max-width: 850px !important;
                    max-height: 85vh !important; /* å®Ÿç”¨çš„ãªé«˜ã•ã«èª¿æ•´ */
                    min-height: 400px !important; /* 650px ã‹ã‚‰ 400px ã«æ¸›å°‘ */
                    
                    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ - æœ€å¼·è¨­å®š */
                    overflow-y: auto !important; /* ã‚ˆã‚Šè‡ªç„¶ãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
                    overflow-x: hidden !important;
                    display: flex !important;
                    flex-direction: column !important;
                    
                    /* ä½ç½®èª¿æ•´ */
                    margin: 0 auto !important;
                    position: relative !important;
                    box-sizing: border-box !important;
                }
                
                /* ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ«å†…è¦ç´ ã®é…ç½®åˆ¶å¾¡ */
                div#task-modal.fixed div.bg-white.rounded-lg > * {
                    flex-shrink: 0 !important;
                }
                
                div#task-modal.fixed div.bg-white.rounded-lg > form {
                    flex: 1 !important;
                    overflow-y: auto !important;
                }
                
                /* ã•ã‚‰ã«å¼·åŠ›ãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®š - HTMLè¦ç´ éšå±¤æŒ‡å®šã§Tailwindä¸Šæ›¸ã */
                html body div#task-modal div.bg-white,
                body div#task-modal div.bg-white,
                #task-modal > div.bg-white {
                    overflow-y: auto !important;
                    max-height: 85vh !important;
                    display: block !important;
                }
                
                /* é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–å´ã‚³ãƒ³ãƒ†ãƒŠã®èª¿æ•´ - ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹è¨­å®šã‚’ä¸Šæ›¸ã */
                div#client-modal.fixed {
                    align-items: flex-start !important; /* center ã‹ã‚‰ flex-start ã« */
                    padding-top: 2.5vh !important; /* ä¸Šéƒ¨ã«ä½™ç™½ã‚’è¿½åŠ  */
                }
                
                /* é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ« - PCè¡¨ç¤ºã§é©åˆ‡ãªå›ºå®šã‚µã‚¤ã‚º - æœ€å¼·ã‚»ãƒ¬ã‚¯ã‚¿ */
                div#client-modal.fixed div.bg-white.rounded-lg {
                    width: 650px !important;
                    max-width: 650px !important;
                    max-height: 85vh !important; /* å®Ÿç”¨çš„ãªé«˜ã•ã«èª¿æ•´ */
                    min-height: 400px !important; /* 650px ã‹ã‚‰ 400px ã«æ¸›å°‘ */
                    
                    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ - æœ€å¼·è¨­å®š */
                    overflow-y: auto !important; /* ã‚ˆã‚Šè‡ªç„¶ãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
                    overflow-x: hidden !important;
                    display: flex !important;
                    flex-direction: column !important;
                    
                    /* ä½ç½®èª¿æ•´ */
                    margin: 0 auto !important;
                    position: relative !important;
                    box-sizing: border-box !important;
                }
                
                /* é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«å†…è¦ç´ ã®é…ç½®åˆ¶å¾¡ */
                div#client-modal.fixed div.bg-white.rounded-lg > * {
                    flex-shrink: 0 !important;
                }
                
                div#client-modal.fixed div.bg-white.rounded-lg > form {
                    flex: 1 !important;
                    overflow-y: auto !important;
                }
                
                /* é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®å¼·åŠ›ãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®š - HTMLè¦ç´ éšå±¤æŒ‡å®šã§Tailwindä¸Šæ›¸ã */
                html body div#client-modal div.bg-white,
                body div#client-modal div.bg-white,
                #client-modal > div.bg-white {
                    overflow-y: auto !important;
                    max-height: 85vh !important;
                    display: block !important;
                }
            }
            
            /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã§ã®èª¿æ•´ */
            @media screen and (max-width: 768px) {
                /* ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« - ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
                #task-modal .bg-white {
                    width: 90vw !important;
                    max-width: 90vw !important;
                    max-height: 90vh !important;
                    
                    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ - å…¨ä½“ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
                    overflow-y: auto !important;
                    overflow-x: hidden !important;
                    display: block !important;
                    
                    /* ä½ç½®èª¿æ•´ */
                    margin: 0 !important;
                    position: relative !important;
                }
                
                /* é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ« - ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
                #client-modal .bg-white {
                    width: 85vw !important;
                    max-width: 85vw !important;
                    max-height: 85vh !important; /* 75vh â†’ 85vh ã«çµ±ä¸€ */
                    
                    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ - å…¨ä½“ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
                    overflow-y: auto !important;
                    overflow-x: hidden !important;
                    display: block !important;
                    
                    /* ä½ç½®èª¿æ•´ */
                    margin: 0 !important;
                    position: relative !important;
                }
            }
            
            /* ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®å›ºå®š */
            #task-modal .border-b, #client-modal .border-b {
                flex-shrink: 0 !important;
                background: white !important;
                z-index: 1 !important;
            }
            
            /* PCè¡¨ç¤ºã§ã®ãƒ˜ãƒƒãƒ€ãƒ¼é«˜ã•å›ºå®š */
            @media screen and (min-width: 769px) {
                #task-modal .border-b, #client-modal .border-b {
                    min-height: 80px !important;
                    max-height: 80px !important;
                    display: flex !important;
                    align-items: center !important;
                }
            }
            
            /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
            #task-modal form, #client-modal form {
                margin: 0 !important;
            }
            
            /* å‰Šé™¤: ç«¶åˆã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ é«˜ã•è¨­å®šã‚’å‰Šé™¤ */
            
            /* PCè¡¨ç¤ºã§ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°æœ€é©åŒ– */
            @media screen and (min-width: 769px) {
                #task-modal form, #client-modal form {
                    padding: 40px !important;
                    /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®šã¯å‰Šé™¤ - è¦ªè¦ç´ (.bg-white)ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡ */
                }
                
                /* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã‚’ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã« */
                #task-modal .sticky,
                #client-modal .sticky {
                    position: sticky !important;
                    bottom: 0 !important;
                    z-index: 10 !important;
                }
                
                /* PCè¡¨ç¤ºã§ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡æ”¹å–„ */
                #task-modal .bg-white, #client-modal .bg-white {
                    /* ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹é«˜ã•è¨ˆç®—ã‚’æœ€é©åŒ– */
                    min-height: auto !important;
                }
                
                /* PCè¡¨ç¤ºã§ã®ã‚¿ã‚¹ã‚¯ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ é–“éš”èª¿æ•´ */
                #task-modal .space-y-4 > * + * {
                    margin-top: 1.5rem !important;
                }
                
                /* PCè¡¨ç¤ºã§ã®åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ä½™ç™½èª¿æ•´ */
                #task-modal .space-y-4 .space-y-4 > * + * {
                    margin-top: 1.25rem !important;
                }
                
                /* PCè¡¨ç¤ºã§ã®ãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæœ€é©åŒ– */
                #task-modal form {
                    max-width: 100% !important;
                    margin: 0 !important;
                }
            }
            
            /* å¤§ç”»é¢PCè¡¨ç¤ºã§ã®è¿½åŠ è¨­å®š */
            @media screen and (min-width: 1201px) {
                #task-modal form {
                    max-width: 100% !important;
                    margin: 0 !important;
                }
            }
            
            /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° */
            @media screen and (max-width: 768px) {
                #task-modal form, #client-modal form {
                    padding: 24px !important;
                }
            }
            
            /* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã®å›ºå®š */
            #task-modal .border-t, #client-modal .border-t {
                flex-shrink: 0 !important;
                background: white !important;
                z-index: 1 !important;
                position: sticky !important;
                bottom: 0 !important;
                padding: 16px 4px !important;
            }
            
            /* PCè¡¨ç¤ºã§ã®ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢èª¿æ•´ */
            @media screen and (min-width: 769px) {
                #task-modal .border-t, #client-modal .border-t {
                    margin: 0 32px !important;
                    padding: 20px 0 !important;
                    /* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã®é«˜ã•ã‚’å›ºå®šã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å®‰å®šåŒ– */
                    min-height: 70px !important;
                    max-height: 70px !important;
                }
            }
            
            /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã®ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
            @media screen and (max-width: 768px) {
                #task-modal .border-t, #client-modal .border-t {
                    margin: 0 20px !important;
                    padding: 16px 4px !important;
                }
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«ç‰¹åˆ¥èª¿æ•´ */
            @media screen and (max-width: 640px) {
                #task-modal, #client-modal {
                    padding: 5px !important;
                }
                
                /* ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« - ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚ç¸¦é•·å¯¾å¿œ */
                #task-modal .bg-white {
                    max-width: 95vw !important;
                    width: 95vw !important;
                    max-height: 95vh !important;
                }
                
                /* é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ« - ãƒ¢ãƒã‚¤ãƒ«ã§ã¯å°‘ã—ç¸¦é•·ã« */
                #client-modal .bg-white {
                    max-width: 95vw !important;
                    width: 95vw !important;
                    max-height: 85vh !important;
                }
                
                #task-modal form, #client-modal form {
                    padding: 16px !important;
                    overflow-y: auto !important;
                    flex: 1 !important;
                }
                
                #task-modal .border-t, #client-modal .border-t {
                    margin: 0 12px !important;
                    padding: 12px 0 !important;
                }
            }
            
            /* æ¥µå°ç”»é¢å¯¾å¿œ */
            @media screen and (max-width: 480px) {
                #task-modal .bg-white {
                    max-width: 98vw !important;
                    width: 98vw !important;
                    max-height: 98vh !important;
                }
                
                #client-modal .bg-white {
                    max-width: 98vw !important;
                    width: 98vw !important;
                    max-height: 90vh !important;
                }
                
                #task-modal form, #client-modal form {
                    padding: 12px !important;
                    overflow-y: auto !important;
                    flex: 1 !important;
                }
            }
            
            /* ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°èª¿æ•´ */
            @media screen and (max-width: 640px) {
                #task-modal .p-6, #client-modal .p-6 {
                    padding: 16px !important;
                }
            }
            
            @media screen and (min-width: 641px) {
                #task-modal .p-6, #client-modal .p-6 {
                    padding: 24px !important;
                }
            }
            
            /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®å¹…ã‚’ç¢ºå®Ÿã«åˆ¶å¾¡ */
            #task-modal form, #client-modal form {
                width: 100% !important;
                box-sizing: border-box !important;
            }
            
            #task-modal input, #task-modal select, #task-modal textarea,
            #client-modal input, #client-modal select, #client-modal textarea {
                box-sizing: border-box !important;
                min-height: 42px !important;
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã¯100%å¹… */
            @media screen and (max-width: 768px) {
                #task-modal input, #task-modal select, #task-modal textarea,
                #client-modal input, #client-modal select, #client-modal textarea {
                    width: 100% !important;
                    max-width: 100% !important;
                }
            }
            
            /* PCè¡¨ç¤ºã§ã®ã‚¿ã‚¹ã‚¯ãƒ•ã‚©ãƒ¼ãƒ å…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³å¹…åˆ¶é™ */
            @media screen and (min-width: 769px) {
                /* åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã€æ™‚é–“ãƒ­ã‚°ã‚’é©åˆ‡ãªå¹…ã«åˆ¶é™ */
                #task-modal .space-y-4,
                #task-modal form > div {
                    max-width: 600px !important;
                    margin: 0 auto !important;
                }
                
                /* PCè¡¨ç¤ºã§ã®ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ 90%å¹…è¨­å®š - æœ€å„ªå…ˆ */
                div#task-modal input,
                div#task-modal select,  
                div#task-modal textarea {
                    width: 90% !important;
                    max-width: 90% !important;
                }
                
                /* ã•ã‚‰ã«å¼·åŠ›ãªæŒ‡å®š - ã™ã¹ã¦ã®Tailwindã‚¯ãƒ©ã‚¹ã‚’ä¸Šæ›¸ã */
                #task-modal form input[style*="width"],
                #task-modal form select[style*="width"],  
                #task-modal form textarea[style*="width"] {
                    width: 90% !important;
                    max-width: 90% !important;
                }
                
                /* Tailwindã‚¯ãƒ©ã‚¹ã‚’ç¢ºå®Ÿã«ä¸Šæ›¸ã */
                div#task-modal input.w-full,
                div#task-modal select.w-full,
                div#task-modal textarea.w-full {
                    width: 90% !important;
                    max-width: 90% !important;
                }
                
                /* ç‰¹å®šã®è¦ç´ IDã‚‚å¯¾è±¡ã« */
                #task-title, #task-deadline, #task-priority, #task-scheduled, 
                #task-client, #task-estimated-hours, #task-description {
                    width: 90% !important;
                    max-width: 90% !important;
                }
                
                /* iframe-wrapperè¦ç´ ã®å¹…ã‚’90%ã«è¨­å®š */
                .iframe-wrapper.width-full[data-v-4b72419c] {
                    width: 90% !important;
                }
                
                /* ã‚ˆã‚Šæ±ç”¨çš„ãªiframe-wrapperå¯¾å¿œ */
                .iframe-wrapper.width-full,
                .iframe-wrapper[class*="width-full"] {
                    width: 90% !important;
                }
                
                /* ã‚°ãƒªãƒƒãƒ‰è¦ç´ ã‚‚é©åˆ‡ã«é…ç½® */
                #task-modal .space-y-4 .grid {
                    gap: 1rem !important;
                }
            }
            
            /* å¤§ç”»é¢ã§ã¯å…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å°‘ã—åºƒã’ã‚‹ */
            @media screen and (min-width: 1200px) {
                #task-modal .space-y-4,
                #task-modal form > div {
                    max-width: 700px !important;
                }
            }
                
                /* å°ã€œä¸­ç”»é¢PCè¡¨ç¤ºã§ã®ãƒ©ãƒ™ãƒ«è¦‹ã‚„ã™ã•æ”¹å–„ */
                #task-modal label {
                    font-weight: 600 !important;
                    margin-bottom: 8px !important;
                    color: #374151 !important;
                }
                
                /* å°ã€œä¸­ç”»é¢PCè¡¨ç¤ºã§ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¦‹ãŸç›®æ”¹å–„ */
                #task-modal input, #task-modal select, #task-modal textarea {
                    padding: 10px 14px !important;
                    font-size: 14px !important;
                    border-radius: 6px !important;
                    border: 2px solid #e5e7eb !important;
                    transition: all 0.2s ease-in-out !important;
                }
                
                /* å°ã€œä¸­ç”»é¢ã§ã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³çŸ¢å°ã®é‡è¤‡è¡¨ç¤ºå•é¡Œã‚’è§£æ±º */
                #task-modal select {
                    appearance: none !important;
                    -webkit-appearance: none !important;
                    -moz-appearance: none !important;
                    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e") !important;
                    background-position: right 10px center !important;
                    background-repeat: no-repeat !important;
                    background-size: 14px 14px !important;
                    padding-right: 36px !important;
                }
                
                /* é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«ã®selectè¦ç´ ã®çŸ¢å°çµ±ä¸€ */
                #client-modal select {
                    appearance: none !important;
                    -webkit-appearance: none !important;
                    -moz-appearance: none !important;
                    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e") !important;
                    background-position: right 10px center !important;
                    background-repeat: no-repeat !important;
                    background-size: 14px 14px !important;
                    padding-right: 36px !important;
                }
                
                #task-modal input:focus, #task-modal select:focus, #task-modal textarea:focus {
                    border-color: #3b82f6 !important;
                    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
                    outline: none !important;
                }
            }
            
            /* å¤§ç”»é¢PCè¡¨ç¤ºã§ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
            @media screen and (min-width: 1201px) {
                /* å¤§ç”»é¢ã§ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°èª¿æ•´ */
                #task-modal form {
                    padding: 50px !important;
                }
                
                /* å¤§ç”»é¢ã§ã®è¦ç´ é–“éš”èª¿æ•´ */
                #task-modal .space-y-4 > * + * {
                    margin-top: 2rem !important;
                }
                
                /* å¤§ç”»é¢ã§ã®ãƒ©ãƒ™ãƒ«èª¿æ•´ */
                #task-modal label {
                    font-size: 15px !important;
                    margin-bottom: 10px !important;
                }
                
                /* å¤§ç”»é¢ã§ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æ•´ */
                #task-modal input, #task-modal select, #task-modal textarea {
                    padding: 14px 18px !important;
                    font-size: 15px !important;
                }
                
                /* å¤§ç”»é¢ã§ã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³çŸ¢å°èª¿æ•´ */
                #task-modal select {
                    padding-right: 44px !important;
                    background-position: right 14px center !important;
                    background-size: 18px 18px !important;
                }
            }
            
            /* PCè¡¨ç¤ºã§ã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆçµ±ä¸€ */
            @media screen and (min-width: 769px) {
                #task-modal .space-y-4 .grid {
                    grid-template-columns: 1fr 1fr !important;
                    gap: 1rem !important;
                    width: 100% !important;
                }
            }
            
            /* å¤§ç”»é¢ã§ã¯ã‚°ãƒªãƒƒãƒ‰ã®ã‚®ãƒ£ãƒƒãƒ—ã‚’åºƒã’ã‚‹ */
            @media screen and (min-width: 1200px) {
                #task-modal .space-y-4 .grid {
                    gap: 1.5rem !important;
                }
            }
            
            /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã§ã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
            @media screen and (min-width: 641px) and (max-width: 768px) {
                #task-modal .grid {
                    gap: 1rem !important;
                    grid-template-columns: 1fr 1fr !important;
                }
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯ã‚°ãƒªãƒƒãƒ‰ã‚’1åˆ—ã« */
            @media screen and (max-width: 640px) {
                #task-modal .grid {
                    gap: 1rem !important;
                    grid-template-columns: 1fr !important;
                }
            }
            
            /* ğŸ¨ ãƒ¢ãƒ¼ãƒ€ãƒ«è¦–èªæ€§å‘ä¸Š */
            #task-modal .bg-white, #client-modal .bg-white {
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4) !important;
                border: 1px solid rgba(255, 255, 255, 0.2) !important;
            }
            
            /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ã®ã‚·ãƒ£ãƒ‰ã‚¦åŠ¹æœ */
            #task-modal .border-b, #client-modal .border-b {
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
            }
            
            #task-modal .border-t, #client-modal .border-t {
                box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.1) !important;
            }
            
            /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ï¼ˆWebkitç³»ï¼‰ */
            #task-modal form::-webkit-scrollbar, #client-modal form::-webkit-scrollbar {
                width: 6px;
            }
            
            #task-modal form::-webkit-scrollbar-track, #client-modal form::-webkit-scrollbar-track {
                background: #f1f5f9;
            }
            
            #task-modal form::-webkit-scrollbar-thumb, #client-modal form::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 3px;
            }
            
            #task-modal form::-webkit-scrollbar-thumb:hover, #client-modal form::-webkit-scrollbar-thumb:hover {
                background: #94a3b8;
            }
            
            /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹çŠ¶æ…‹ã®æ”¹å–„ */
            #task-modal input:focus, #task-modal select:focus, #task-modal textarea:focus,
            #client-modal input:focus, #client-modal select:focus, #client-modal textarea:focus {
                border-color: #3b82f6 !important;
                outline: 2px solid #3b82f6 !important;
                outline-offset: 2px !important;
            }
            
            /* ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼ãƒ»ãƒ•ã‚©ãƒ¼ã‚«ã‚¹åŠ¹æœå‘ä¸Š */
            #task-modal button:hover, #client-modal button:hover {
                transform: translateY(-1px) !important;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            }
            
            #task-modal button:active, #client-modal button:active {
                transform: translateY(0) !important;
            }
            
            /* ã‚¿ãƒ–ã”ã¨ã®æ¤œç´¢ãƒãƒ¼è¡¨ç¤ºåˆ¶å¾¡ - ã‚ˆã‚Šç¢ºå®Ÿãªæ–¹æ³• */
            
            /* ã‚¬ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¯æœ€åˆã‹ã‚‰éè¡¨ç¤º */
            .gantt-filters {
                display: none;
            }
            
            /* éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§æ¤œç´¢ãƒãƒ¼ã‚’å¼·åˆ¶éè¡¨ç¤º */
            .tab-content.hidden .gantt-filters,
            .tab-content.hidden #search-input,
            .tab-content.hidden #gantt-search-input {
                display: none !important;
                visibility: hidden !important;
                position: absolute !important;
                left: -9999px !important;
            }
            
            /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ã‚¹ã‚¯ãƒ“ãƒ¥ãƒ¼ã§é©åˆ‡ãªæ¤œç´¢ãƒãƒ¼ã‚’è¡¨ç¤º */
            #tasks-view:not(.hidden) #search-input {
                display: block !important;
                visibility: visible !important;
                position: static !important;
                left: auto !important;
            }
            
            /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¬ãƒ³ãƒˆãƒ“ãƒ¥ãƒ¼ã§é©åˆ‡ãªæ¤œç´¢ãƒãƒ¼ã‚’è¡¨ç¤º */
            #gantt-view:not(.hidden) .gantt-filters {
                display: flex !important;
                visibility: visible !important;
                position: static !important;
                left: auto !important;
            }
            
            /* å„ãƒ“ãƒ¥ãƒ¼ã§ä¸è¦ãªæ¤œç´¢ãƒãƒ¼ã‚’å®Œå…¨ã«éš ã™ */
            #tasks-view:not(.hidden) .gantt-filters {
                display: none !important;
            }
            
            #gantt-view:not(.hidden) #search-input {
                display: none !important;
            }
            
            /* z-indexã®é©åˆ‡ãªéšå±¤è¨­å®š */
            .gantt-filters {
                position: relative;
                z-index: 10;
            }
            
            #tasks-view {
                position: relative;
                z-index: 5;
            }
            
            #gantt-view {
                position: relative;
                z-index: 5;
            }
            
            /* æ¤œç´¢ãƒãƒ¼ã®é‡ãªã‚Šé˜²æ­¢ */
            #search-input, #gantt-search-input {
                position: relative;
                z-index: 1;
            }
            
            /* ãƒ•ã‚©ãƒ¼ãƒ é–“éš”ã®ãƒ¢ãƒã‚¤ãƒ«èª¿æ•´ */
            #task-form .space-y-4 > *, #client-form .space-y-4 > * {
                margin-bottom: 16px !important;
            }
            
            /* ãƒ©ãƒ™ãƒ«ã®ãƒ¢ãƒã‚¤ãƒ«èª¿æ•´ */
            label.block {
                font-size: 15px !important;
                font-weight: 600 !important;
                margin-bottom: 8px !important;
            }
            
            /* ãƒœã‚¿ãƒ³ã®ã‚¿ãƒƒãƒæ“ä½œæ€§å‘ä¸Š */
            #task-modal button, #client-modal button {
                min-height: 44px !important;
                padding: 12px 20px !important;
                font-size: 16px !important;
                border-radius: 8px !important;
                margin: 4px !important;
            }
            
            /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®çŸ¢å°ã‚¢ã‚¤ã‚³ãƒ³å¾©æ´»ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰ */
            select {
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e") !important;
                background-position: right 12px center !important;
                background-repeat: no-repeat !important;
                background-size: 16px !important;
                padding-right: 40px !important;
            }
            
            /* è¶…å°ç”»é¢ï¼ˆ360pxä»¥ä¸‹ï¼‰ã§ã®ç‰¹åˆ¥èª¿æ•´ */
            @media screen and (max-width: 360px) {
                #task-modal .bg-white, #client-modal .bg-white {
                    max-width: calc(100vw - 10px) !important;
                    width: calc(100vw - 10px) !important;
                    margin: 5px !important;
                    max-height: calc(100vh - 20px) !important;
                }
                
                #task-modal .p-6, #client-modal .p-6 {
                    padding: 12px !important;
                }
                
                input[type="text"], input[type="date"], input[type="datetime-local"], 
                input[type="number"], input[type="email"], input[type="tel"], 
                select, textarea {
                    padding: 10px 12px !important;
                }
                
                #task-modal button, #client-modal button {
                    padding: 10px 16px !important;
                    font-size: 15px !important;
                }
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼èª¿æ•´ (2è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¯¾å¿œ) */
            @media screen and (max-width: 640px) {
                /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆç”¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ (æ–°2è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ) */
                #gantt-view:not(.hidden) .gantt-filters {
                    padding: 12px !important;
                    gap: 8px !important;
                }
                
                /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆæ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ãƒ©ãƒ™ãƒ« */
                #gantt-view:not(.hidden) .gantt-filters label {
                    font-size: 12px !important;
                    margin-bottom: 4px !important;
                }
                
                /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆå…¥åŠ›è¦ç´ ã®ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ– */
                #gantt-view:not(.hidden) .gantt-filters input, 
                #gantt-view:not(.hidden) .gantt-filters select {
                    width: 100% !important;
                    min-width: unset !important;
                    padding: 8px !important;
                    font-size: 14px !important;
                    min-height: 40px !important;
                    height: 40px !important;
                }
                
                /* ã‚¬ãƒ³ãƒˆã‚¨ãƒªã‚¢ã®selectè¦ç´ ã®çŸ¢å°çµ±ä¸€ */
                #gantt-view:not(.hidden) .gantt-filters select {
                    appearance: none !important;
                    -webkit-appearance: none !important;
                    -moz-appearance: none !important;
                    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e") !important;
                    background-position: right 10px center !important;
                    background-repeat: no-repeat !important;
                    background-size: 14px 14px !important;
                    padding-right: 32px !important;
                }
                
                /* ã‚¿ã‚¹ã‚¯ç®¡ç†ç”»é¢ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ (æ–°2è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ) */
                .bg-white.rounded-lg.shadow-sm.border {
                    padding: 16px !important;
                }
                
                /* ã‚¿ã‚¹ã‚¯ç®¡ç†ç”»é¢ã®ãƒ©ãƒ™ãƒ«èª¿æ•´ */
                .bg-white.rounded-lg.shadow-sm.border label {
                    font-size: 12px !important;
                    margin-bottom: 4px !important;
                }
                
                /* ã‚¿ã‚¹ã‚¯ç®¡ç†ç”»é¢ã®å…¥åŠ›è¦ç´  */
                .bg-white.rounded-lg.shadow-sm.border input,
                .bg-white.rounded-lg.shadow-sm.border select {
                    min-height: 40px !important;
                    height: 40px !important;
                    font-size: 14px !important;
                    padding: 8px 12px !important;
                }
                
                /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å‘¨ã‚Šã®èª¿æ•´ */
                #gantt-show-subtasks {
                    width: 16px !important;
                    height: 16px !important;
                    margin-right: 6px !important;
                }
                
                /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ãƒ©ãƒ™ãƒ«ä½ç½®èª¿æ•´ */
                .flex.items-end {
                    align-items: flex-start !important;
                    padding-top: 20px;
                }
                
                .bg-white.rounded-lg.shadow-sm.border input,
                .bg-white.rounded-lg.shadow-sm.border select {
                    width: 100% !important;
                    padding: 6px 8px !important;
                    font-size: 14px !important;
                    min-height: 36px !important;
                    height: 36px !important;
                }
                
                /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆæœˆé¸æŠãƒœã‚¿ãƒ³ã‚‚ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
                .gantt-controls button {
                    padding: 6px 12px !important;
                    font-size: 14px !important;
                    height: 36px !important;
                }
                
                .gantt-controls .text-lg {
                    font-size: 16px !important;
                }
                
                /* PCè¡¨ç¤ºã§ã®æœˆé¸æŠãƒœã‚¿ãƒ³ã‚µã‚¤ã‚ºèª¿æ•´ */
                .gantt-navigation .gantt-controls button {
                    padding: 4px 10px !important;
                    font-size: 12px !important;
                    height: 32px !important;
                }
                
                .gantt-navigation .gantt-controls .text-lg {
                    font-size: 14px !important;
                }
                
                /* ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
                .gantt-navigation {
                    padding: 6px 12px !important;
                    min-height: auto !important;
                }
                
                .gantt-navigation .flex.items-center.gap-4 {
                    gap: 6px !important;
                }
                
                /* ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã®ã€Œä»Šæ—¥ã¸ã€ãƒœã‚¿ãƒ³çµ±ä¸€ */
                #gantt-today-month {
                    padding: 4px 8px !important;
                    font-size: 12px !important;
                    height: 32px !important;
                    background-color: #f3f4f6 !important;
                    color: #374151 !important;
                    border: 1px solid #d1d5db !important;
                    border-radius: 6px !important;
                    box-sizing: border-box !important;
                    display: inline-flex !important;
                    align-items: center !important;
                    justify-content: center !important;
                }
                
                #gantt-today-month:hover {
                    background-color: #e5e7eb !important;
                }
                
                /* ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã®å‰æœˆãƒ»æ¬¡æœˆãƒœã‚¿ãƒ³ã‚‚åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ã«çµ±ä¸€ */
                #gantt-prev-month, #gantt-next-month {
                    padding: 4px 8px !important;
                    font-size: 12px !important;
                    height: 32px !important;
                    background-color: #f3f4f6 !important;
                    color: #374151 !important;
                    border: 1px solid #d1d5db !important;
                    border-radius: 6px !important;
                    box-sizing: border-box !important;
                    display: inline-flex !important;
                    align-items: center !important;
                    justify-content: center !important;
                }
                
                #gantt-prev-month:hover, #gantt-next-month:hover {
                    background-color: #e5e7eb !important;
                }
                
                /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ã‚µã‚¤ã‚ºèª¿æ•´ */
                input[type="checkbox"] {
                    width: 16px !important;
                    height: 16px !important;
                    margin-right: 6px !important;
                }
                
                /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */
                #gantt-show-subtasks {
                    width: 14px !important;
                    height: 14px !important;
                }
            }
        
        /* è¶…å°ç”»é¢ï¼ˆ320pxä»¥ä¸‹ï¼‰ã§ã®èª¿æ•´ */
        @media screen and (max-width: 360px) {
            .task-item {
                padding: 6px !important;
            }
            
            .task-content {
                margin-left: 8px !important; /* æ¥µå°ç”»é¢ã§ã®é–“éš” */
            }
            
            .task-title {
                font-size: 12px !important;
                line-height: 1.2 !important;
            }
            
            .task-meta {
                font-size: 9px !important;
                gap: 2px;
            }
            
            .task-client {
                max-width: 80px;
                font-size: 9px !important;
            }
            
            .task-actions button {
                width: 24px !important;
                height: 24px !important;
                font-size: 10px !important;
            }
            
            .task-actions {
                gap: 2px;
                margin-left: 1px;
            }
            
            /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ç¸¦ãƒœã‚¿ãƒ³é…ç½®ã‚’é€†é †ã§ç¶­æŒ */
            .flex.justify-end.space-x-3 {
                flex-direction: column-reverse !important;
            }
        }
        
        /* ğŸ¯ ã‚¬ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ã®ã‚·ãƒ³ãƒ—ãƒ«è¨­å®š */
        .gantt-filters {
            position: static !important;
            z-index: auto !important;
            overflow: visible !important;
        }
        
        /* ã‚¬ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å†…ã®è¦ç´ ã®åŸºæœ¬è¨­å®š */
        .gantt-filters input,
        .gantt-filters select {
            position: relative !important;
            z-index: auto !important;
            min-height: 38px !important; /* selectè¦ç´ ã¨åŒã˜é«˜ã•ã«çµ±ä¸€ */
        }
        
        /* ã‚¿ã‚¹ã‚¯æ¤œç´¢å…¥åŠ›ã‚’selectè¦ç´ ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ã«çµ±ä¸€ */
        .gantt-filters input[type="text"] {
            height: 38px !important;
            box-sizing: border-box !important;
            line-height: 1.5 !important;
            font-size: 14px !important;
        }
        
        /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®èª¿æ•´ */
        .gantt-filters .grid {
            align-items: end !important;
        }
        
        /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹è¦ç´ ã®èª¿æ•´ */
        .gantt-filters label:has(input[type="checkbox"]) {
            padding-top: 1.75rem; /* ãƒ©ãƒ™ãƒ«åˆ†ã®é«˜ã•ã‚’èª¿æ•´ */
        }
        
        /* ã‚¬ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
        @media screen and (max-width: 640px) {
            .gantt-filters .grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
        }
        
        @media screen and (min-width: 641px) and (max-width: 1023px) {
            .gantt-filters .grid {
                grid-template-columns: 1fr 1fr !important;
            }
            
            /* æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’1è¡Œç›®å…¨ä½“ã« */
            .gantt-filters .grid > div:nth-child(1) {
                grid-column: 1 / -1 !important;
                margin-bottom: 0.5rem !important;
            }
            
            /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’3è¡Œç›®å…¨ä½“ã« */
            .gantt-filters .grid > div:nth-child(4) {
                grid-column: 1 / -1 !important;
                justify-self: start !important;
                margin-top: 1rem !important;
            }
        }
        
        /* ğŸ¯ ã‚¿ã‚¹ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ã®å®‰å®šåŒ– */
        #tasks-view .grid {
            overflow: visible !important;
        }
        
        #tasks-view .grid > div {
            min-width: 0 !important; /* ã‚°ãƒªãƒƒãƒ‰ã‚¢ã‚¤ãƒ†ãƒ ã®ç¸®å°ã‚’è¨±å¯ */
        }
        
        #tasks-view select,
        #tasks-view input[type="text"] {
            min-width: 120px !important; /* æœ€å°å¹…ã‚’ä¿è¨¼ */
            max-width: 90% !important;
        }
        
        /* å…¨selectè¦ç´ ã®çŸ¢å°çµ±ä¸€ï¼ˆæœ€é«˜å„ªå…ˆåº¦è¨­å®šï¼‰ */
        select[class*="w-full"],
        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çµ±ä¸€ã‚¹ã‚¿ã‚¤ãƒ« */
        #search-input,
        #filter-status,
        #filter-priority,
        #filter-client {
            height: 38px !important; /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã®çµ±ä¸€é«˜ã• */
            min-height: 38px !important;
            padding: 8px 12px !important;
            font-size: 14px !important;
            line-height: 1.4 !important;
            box-sizing: border-box !important;
        }
        
        select[id*="filter"],
        select[id*="gantt"],
        select,
        *[style*="pointer-events"] select {
            appearance: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e") !important;
            background-position: right 10px center !important;
            background-repeat: no-repeat !important;
            background-size: 14px 14px !important;
            padding-right: 36px !important;
        }
        
        /* ã‚¿ã‚¹ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
        @media screen and (max-width: 640px) {
            #tasks-view .grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            
            /* æ¤œç´¢å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ã‚µã‚¤ã‚ºçµ±ä¸€ */
            #search-input,
            #filter-status,
            #filter-priority,
            #filter-client {
                height: 42px !important; /* çµ±ä¸€ã•ã‚ŒãŸé«˜ã• */
                min-height: 42px !important;
                padding: 8px 12px !important; /* çµ±ä¸€ã•ã‚ŒãŸãƒ‘ãƒ‡ã‚£ãƒ³ã‚° */
                font-size: 14px !important; /* çµ±ä¸€ã•ã‚ŒãŸãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
                line-height: 1.4 !important;
                box-sizing: border-box !important;
            }
            
            /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®çŸ¢å°ã‚¢ã‚¤ã‚³ãƒ³èª¿æ•´ */
            #filter-status,
            #filter-priority,
            #filter-client {
                padding-right: 36px !important; /* çŸ¢å°ã‚¢ã‚¤ã‚³ãƒ³åˆ†ã®ã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿ */
            }
        }
        
        @media screen and (min-width: 641px) and (max-width: 1023px) {
            #tasks-view .grid {
                grid-template-columns: 1fr 1fr !important;
            }
            
            /* æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’1è¡Œç›®å…¨ä½“ã« */
            #tasks-view .grid > div:first-child {
                grid-column: 1 / -1 !important;
            }
            
            /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã§ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚µã‚¤ã‚ºèª¿æ•´ */
            #search-input,
            #filter-status,
            #filter-priority,
            #filter-client {
                height: 40px !important;
                min-height: 40px !important;
                padding: 8px 12px !important;
                font-size: 14px !important;
            }
        }
        
        @media screen and (min-width: 1024px) {
            #tasks-view .grid {
                grid-template-columns: 1fr 1fr 1fr 1fr !important;
            }
        }
        
        /* ğŸ¯ iframe-wrapperè¦ç´ ã®å¹…ã‚’90%ã«è¨­å®šï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«é©ç”¨ï¼‰ */
        .iframe-wrapper.width-full[data-v-4b72419c] {
            width: 90% !important;
        }
        
        /* ã‚ˆã‚Šæ±ç”¨çš„ãªiframe-wrapperå¯¾å¿œ */
        .iframe-wrapper.width-full,
        .iframe-wrapper[class*="width-full"] {
            width: 90% !important;
        }
        
        /* Vue.jsã®ã‚¹ã‚³ãƒ¼ãƒ—CSSã‚‚å¯¾è±¡ */
        [data-v-4b72419c].iframe-wrapper.width-full {
            width: 90% !important;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <!-- ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30">
            <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center h-16 main-header overflow-hidden">
                    <div class="flex items-center flex-shrink-0 header-logo mr-2">
                        <i class="fas fa-tasks text-blue-600 text-xl mr-2"></i>
                        <h1 class="text-lg font-bold text-gray-900 header-title hidden sm:block">TaskFlow Pro</h1>
                    </div>
                    
                    <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                    <div class="flex justify-end flex-1 min-w-0 tab-navigation overflow-hidden">
                        <div class="grid grid-cols-5 w-full min-w-0 gap-1 sm:gap-4 tab-grid">
                            <button class="tab-button border-b-2 border-transparent p-3 text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 active flex flex-col items-center justify-center min-h-[48px]" data-tab="tasks" style="touch-action: manipulation;">
                                <i class="fas fa-list text-lg mb-1"></i>
                                <span class="text-xs leading-none"><span class="hidden sm:inline">ã‚¿ã‚¹ã‚¯</span><span class="sm:hidden">ã‚¿ã‚¹ã‚¯</span></span>
                            </button>
                            <button class="tab-button border-b-2 border-transparent p-3 text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 flex flex-col items-center justify-center min-h-[48px]" data-tab="gantt" style="touch-action: manipulation;">
                                <i class="fas fa-chart-gantt text-lg mb-1"></i>
                                <span class="text-xs leading-none"><span class="hidden sm:inline">ã‚¬ãƒ³ãƒˆ</span><span class="sm:hidden">ã‚¬ãƒ³ãƒˆ</span></span>
                            </button>
                            <button class="tab-button border-b-2 border-transparent p-3 text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 flex flex-col items-center justify-center min-h-[48px]" data-tab="clients" style="touch-action: manipulation;">
                                <i class="fas fa-users text-lg mb-1"></i>
                                <span class="text-xs leading-none"><span class="hidden sm:inline">é¡§å®¢</span><span class="sm:hidden">é¡§å®¢</span></span>
                            </button>
                            <button class="tab-button border-b-2 border-transparent p-3 text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 flex flex-col items-center justify-center min-h-[48px]" data-tab="reports" style="touch-action: manipulation;">
                                <i class="fas fa-chart-bar text-lg mb-1"></i>
                                <span class="text-xs leading-none"><span class="hidden sm:inline">ãƒ¬ãƒãƒ¼ãƒˆ</span><span class="sm:hidden">åˆ†æ</span></span>
                            </button>
                            <button class="tab-button border-b-2 border-transparent p-3 text-xs sm:text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 flex flex-col items-center justify-center min-h-[48px]" data-tab="settings" style="touch-action: manipulation;">
                                <i class="fas fa-cog text-lg mb-1"></i>
                                <span class="text-xs leading-none"><span class="hidden sm:inline">è¨­å®š</span><span class="sm:hidden">è¨­å®š</span></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ã‚¿ã‚¹ã‚¯ç®¡ç†ç”»é¢ -->
        <div id="tasks-view" class="tab-content">
            <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢ã‚¨ãƒªã‚¢ -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 mb-6">
                    <!-- çµ±ä¸€ã•ã‚ŒãŸã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                        <!-- æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
                        <div>
                            <label for="search-input" class="block text-sm font-medium text-gray-700 mb-2">ã‚¿ã‚¹ã‚¯æ¤œç´¢</label>
                            <input type="text" id="search-input" placeholder="ã‚¿ã‚¹ã‚¯ã‚’æ¤œç´¢..." 
                                   class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                        </div>
                        
                        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
                        <div>
                            <label for="filter-status" class="block text-sm font-medium text-gray-700 mb-2">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                            <select id="filter-status" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                                <option value="">å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
                                <option value="active">æœªç€æ‰‹ã¨é€²è¡Œä¸­ã®ã¿</option>
                                <option value="pending">æœªç€æ‰‹</option>
                                <option value="in_progress">é€²è¡Œä¸­</option>
                                <option value="completed">å®Œäº†</option>
                            </select>
                        </div>
                        
                        <!-- å„ªå…ˆåº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
                        <div>
                            <label for="filter-priority" class="block text-sm font-medium text-gray-700 mb-2">å„ªå…ˆåº¦</label>
                            <select id="filter-priority" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                                <option value="">å…¨å„ªå…ˆåº¦</option>
                                <option value="high">é«˜</option>
                                <option value="medium">ä¸­</option>
                                <option value="low">ä½</option>
                            </select>
                        </div>
                        
                        <!-- é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
                        <div>
                            <label for="filter-client" class="block text-sm font-medium text-gray-700 mb-2">é¡§å®¢</label>
                            <select id="filter-client" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                                <option value="">å…¨é¡§å®¢</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ -->
                <div id="tasks-container" class="space-y-4">
                    <!-- ã‚¿ã‚¹ã‚¯ãŒã“ã“ã«å‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </div>

            <!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <button id="add-task-btn" class="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg ios-tap pulse-effect z-20">
                <i class="fas fa-plus text-xl"></i>
            </button>
        </div>

        <!-- ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆç”»é¢ -->
        <div id="gantt-view" class="tab-content hidden">
            <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                    <div class="flex flex-col gap-4 mb-4">
                        <div class="flex justify-between items-center">
                            <h2 class="text-lg font-semibold text-gray-900">ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ</h2>
                            <div class="flex items-center gap-2">
                                <button id="gantt-prev-month" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-md text-sm">
                                    <i class="fas fa-chevron-left"></i> å‰æœˆ
                                </button>
                                <button id="gantt-today-month" class="px-3 py-1 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-md text-sm">
                                    <i class="fas fa-calendar-day mr-1"></i>ä»Šæ—¥ã¸
                                </button>
                                <span id="gantt-current-month" class="text-lg font-medium text-gray-700 mx-2"></span>
                                <button id="gantt-next-month" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-md text-sm">
                                    æ¬¡æœˆ <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆç”¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
                        <div class="gantt-filters mt-4 pt-4 border-t border-gray-200">
                            <!-- çµ±ä¸€ã•ã‚ŒãŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ -->
                            <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 items-end">
                                <div class="lg:col-span-1">
                                    <label for="gantt-search-input" class="block text-sm font-medium text-gray-700 mb-2">ã‚¿ã‚¹ã‚¯æ¤œç´¢</label>
                                    <input type="text" id="gantt-search-input" placeholder="ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆå†…ã§ã‚¿ã‚¹ã‚¯ã‚’æ¤œç´¢..." 
                                           class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                                </div>
                                <div class="lg:col-span-1">
                                    <label for="gantt-filter-client" class="block text-sm font-medium text-gray-700 mb-2">é¡§å®¢</label>
                                    <select id="gantt-filter-client" 
                                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                                        <option value="">å…¨é¡§å®¢</option>
                                    </select>
                                </div>
                                <div class="lg:col-span-1">
                                    <label for="gantt-filter-status" class="block text-sm font-medium text-gray-700 mb-2">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                                    <select id="gantt-filter-status" 
                                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                                        <option value="">å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
                                        <option value="active">æœªç€æ‰‹ã¨é€²è¡Œä¸­ã®ã¿</option>
                                        <option value="pending">æœªç€æ‰‹</option>
                                        <option value="in_progress">é€²è¡Œä¸­</option>
                                        <option value="completed">å®Œäº†</option>
                                    </select>
                                </div>
                                <div class="lg:col-span-1 flex items-center justify-start lg:justify-center">
                                    <label class="flex items-center text-sm text-gray-600 whitespace-nowrap">
                                        <input type="checkbox" id="gantt-show-subtasks" class="mr-2 rounded" checked>
                                        ã‚µãƒ–ã‚¿ã‚¹ã‚¯è¡¨ç¤º
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="gantt-container" class="gantt-container">
                        <!-- ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- é¡§å®¢ç®¡ç†ç”»é¢ -->
        <div id="clients-view" class="tab-content hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">é¡§å®¢ç®¡ç†</h2>
                    <button id="add-client-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 ios-tap">
                        <i class="fas fa-plus"></i>æ–°è¦é¡§å®¢
                    </button>
                </div>

                <!-- é¡§å®¢ãƒªã‚¹ãƒˆè¡¨ç¤º -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é¡§å®¢å</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ‹…å½“è€…</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é€£çµ¡å…ˆ</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ã‚¿ã‚¹ã‚¯</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">å®Œäº†</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">æ™‚é–“</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="clients-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«å‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                            </tbody>
                        </table>
                    </div>
                    <div id="clients-empty-state" class="hidden text-center py-12 text-gray-500">
                        <i class="fas fa-users text-4xl mb-4"></i>
                        <p class="text-lg">é¡§å®¢ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                        <p class="text-sm">æ–°ã—ã„é¡§å®¢ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ¬ãƒãƒ¼ãƒˆç”»é¢ -->
        <div id="reports-view" class="tab-content hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <h2 class="text-xl font-bold text-gray-900 mb-4">ãƒ¬ãƒãƒ¼ãƒˆãƒ»åˆ†æ</h2>
                
                <!-- çµ±è¨ˆã‚µãƒãƒªãƒ¼ -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
                    <div class="stats-card">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-tasks text-blue-600 text-sm"></i>
                            </div>
                            <div class="ml-2">
                                <p class="text-xs font-medium text-gray-500">ç·ã‚¿ã‚¹ã‚¯æ•°</p>
                                <p id="total-tasks" class="text-sm font-semibold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-check-circle text-green-600 text-sm"></i>
                            </div>
                            <div class="ml-2">
                                <p class="text-xs font-medium text-gray-500">å®Œäº†ã‚¿ã‚¹ã‚¯</p>
                                <p id="completed-tasks" class="text-sm font-semibold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-clock text-orange-600 text-sm"></i>
                            </div>
                            <div class="ml-2">
                                <p class="text-xs font-medium text-gray-500">ç·ä½œæ¥­æ™‚é–“</p>
                                <p id="total-hours" class="text-sm font-semibold text-gray-900">0h</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-users text-purple-600 text-sm"></i>
                            </div>
                            <div class="ml-2">
                                <p class="text-xs font-medium text-gray-500">é¡§å®¢æ•°</p>
                                <p id="total-clients" class="text-sm font-semibold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ãƒãƒ£ãƒ¼ãƒˆ -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                        <h3 class="text-sm font-semibold text-gray-900 mb-3">ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ†å¸ƒ</h3>
                        <div style="height: 200px;">
                            <canvas id="status-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                        <h3 class="text-sm font-semibold text-gray-900 mb-3">å„ªå…ˆåº¦åˆ¥ã‚¿ã‚¹ã‚¯</h3>
                        <div style="height: 200px;">
                            <canvas id="priority-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                        <h3 class="text-sm font-semibold text-gray-900 mb-3">æœˆåˆ¥ä½œæ¥­æ™‚é–“æ¨ç§»</h3>
                        <div style="height: 200px;">
                            <canvas id="monthly-hours-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- æœˆæ¬¡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆ¥ãƒ¬ãƒãƒ¼ãƒˆ -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 space-y-2 sm:space-y-0">
                        <h3 class="text-sm font-semibold text-gray-900">æœˆæ¬¡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆ¥ä½œæ¥­æ™‚é–“</h3>
                        <div class="flex items-center space-x-2">
                            <select id="report-year" class="px-2 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </select>
                            <select id="report-month" class="px-2 py-1 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="1">1æœˆ</option>
                                <option value="2">2æœˆ</option>
                                <option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option>
                                <option value="5">5æœˆ</option>
                                <option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option>
                                <option value="8">8æœˆ</option>
                                <option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12">12æœˆ</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆ¥æ™‚é–“ã‚µãƒãƒªãƒ¼ -->
                    <div id="client-monthly-summary" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mb-4">
                    </div>
                    
                    <!-- è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ« -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ã‚¿ã‚¹ã‚¯å</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ä½œæ¥­æ™‚é–“</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æœ€çµ‚æ›´æ–°</th>
                                </tr>
                            </thead>
                            <tbody id="monthly-report-table" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¨­å®šç”»é¢ -->
        <div id="settings-view" class="tab-content hidden">
            <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">è¨­å®š</h2>
                
                <!-- ğŸ”¥ Firebase ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸè¨­å®š -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-cloud mr-2 text-orange-600"></i>
                        Firebase ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ
                        <span id="firebase-status" class="sync-status ml-2">ğŸŸ¡</span>
                    </h3>
                    <div class="space-y-4">
                        <!-- Googleèªè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                        <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-medium text-blue-800">ğŸ” Googleèªè¨¼</label>
                                    <p class="text-sm text-blue-600">å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿åŒæœŸ</p>
                                </div>
                                <div id="google-auth-status" class="text-2xl">ğŸ”´</div>
                            </div>
                            <div id="google-user-info" class="hidden mb-3">
                                <div class="flex items-center space-x-3">
                                    <img id="user-photo" class="w-8 h-8 rounded-full" alt="User">
                                    <div>
                                        <div id="user-name" class="text-sm font-medium"></div>
                                        <div id="user-email" class="text-xs text-gray-600"></div>
                                    </div>
                                </div>
                            </div>
                            <button id="google-signin-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">
                                <i class="fab fa-google mr-2"></i>Googleã§ãƒ­ã‚°ã‚¤ãƒ³
                            </button>
                            <button id="google-signout-btn" class="hidden w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md text-sm mt-2">
                                <i class="fas fa-sign-out-alt mr-2"></i>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                            </button>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium text-gray-700">FirebaseåŒæœŸ</label>
                                <p class="text-sm text-gray-500">Googleèªè¨¼å¾Œã«è‡ªå‹•æœ‰åŠ¹åŒ–</p>
                            </div>
                            <label class="toggle-switch disabled">
                                <input type="checkbox" id="firebase-sync-toggle" disabled>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <!-- Firebaseè¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
                        <div id="firebase-config" class="space-y-4 mt-4 p-4 bg-gray-50 rounded-lg border-l-4 border-orange-500">
                            <div class="bg-blue-50 p-3 rounded-md mb-4">
                                <h4 class="text-sm font-medium text-blue-800 mb-1">ğŸ”¥ Firebaseè¨­å®šãŒå¿…è¦</h4>
                                <p class="text-xs text-blue-700 mb-2">Googleèªè¨¼ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ã¾ãšFirebaseè¨­å®šã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚</p>
                                <p class="text-xs text-blue-600">
                                    ğŸ“š <strong>è¨­å®šã§ãŠå›°ã‚Šã®å ´åˆ</strong>: docs/FIREBASE-SETUP.md ã§è©³ç´°ãªæ‰‹é †ã‚’ç¢ºèªã—ã¦ãã ã•ã„
                                </p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Firebase API Key</label>
                                <div class="relative">
                                    <input type="password" id="firebase-api-key" placeholder="AIzaSyC..." 
                                           class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                    <button type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center" onclick="togglePasswordVisibility('firebase-api-key', this)">
                                        <i class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Firebase Console â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š â†’ ã‚¦ã‚§ãƒ–APIã‚­ãƒ¼</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Project ID</label>
                                <input type="text" id="firebase-project-id" placeholder="taskflow-pro-xxxxx" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-orange-500" style="max-width: 100%; box-sizing: border-box;">
                            </div>
                            <div class="flex space-x-2">
                                <button id="firebase-test-btn" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md text-sm">
                                    <i class="fas fa-plug mr-1"></i>æ¥ç¶šãƒ†ã‚¹ãƒˆ
                                </button>
                                <button id="firebase-save-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">
                                    <i class="fas fa-save mr-1"></i>è¨­å®šä¿å­˜
                                </button>
                            </div>
                            <div class="mt-2 space-y-2">
                                <button id="firebase-manual-sync-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm w-full">
                                    <i class="fas fa-sync mr-1"></i>æ‰‹å‹•åŒæœŸå®Ÿè¡Œ
                                </button>
                                <button id="firebase-search-existing-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm w-full">
                                    <i class="fas fa-search mr-1"></i>æ—¢å­˜ãƒ‡ãƒ¼ã‚¿æ¤œç´¢ãƒ»å–å¾—
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-md p-3">
                            <div class="flex items-start">
                                <i class="fas fa-info-circle text-blue-600 mr-2 mt-0.5"></i>
                                <div class="text-sm text-blue-800">
                                    <p><strong>åŒæœŸæ©Ÿèƒ½ã®ç‰¹å¾´ï¼š</strong></p>
                                    <ul class="list-disc list-inside mt-1 space-y-1">
                                        <li>ğŸ“± iPhoneãƒ»iPadãƒ»PCé–“ã§è‡ªå‹•ãƒ‡ãƒ¼ã‚¿åŒæœŸ</li>
                                        <li>ğŸ”„ 30ç§’ã”ã¨ã®è‡ªå‹•æ›´æ–°</li>
                                        <li>ğŸ’¾ ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ + ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</li>
                                        <li>ğŸ†“ å®Œå…¨ç„¡æ–™ï¼ˆè¿½åŠ ã‚³ã‚¹ãƒˆãªã—ï¼‰</li>
                                        <li>ğŸ›¡ï¸ ç«¶åˆè§£æ±ºæ©Ÿèƒ½å†…è”µ</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div id="sync-mode-display" class="text-xs text-gray-600 mt-2 p-2 bg-gray-50 rounded">
                            <span id="sync-mode-text">åŒæœŸãƒ¢ãƒ¼ãƒ‰ç¢ºèªä¸­...</span>
                        </div>
                        
                        <!-- Firebaseæ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
                        <div class="mt-2 p-2 bg-white border border-gray-200 rounded">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">Firebaseæ¥ç¶šçŠ¶æ…‹:</span>
                                <span id="firebase-status" class="text-sm text-gray-500">
                                    <i class="fas fa-circle-notch fa-spin mr-1"></i>åˆæœŸåŒ–ä¸­...
                                </span>
                            </div>
                        </div>
                        
                        <!-- ğŸ”„ æ‰‹å‹•åŒæœŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
                        <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <h4 class="font-semibold text-yellow-800 mb-2">
                                <i class="fas fa-exchange-alt mr-2"></i>æ‰‹å‹•ç«¯æœ«é–“åŒæœŸ
                            </h4>
                            <p class="text-sm text-yellow-700 mb-3">
                                è‡ªå‹•åŒæœŸãŒåˆ©ç”¨ã§ããªã„å ´åˆã®ä»£æ›¿æ‰‹æ®µ
                            </p>
                            <div class="space-y-2">
                                <button id="generate-sync-qr" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded text-sm">
                                    ğŸ“± QRã‚³ãƒ¼ãƒ‰ã§åŒæœŸï¼ˆå®Ÿè£…äºˆå®šï¼‰
                                </button>
                                <div class="text-xs text-yellow-600">
                                    ğŸ’¡ ç¾åœ¨ï¼šè¨­å®š â†’ ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆ ã§æ‰‹å‹•åŒæœŸå¯èƒ½
                                </div>
                            </div>
                        </div>
                        
                        <div id="sync-status-info" class="text-sm text-gray-600">
                            <div class="flex items-center justify-between">
                                <span>æœ€çµ‚åŒæœŸ:</span>
                                <span id="last-sync-time">æœªåŒæœŸ</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Google Calendarçµ±åˆ -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Google Calendarçµ±åˆ</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium text-gray-700">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŒæœŸ</label>
                                <p class="text-sm text-gray-500">ã‚¿ã‚¹ã‚¯ã‚’Google Calendarãƒ»Tasksã¨åŒæœŸã—ã¾ã™ï¼ˆäºˆå®šé–‹å§‹æ—¥æ™‚è¨­å®šæ¸ˆã¿ã‚¿ã‚¹ã‚¯ã®ã¿ï¼‰</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="calendar-sync-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div id="calendar-settings" class="hidden space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Google Calendar API Key</label>
                                <div class="relative">
                                    <input type="password" id="google-api-key" placeholder="AIzaSyC..." 
                                           class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <button type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center" onclick="togglePasswordVisibility('google-api-key', this)">
                                        <i class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Google Cloud Consoleã§Calendar APIãƒ»Tasks APIã‚’æœ‰åŠ¹åŒ–ã—ã€APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¦ãã ã•ã„</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Google Client ID</label>
                                <div class="relative">
                                    <input type="password" id="google-client-id" placeholder="123456789-abc...googleusercontent.com" 
                                           class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <button type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center" onclick="togglePasswordVisibility('google-client-id', this)">
                                        <i class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">OAuth 2.0èªè¨¼ç”¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Calendar ID</label>
                                <input type="text" id="calendar-id" placeholder="primary ã¾ãŸã¯ specific-calendar@gmail.com" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <p class="text-xs text-gray-500 mt-1">ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®å ´åˆã¯ã€Œprimaryã€ã€ç‰¹å®šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®å ´åˆã¯ãã®IDã‚’å…¥åŠ›</p>
                            </div>
                            <div class="flex gap-2">
                                <button id="google-auth-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm">
                                    <i class="fab fa-google mr-2"></i>Googleã§ãƒ­ã‚°ã‚¤ãƒ³
                                </button>
                                <button id="test-calendar-connection" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">
                                    æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ
                                </button>
                                <button id="sync-tasks-to-calendar" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm" disabled>
                                    ã‚¿ã‚¹ã‚¯ã‚’åŒæœŸ
                                </button>
                            </div>
                            
                            <!-- è‡ªå‹•åŒæœŸè¨­å®š -->
                            <div class="mt-4 p-3 bg-gray-50 rounded-md">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700">è‡ªå‹•åŒæœŸ</label>
                                        <p class="text-xs text-gray-500">ã‚¿ã‚¹ã‚¯ã®å¤‰æ›´æ™‚ã«è‡ªå‹•çš„ã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨åŒæœŸã—ã¾ã™</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="auto-sync-toggle" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div id="calendar-status" class="text-sm mt-2"></div>
                        </div>
                    </div>
                </div>



                <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
                    <div class="space-y-4">
                        <div class="flex gap-4">
                            <button id="export-data-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm">
                                <i class="fas fa-download mr-2"></i>ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                            </button>
                            <button id="import-data-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">
                                <i class="fas fa-upload mr-2"></i>ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆå·®åˆ†è¿½åŠ å¯¾å¿œï¼‰
                            </button>
                            <button id="clear-data-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm">
                                <i class="fas fa-trash mr-2"></i>å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                            </button>
                        </div>
                        <input type="file" id="import-file-input" accept=".json" class="hidden">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚¿ã‚¹ã‚¯ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm" onclick="if(event.target === this) app.closeTaskModal()">
        <div class="bg-white rounded-lg shadow-xl">
            <div class="flex justify-between items-center p-6 border-b">
                <h3 id="modal-title" class="text-lg font-semibold text-gray-900">æ–°ã—ã„ã‚¿ã‚¹ã‚¯</h3>
                <button id="close-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="task-form" class="p-6 space-y-4 pb-24">
                <input type="hidden" id="task-id">
                
                <!-- åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="space-y-4">
                    <div>
                        <label for="task-title" class="block text-sm font-medium text-gray-700 mb-1">ã‚¿ã‚¹ã‚¯å *</label>
                        <input type="text" id="task-title" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <!-- æœŸé™ã¨å„ªå…ˆåº¦ã‚’2åˆ—é…ç½® -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="task-deadline" class="block text-sm font-medium text-gray-700 mb-1">æœŸé™ *</label>
                            <input type="date" id="task-deadline" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label for="task-priority" class="block text-sm font-medium text-gray-700 mb-1">å„ªå…ˆåº¦</label>
                            <select id="task-priority"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="low">ä½</option>
                                <option value="medium" selected>ä¸­</option>
                                <option value="high">é«˜</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- é–‹å§‹æ—¥æ™‚ã¨é¡§å®¢ã‚’2åˆ—é…ç½® -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="task-scheduled" class="block text-sm font-medium text-gray-700 mb-1">äºˆå®šé–‹å§‹æ—¥æ™‚</label>
                            <input type="datetime-local" id="task-scheduled"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label for="task-client" class="block text-sm font-medium text-gray-700 mb-1">é¡§å®¢</label>
                            <select id="task-client"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">é¡§å®¢ã‚’é¸æŠ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label for="task-estimated-hours" class="block text-sm font-medium text-gray-700 mb-1">äºˆæƒ³ä½œæ¥­æ™‚é–“ï¼ˆæ™‚ï¼‰</label>
                        <input type="number" id="task-estimated-hours" step="0.5" min="0"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label for="task-description" class="block text-sm font-medium text-gray-700 mb-1">èª¬æ˜</label>
                        <textarea id="task-description" rows="3"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                </div>
                
                <!-- ã‚µãƒ–ã‚¿ã‚¹ã‚¯ -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-medium text-gray-700">ã‚µãƒ–ã‚¿ã‚¹ã‚¯</label>
                        <button type="button" id="add-subtask-btn" class="text-blue-600 hover:text-blue-700 text-sm">
                            <i class="fas fa-plus mr-1"></i>ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ 
                        </button>
                    </div>
                    <div id="subtasks-container"></div>
                </div>
                
                <!-- æ™‚é–“ãƒ­ã‚° -->
                <div id="time-logs-section" class="hidden">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-medium text-gray-700">ä½œæ¥­æ™‚é–“ãƒ­ã‚°</label>
                        <span class="text-sm text-gray-500">åˆè¨ˆ: <span id="total-hours-display">0.0</span>æ™‚é–“</span>
                    </div>
                    <div id="time-logs-container" class="space-y-2 max-h-48 overflow-y-auto"></div>
                </div>
                
            </form>
            
            <!-- å›ºå®šãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ - ãƒ•ã‚©ãƒ¼ãƒ å¤–ã«é…ç½® -->
            <div class="flex justify-end space-x-3 pt-4 px-6 border-t bg-white sticky bottom-0 z-10 shadow-lg modal-footer">
                <button type="button" id="cancel-btn" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button type="submit" form="task-form" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                    ä¿å­˜
                </button>
            </div>
        </div>
    </div>

    <!-- é¡§å®¢ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="client-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm" onclick="if(event.target === this) app.closeClientModal()">
        <div class="bg-white rounded-lg shadow-xl" style="overflow: hidden auto !important;display: block !important;width: 330.723;width: 330px;">
            <div class="flex justify-between items-center p-6 border-b">
                <h3 id="client-modal-title" class="text-lg font-semibold text-gray-900">æ–°ã—ã„é¡§å®¢</h3>
                <button id="close-client-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="client-form" class="p-6 space-y-4 pb-24">
                <input type="hidden" id="client-id">
                
                <div>
                    <label for="client-name" class="block text-sm font-medium text-gray-700 mb-1">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ *</label>
                    <input type="text" id="client-name" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label for="client-company" class="block text-sm font-medium text-gray-700 mb-1">æ‹…å½“è€…</label>
                    <input type="text" id="client-company"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label for="client-email" class="block text-sm font-medium text-gray-700 mb-1">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="client-email"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label for="client-phone" class="block text-sm font-medium text-gray-700 mb-1">é›»è©±ç•ªå·</label>
                    <input type="tel" id="client-phone"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label for="client-notes" class="block text-sm font-medium text-gray-700 mb-1">ãƒ¡ãƒ¢</label>
                    <textarea id="client-notes" rows="3"
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>
            </form>
            
            <!-- å›ºå®šãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ - ãƒ•ã‚©ãƒ¼ãƒ å¤–ã«é…ç½® -->
            <div class="flex justify-end space-x-3 pt-4 px-6 border-t bg-white sticky bottom-0 z-10 shadow-lg modal-footer">
                <button type="button" id="cancel-client-btn" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button type="submit" form="client-form" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                    ä¿å­˜
                </button>
            </div>
        </div>
    </div>

    <!-- é¡§å®¢ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="client-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <div class="bg-white rounded-lg shadow-xl">
            <div class="flex justify-between items-center p-6 border-b">
                <h3 id="client-modal-title" class="text-lg font-semibold text-gray-900">æ–°ã—ã„é¡§å®¢</h3>
                <button id="close-client-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="client-form-edit" class="p-6 space-y-4 pb-24">
                <input type="hidden" id="client-id-edit">
                
                <div>
                    <label for="client-name-edit" class="block text-sm font-medium text-gray-700 mb-1">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ *</label>
                    <input type="text" id="client-name-edit" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label for="client-company-edit" class="block text-sm font-medium text-gray-700 mb-1">æ‹…å½“è€…</label>
                    <input type="text" id="client-company-edit"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label for="client-email-edit" class="block text-sm font-medium text-gray-700 mb-1">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="client-email-edit"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label for="client-phone-edit" class="block text-sm font-medium text-gray-700 mb-1">é›»è©±ç•ªå·</label>
                    <input type="tel" id="client-phone-edit"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label for="client-notes" class="block text-sm font-medium text-gray-700 mb-1">ãƒ¡ãƒ¢</label>
                    <textarea id="client-notes-edit" rows="3"
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>
                
            </form>
            
            <!-- å›ºå®šãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ - ãƒ•ã‚©ãƒ¼ãƒ å¤–ã«é…ç½® -->
            <div class="flex justify-end space-x-3 pt-4 px-6 border-t bg-white sticky bottom-0 z-10 shadow-lg modal-footer">
                <button type="button" id="cancel-client-edit-btn" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button type="submit" form="client-form" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                    ä¿å­˜
                </button>
            </div>
        </div>
    </div>

    <script>
        // APIã‚­ãƒ¼è¡¨ç¤º/éè¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function togglePasswordVisibility(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash text-gray-400 hover:text-gray-600';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye text-gray-400 hover:text-gray-600';
            }
        }

        class TaskFlowApp {
            constructor() {
                this.tasks = JSON.parse(localStorage.getItem('taskflow_tasks') || '[]');
                this.clients = JSON.parse(localStorage.getItem('taskflow_clients') || '[]');
                this.subtasks = JSON.parse(localStorage.getItem('taskflow_subtasks') || '[]');
                this.timeLogs = JSON.parse(localStorage.getItem('taskflow_time_logs') || '[]');
                this.settings = JSON.parse(localStorage.getItem('taskflow_settings') || '{}');
                
                this.currentEditingTask = null;
                this.currentEditingClient = null;
                this.currentTab = 'tasks';
                this.ganttCurrentDate = new Date();
                
                // Google Calendar APIè¨­å®š
                this.googleCalendarApiKey = null;
                this.googleAccessToken = null;
                this.isGoogleCalendarInitialized = false;
                this.calendarSyncInProgress = false; // é‡è¤‡åŒæœŸé˜²æ­¢ãƒ•ãƒ©ã‚°
                
                // ğŸ”¥ FirebaseåŒæœŸè¨­å®š
                this.firebaseEnabled = this.settings.firebaseEnabled || false;
                this.firebaseConfig = this.settings.firebaseConfig || null;
                this.firebaseApp = null;
                this.firestore = null;
                this.auth = null;
                this.user = null;
                this.lastSyncTime = this.settings.lastSyncTime || 0;
                this.syncInProgress = false;
                this.unsubscribeFirestore = null;
                
                // ğŸ¯ ãƒ¢ãƒ¼ãƒ€ãƒ«90%å¹…é©ç”¨æ©Ÿèƒ½
                this.applyModalFormWidth = () => {
                    const modal = document.getElementById('task-modal');
                    if (modal && !modal.classList.contains('hidden') && window.innerWidth >= 769) {
                        // ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã«é©åˆ‡ãªå¹…ã‚’é©ç”¨ï¼ˆã‚µãƒ–ã‚¿ã‚¹ã‚¯è¦ç´ ã¯é™¤å¤–ï¼‰
                        const formElements = modal.querySelectorAll('input, select, textarea');
                        formElements.forEach(element => {
                            // ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚³ãƒ³ãƒ†ãƒŠå†…ã®è¦ç´ ã¯é™¤å¤–
                            if (!element.closest('#subtasks-container')) {
                                // ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå†…ã®è¦ç´ ã‹ãƒã‚§ãƒƒã‚¯
                                const parentGrid = element.closest('.grid.grid-cols-1');
                                const isGridElement = parentGrid && parentGrid.classList.contains('md:grid-cols-2');
                                
                                // æ˜ç¤ºçš„ã«ã‚°ãƒªãƒƒãƒ‰å†…è¦ç´ ã¨ã—ã¦æ‰±ã†ã¹ãID
                                const gridElementIds = ['task-deadline', 'task-priority', 'task-scheduled', 'task-client'];
                                const isSpecificGridElement = gridElementIds.includes(element.id);
                                
                                if (isGridElement || isSpecificGridElement) {
                                    // ã‚°ãƒªãƒƒãƒ‰å†…ã®è¦ç´ ã¯å¸¸ã«100%å¹…ï¼ˆ90%è¨­å®šã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ–ï¼‰
                                    element.style.removeProperty('width');
                                    element.style.removeProperty('max-width');
                                    element.classList.add('grid-element-forced');
                                } else {
                                    // ãã®ä»–ã®è¦ç´ ã®ã¿90%å¹…ã‚’é©ç”¨
                                    if (window.innerWidth >= 1200) {
                                        element.style.width = '100%';
                                        element.style.maxWidth = '100%';
                                    } else {
                                        element.style.width = '90%';
                                        element.style.maxWidth = '90%';
                                    }
                                }
                            }
                        });
                        
                        // iframe-wrapperè¦ç´ ã«ã‚‚90%å¹…ã‚’é©ç”¨
                        const iframeWrappers = document.querySelectorAll('.iframe-wrapper.width-full, .iframe-wrapper[class*="width-full"]');
                        iframeWrappers.forEach(element => {
                            element.style.width = '90%';
                        });
                    }
                };
                
                // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã«ã‚‚å¹…ã‚’å†é©ç”¨
                window.addEventListener('resize', this.applyModalFormWidth);
                
                // ğŸ¯ é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«90%å¹…é©ç”¨æ©Ÿèƒ½
                this.applyClientModalFormWidth = () => {
                    const modal = document.getElementById('client-modal');
                    if (modal && !modal.classList.contains('hidden') && window.innerWidth >= 769) {
                        // ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã«90%å¹…ã‚’é©ç”¨
                        const formElements = modal.querySelectorAll('input, select, textarea');
                        formElements.forEach(element => {
                            element.style.width = '90%';
                            element.style.maxWidth = '90%';
                        });
                        
                        // iframe-wrapperè¦ç´ ã«ã‚‚90%å¹…ã‚’é©ç”¨
                        const iframeWrappers = document.querySelectorAll('.iframe-wrapper.width-full, .iframe-wrapper[class*="width-full"]');
                        iframeWrappers.forEach(element => {
                            element.style.width = '90%';
                        });
                    }
                };
                
                // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã«é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚‚å¹…ã‚’å†é©ç”¨
                window.addEventListener('resize', this.applyClientModalFormWidth);
                
                this.init();
            }
            
            init() {
                this.bindEvents();
                this.switchTab('tasks');
                
                // ãƒ‡ãƒ¢ç”¨ã®é•·ã„ã‚¿ã‚¹ã‚¯åãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ï¼ˆãƒ†ã‚¹ãƒˆç”¨ãƒ»æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®ã¿ï¼‰
                if (this.tasks.length === 0) {
                    this.addDemoLongNameTasks();
                }
                
                this.renderTasks();
                this.loadSettings();
                this.startTimerUpdates();
                
                // ğŸ”¥ FirebaseåˆæœŸåŒ–ï¼ˆè¨­å®šã®æœ‰ç„¡ã«é–¢ã‚ã‚‰ãšå®Ÿè¡Œï¼‰
                setTimeout(() => this.initializeFirebase(), 1000);
                
                // åˆæœŸåŒ–å®Œäº†
            }
            
            // ğŸ”¥ FirebaseåŒæœŸæ©Ÿèƒ½
            async initializeFirebase() {
                try {
                    // Firebase SDK å®Œå…¨èª­ã¿è¾¼ã¿ç¢ºèª
                    if (!window.FirebaseSDK) {
                        this.updateFirebaseStatus('error');
                        return Promise.reject(new Error('Firebase SDK not loaded'));
                    }
                    
                    if (!this.firebaseConfig) {
                        this.updateFirebaseStatus('pending');
                        // Googleèªè¨¼ãƒœã‚¿ãƒ³ã¯æœ‰åŠ¹ãªã¾ã¾ã«ã—ã¦è¨­å®šã‚’ä¿ƒã™
                        this.enableGoogleSigninBtnWithConfig();
                        return Promise.resolve();
                    }
                    
                    // FirebaseåˆæœŸåŒ–é–‹å§‹
                    
                    const { initializeApp, getFirestore, getAuth, signInAnonymously, onAuthStateChanged } = window.FirebaseSDK;
                    
                    // FirebaseåˆæœŸåŒ–ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œç‰ˆï¼‰
                    const adjustedConfig = {
                        ...this.firebaseConfig,
                        authDomain: this.firebaseConfig.authDomain || `${this.firebaseConfig.projectId}.firebaseapp.com`
                    };
                    
                    // Firebaseè¨­å®šç¢ºèª
                    
                    this.firebaseApp = initializeApp(adjustedConfig);
                    this.firestore = getFirestore(this.firebaseApp);
                    this.auth = getAuth(this.firebaseApp);
                    
                    // AuthåˆæœŸåŒ–ã®ç¢ºèªã¨å¾…æ©Ÿ
                    if (!this.auth) {
                        throw new Error('Firebase Auth initialization failed');
                    }
                    
                    // Authæº–å‚™å®Œäº†ã¾ã§å°‘ã—å¾…æ©Ÿ
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // FirebaseåˆæœŸåŒ–å®Œäº†
                    
                    // åºƒå‘Šãƒ–ãƒ­ãƒƒã‚«ãƒ¼å¯¾ç­–: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ°¸ç¶šåŒ–ã‚’æœ‰åŠ¹ã«ã™ã‚‹
                    try {
                        const { enableNetwork, disableNetwork } = window.FirebaseSDK;
                        // Firebaseè¨­å®šæœ€é©åŒ–ä¸­
                    } catch (error) {
                        // ä¸€éƒ¨ã®Firebaseæ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã¦ã„ã¾ã™
                    }
                    
                    // ğŸ” Googleèªè¨¼æ–¹å¼ï¼ˆå®‰å…¨ï¼†åŒæœŸå•é¡Œè§£æ±ºï¼‰
                    onAuthStateChanged(this.auth, (user) => {
                        if (user && user.providerData[0]?.providerId === 'google.com') {
                            // Googleèªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼
                            this.user = user;
                            // Googleèªè¨¼æˆåŠŸ
                            
                            this.startFirebaseSync();
                            this.updateFirebaseStatus('success');
                            
                        } else if (user && user.isAnonymous) {
                            // åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’Googleã«å¤‰æ›
                            // åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œå‡º
                            this.showGoogleAuthPrompt();
                            
                        } else {
                            // æœªèªè¨¼çŠ¶æ…‹
                            // èªè¨¼ãŒå¿…è¦
                            this.showGoogleAuthPrompt();
                            this.updateFirebaseStatus('error');
                        }
                    });
                    
                } catch (error) {
                    // FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼
                    
                    // AdBlocker ã‚„ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã«ã‚ˆã‚‹ãƒ–ãƒ­ãƒƒã‚¯ã®æ¤œå‡º
                    const isBlockedByClient = error.message?.includes('ERR_BLOCKED_BY_CLIENT') || 
                                            error.message?.includes('network error') ||
                                            error.code === 'network-request-failed';
                    
                    if (isBlockedByClient) {
                        console.warn('âš ï¸ Firebaseæ¥ç¶šãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ (AdBlockerç­‰)');
                        // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ç¶™ç¶š
                        this.updateFirebaseStatus('blocked');
                        
                        // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                        this.showOfflineModeNotification();
                    } else {
                        this.updateFirebaseStatus('error');
                    }
                    
                    this.enableGoogleSigninBtn(); // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒœã‚¿ãƒ³ã¯æœ‰åŠ¹åŒ–
                    
                    // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è‡ªä½“ã¯å‹•ä½œã‚’ç¶™ç¶š
                    return Promise.resolve();
                }
            }
            
            async startFirebaseSync() {
                if (!this.firestore || !this.user) {
                    // FirebaseåŒæœŸé–‹å§‹å¤±æ•—
                    return;
                }
                
                try {
                    const { doc, onSnapshot, getDoc } = window.FirebaseSDK;
                    
                    // äº‹å‰æ¥ç¶šãƒ†ã‚¹ãƒˆ
                    // Firebaseæ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹
                    const userDocRef = doc(this.firestore, 'users', this.user.uid);
                    
                    // ã¾ãšä¸€åº¦èª­ã¿å–ã‚Šãƒ†ã‚¹ãƒˆ
                    const testDoc = await getDoc(userDocRef);
                    console.log('âœ… èª­ã¿å–ã‚Šãƒ†ã‚¹ãƒˆæˆåŠŸ:', {
                        exists: testDoc.exists(),
                        userId: this.user.uid,
                        permissions: 'OK'
                    });
                    
                    // ğŸš¨ èµ·å‹•æ™‚å¼·åˆ¶åŒæœŸ: Firebaseã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°å¿…ãšå–å¾—
                    if (testDoc.exists()) {
                        const initialData = testDoc.data();
                        console.log('ğŸš€ èµ·å‹•æ™‚ãƒ‡ãƒ¼ã‚¿ç™ºè¦‹ - å¼·åˆ¶å–å¾—å®Ÿè¡Œ');
                        console.log('ğŸ“Š ç™ºè¦‹ãƒ‡ãƒ¼ã‚¿:', {
                            tasks: initialData.tasks?.length || 0,
                            clients: initialData.clients?.length || 0,
                            timestamp: new Date(initialData.lastModified).toLocaleString()
                        });
                        
                        // ç¾åœ¨ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚ˆã‚ŠFirebaseãŒæ–°ã—ã„ã€ã¾ãŸã¯ãƒ­ãƒ¼ã‚«ãƒ«ãŒç©ºã®å ´åˆ
                        const localEmpty = (this.tasks?.length || 0) === 0 && (this.clients?.length || 0) === 0;
                        const firebaseNewer = initialData.lastModified > (this.lastSyncTime || 0);
                        
                        if (localEmpty || firebaseNewer) {
                            console.log('ğŸ’‰ èµ·å‹•æ™‚å¼·åˆ¶åŒæœŸå®Ÿè¡Œ');
                            this.mergeFirebaseData(initialData);
                        }
                    } else {
                        console.log('ğŸ“„ Firebaseåˆå›èµ·å‹• - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰äºˆå®š');
                    }
                    
                    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼è¨­å®š
                    
                    this.unsubscribeFirestore = onSnapshot(userDocRef, (docSnapshot) => {
                        try {
                            if (docSnapshot.exists()) {
                                const data = docSnapshot.data();
                                console.log('ğŸ”„ Firebaseã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å—ä¿¡:', {
                                    lastModified: data.lastModified,
                                    localLastSync: this.lastSyncTime,
                                    syncInProgress: this.syncInProgress,
                                    shouldMerge: data.lastModified !== this.lastSyncTime
                                });
                                
                                // ã‚ˆã‚Šæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã€ã¾ãŸã¯åˆå›åŒæœŸã®å ´åˆã¯æ›´æ–°
                                const isNewer = data.lastModified > (this.lastSyncTime || 0);
                                const isInitialSync = !this.lastSyncTime;
                                const shouldSync = (isNewer || isInitialSync) && !this.syncInProgress;
                                
                                console.log('ğŸ” åŒæœŸåˆ¤å®šè©³ç´°:', {
                                    firebaseTimestamp: data.lastModified,
                                    localTimestamp: this.lastSyncTime,
                                    isNewer,
                                    isInitialSync,
                                    shouldSync,
                                    syncInProgress: this.syncInProgress
                                });
                                
                                if (shouldSync) {
                                    console.log('ğŸ“¥ æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œå‡º - ãƒãƒ¼ã‚¸é–‹å§‹');
                                    this.mergeFirebaseData(data);
                                } else {
                                    console.log('â­ï¸ ã‚¹ã‚­ãƒƒãƒ—ç†ç”±:', {
                                        reason: !isNewer && !isInitialSync ? 'å¤ã„ãƒ‡ãƒ¼ã‚¿' : 'syncé€²è¡Œä¸­'
                                    });
                                }
                            } else {
                                console.log('ğŸ“„ Firestoreã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã—ã¾ã›ã‚“');
                            }
                        } catch (error) {
                            console.error('âŒ onSnapshot ã‚¨ãƒ©ãƒ¼:', error);
                            this.updateFirebaseStatus('error');
                        }
                    }, (error) => {
                        // åºƒå‘Šãƒ–ãƒ­ãƒƒã‚«ãƒ¼ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ï¼ˆåŒæœŸã¯æ­£å¸¸å‹•ä½œä¸­ï¼‰
                        if (error.message && error.message.includes('network')) {
                            console.log('âš ï¸ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶é™ï¼ˆåºƒå‘Šãƒ–ãƒ­ãƒƒã‚«ãƒ¼ï¼‰ã‚’æ¤œçŸ¥ã—ã¾ã—ãŸãŒã€åŒæœŸã¯ç¶™ç¶šä¸­ã§ã™');
                            return;
                        }
                        console.error('âŒ Firestore ãƒªã‚¹ãƒŠãƒ¼ ã‚¨ãƒ©ãƒ¼:', error);
                        this.updateFirebaseStatus('error');
                    });
                    
                    // åˆå›ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                    this.uploadToFirebase();
                    
                    // Firebaseãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸé–‹å§‹
                    this.updateFirebaseStatus('success');
                    
                    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’å®šæœŸçš„ã«å‡ºåŠ›
                    this.startSyncMonitoring();
                    
                } catch (error) {
                    // FirebaseåŒæœŸé–‹å§‹ã‚¨ãƒ©ãƒ¼
                    
                    // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚„ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ¤œå‡º
                    const isNetworkError = error.message?.includes('ERR_BLOCKED_BY_CLIENT') ||
                                         error.message?.includes('network error') ||
                                         error.code === 'unavailable' ||
                                         error.code === 'network-request-failed';
                    
                    if (isNetworkError) {
                        console.warn('âš ï¸ FirebaseåŒæœŸãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ (AdBlockerç­‰)');
                        this.updateFirebaseStatus('blocked');
                        this.showOfflineModeNotification();
                    } else {
                        this.updateFirebaseStatus('error');
                    }
                }
            }
            
            async uploadToFirebase() {
                if (!this.firestore || !this.user || this.syncInProgress) return;
                
                this.syncInProgress = true;
                
                try {
                    const { doc, setDoc } = window.FirebaseSDK;
                    
                    const userData = {
                        tasks: this.tasks,
                        clients: this.clients,
                        subtasks: this.subtasks,
                        timeLogs: this.timeLogs,
                        settings: this.settings,
                        lastModified: Date.now(),
                        deviceInfo: {
                            userAgent: navigator.userAgent,
                            timestamp: new Date().toISOString()
                        }
                    };
                    
                    const userDocRef = doc(this.firestore, 'users', this.user.uid);
                    await setDoc(userDocRef, userData);
                    
                    this.lastSyncTime = userData.lastModified;
                    console.log('ğŸ“¤ Firebaseã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†:', {
                        userId: this.user.uid,
                        dataSize: JSON.stringify(userData).length,
                        tasksCount: userData.tasks.length,
                        timestamp: new Date(userData.lastModified).toLocaleString()
                    });
                    
                } catch (error) {
                    // Firebaseã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼
                    
                    // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚„ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ¤œå‡º
                    const isNetworkError = error.message?.includes('ERR_BLOCKED_BY_CLIENT') ||
                                         error.message?.includes('network error') ||
                                         error.code === 'unavailable' ||
                                         error.code === 'network-request-failed';
                    
                    if (isNetworkError) {
                        console.warn('âš ï¸ FirebaseåŒæœŸãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
                        this.updateFirebaseStatus('blocked');
                    } else {
                        this.updateFirebaseStatus('error');
                    }
                } finally {
                    this.syncInProgress = false;
                }
            }
            
            mergeFirebaseData(firebaseData) {
                console.log('ğŸ“¥ Firebaseãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ¼ã‚¸ä¸­...', {
                    firebaseTimestamp: new Date(firebaseData.lastModified).toLocaleString(),
                    localTimestamp: this.lastSyncTime ? new Date(this.lastSyncTime).toLocaleString() : 'ãªã—',
                    tasksCount: firebaseData.tasks?.length || 0,
                    clientsCount: firebaseData.clients?.length || 0
                });
                
                // ä¸€æ™‚çš„ã«åŒæœŸãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
                this.syncInProgress = true;
                
                try {
                    // ãƒ‡ãƒ¼ã‚¿ã‚’é©ç”¨å‰ã®çŠ¶æ…‹ã‚’è¨˜éŒ²
                    const beforeCount = {
                        tasks: this.tasks?.length || 0,
                        clients: this.clients?.length || 0,
                        subtasks: this.subtasks?.length || 0,
                        timeLogs: this.timeLogs?.length || 0
                    };
                    
                    // ãƒ‡ãƒ¼ã‚¿ã‚’é©ç”¨
                    if (firebaseData.tasks) {
                        this.tasks = firebaseData.tasks;
                        console.log('âœ… ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿æ›´æ–°:', `${beforeCount.tasks} â†’ ${this.tasks.length}ä»¶`);
                    } else {
                        console.log('âš ï¸ Firebaseã«ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ãªã—');
                    }
                    
                    if (firebaseData.clients) {
                        this.clients = firebaseData.clients;
                        console.log('âœ… é¡§å®¢ãƒ‡ãƒ¼ã‚¿æ›´æ–°:', `${beforeCount.clients} â†’ ${this.clients.length}ä»¶`);
                    } else {
                        console.log('âš ï¸ Firebaseã«é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãªã—');
                    }
                    
                    if (firebaseData.subtasks) {
                        this.subtasks = firebaseData.subtasks;
                        console.log('âœ… ã‚µãƒ–ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿æ›´æ–°:', `${beforeCount.subtasks} â†’ ${this.subtasks.length}ä»¶`);
                    } else {
                        console.log('âš ï¸ Firebaseã«ã‚µãƒ–ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ãªã—');
                    }
                    
                    if (firebaseData.timeLogs) {
                        this.timeLogs = firebaseData.timeLogs;
                        console.log('âœ… æ™‚é–“ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿æ›´æ–°:', `${beforeCount.timeLogs} â†’ ${this.timeLogs.length}ä»¶`);
                    } else {
                        console.log('âš ï¸ Firebaseã«æ™‚é–“ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ãªã—');
                    }
                    
                    if (firebaseData.settings) {
                        this.settings = { ...this.settings, ...firebaseData.settings };
                        console.log('âœ… è¨­å®šãƒ‡ãƒ¼ã‚¿æ›´æ–°');
                    }
                    
                    // ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
                    this.saveData();
                    
                    // UIæ›´æ–°ï¼ˆå¼·åˆ¶å®Ÿè¡Œï¼‰
                    console.log('ğŸ”„ UIæ›´æ–°é–‹å§‹...');
                    
                    // ã‚¿ã‚¹ã‚¯è¡¨ç¤ºã‚’å¼·åˆ¶æ›´æ–°
                    if (typeof this.renderTasks === 'function') {
                        this.renderTasks();
                        console.log('âœ… ã‚¿ã‚¹ã‚¯ç”»é¢æ›´æ–°å®Œäº†');
                    } else {
                        console.error('âŒ renderTasksé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                    
                    // é¡§å®¢è¡¨ç¤ºã‚’å¼·åˆ¶æ›´æ–°  
                    if (typeof this.renderClients === 'function') {
                        this.renderClients();
                        console.log('âœ… é¡§å®¢ç”»é¢æ›´æ–°å®Œäº†');
                    } else {
                        console.error('âŒ renderClientsé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                    
                    // è¨­å®šã‚’å¼·åˆ¶æ›´æ–°
                    if (typeof this.loadSettings === 'function') {
                        this.loadSettings();
                        console.log('âœ… è¨­å®šæ›´æ–°å®Œäº†');
                    } else {
                        console.error('âŒ loadSettingsé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                    
                    // ç¾åœ¨è¡¨ç¤ºä¸­ã®ã‚¿ãƒ–ã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
                    const activeTab = document.querySelector('.tab-btn.active');
                    if (activeTab) {
                        const tabName = activeTab.textContent.trim();
                        console.log('ğŸ”„ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–å†æç”»:', tabName);
                        activeTab.click();
                    }
                    
                    // åŒæœŸæ™‚åˆ»ã‚’æ›´æ–°
                    this.lastSyncTime = firebaseData.lastModified;
                    
                    console.log('âœ… ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¸å®Œäº† - UIæ›´æ–°æ¸ˆã¿');
                    
                    // æˆåŠŸã‚’è¦–è¦šçš„ã«è¡¨ç¤º
                    this.showSyncSuccess();
                    
                } catch (error) {
                    console.error('âŒ ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼:', error);
                } finally {
                    // å¿…ãšåŒæœŸãƒ•ãƒ©ã‚°ã‚’è§£é™¤
                    this.syncInProgress = false;
                }
            }
            
            updateFirebaseStatus(status) {
                const indicator = document.getElementById('firebase-status');
                if (indicator) {
                    indicator.className = `sync-status ${status} ml-2`;
                    indicator.textContent = status === 'success' ? 'ğŸŸ¢' : status === 'error' ? 'ğŸ”´' : 'ğŸŸ¡';
                }
                
                // ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã‚’æ›´æ–°
                const modeText = document.getElementById('sync-mode-text');
                if (modeText) {
                    if (status === 'success') {
                        modeText.textContent = 'ğŸ”¥ Firebase ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰ï¼‰';
                    } else if (status === 'error') {
                        modeText.textContent = 'âŒ Firebaseæ¥ç¶šã‚¨ãƒ©ãƒ¼ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ï¼‰';
                    } else {
                        modeText.textContent = 'ğŸŸ¡ Firebaseæ¥ç¶šä¸­...';
                    }
                }
                
                this.updateLastSyncDisplay();
            }
            
            showSyncSuccess() {
                // åŒæœŸæˆåŠŸã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                const indicator = document.getElementById('firebase-status');
                if (indicator) {
                    // ä¸€æ™‚çš„ã«ç·‘è‰²ã®ç‚¹æ»…åŠ¹æœ
                    indicator.style.animation = 'pulse 0.5s ease-in-out 2';
                    indicator.textContent = 'ğŸ’š';
                    
                    setTimeout(() => {
                        indicator.textContent = 'ğŸŸ¢';
                        indicator.style.animation = '';
                    }, 1000);
                }
                
                console.log('ğŸ‰ åŒæœŸå®Œäº† - ãƒ‡ãƒ¼ã‚¿ãŒä»–ã®ç«¯æœ«ã¨åŒæœŸã•ã‚Œã¾ã—ãŸ');
            }
            
            showGoogleAuthPrompt() {
                // Googleèªè¨¼ãŒå¿…è¦ãªå ´åˆã®UIæ›´æ–°
                const authStatus = document.getElementById('google-auth-status');
                const signinBtn = document.getElementById('google-signin-btn');
                const signoutBtn = document.getElementById('google-signout-btn');
                const userInfo = document.getElementById('google-user-info');
                
                if (authStatus) authStatus.textContent = 'ğŸ”´';
                if (signinBtn) signinBtn.style.display = 'block';
                if (signoutBtn) signoutBtn.style.display = 'none';
                if (userInfo) userInfo.classList.add('hidden');
                
                // FirebaseåŒæœŸãƒˆã‚°ãƒ«ã‚’ç„¡åŠ¹åŒ–
                const syncToggle = document.getElementById('firebase-sync-toggle');
                if (syncToggle) {
                    syncToggle.disabled = true;
                    syncToggle.checked = false;
                    
                    // è¦ªè¦ç´ ã«disabledã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                    const toggleContainer = syncToggle.closest('.toggle-switch');
                    if (toggleContainer) {
                        toggleContainer.classList.add('disabled');
                    }
                    
                    // Firebaseè¨­å®šãƒ‘ãƒãƒ«ã‚’éè¡¨ç¤º
                    const configPanel = document.getElementById('firebase-config');
                    if (configPanel) {
                        configPanel.classList.add('hidden');
                    }
                }
            }
            
            updateGoogleAuthUI(user) {
                // Googleèªè¨¼æˆåŠŸæ™‚ã®UIæ›´æ–°
                const authStatus = document.getElementById('google-auth-status');
                const signinBtn = document.getElementById('google-signin-btn');
                const signoutBtn = document.getElementById('google-signout-btn');
                const userInfo = document.getElementById('google-user-info');
                const userName = document.getElementById('user-name');
                const userEmail = document.getElementById('user-email');
                const userPhoto = document.getElementById('user-photo');
                
                if (authStatus) authStatus.textContent = 'ğŸŸ¢';
                if (signinBtn) {
                    signinBtn.style.display = 'none';
                    signinBtn.disabled = false; // å†æœ‰åŠ¹åŒ–
                }
                if (signoutBtn) signoutBtn.style.display = 'block';
                if (userInfo) userInfo.classList.remove('hidden');
                if (userName) userName.textContent = user.displayName || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼';
                if (userEmail) userEmail.textContent = user.email || '';
                if (userPhoto) userPhoto.src = user.photoURL || '';
                
                // FirebaseåŒæœŸãƒˆã‚°ãƒ«ã‚’æœ‰åŠ¹åŒ–
                const syncToggle = document.getElementById('firebase-sync-toggle');
                if (syncToggle) {
                    syncToggle.disabled = false;
                    syncToggle.checked = true;
                    
                    // è¦ªè¦ç´ ã®disabledã‚¯ãƒ©ã‚¹ã‚‚å‰Šé™¤
                    const toggleContainer = syncToggle.closest('.toggle-switch');
                    if (toggleContainer) {
                        toggleContainer.classList.remove('disabled');
                    }
                    
                    // Firebaseè¨­å®šãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º
                    const configPanel = document.getElementById('firebase-config');
                    if (configPanel) {
                        configPanel.classList.remove('hidden');
                    }
                }
            }
            
            disableGoogleSigninBtn() {
                // èªè¨¼å‡¦ç†ä¸­ã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                const signinBtn = document.getElementById('google-signin-btn');
                if (signinBtn) {
                    signinBtn.disabled = true;
                    signinBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>åˆæœŸåŒ–ä¸­...';
                }
            }
            
            enableGoogleSigninBtn() {
                // èªè¨¼æº–å‚™å®Œäº†ã§ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–  
                const signinBtn = document.getElementById('google-signin-btn');
                if (signinBtn) {
                    signinBtn.disabled = false;
                    signinBtn.innerHTML = '<i class="fab fa-google mr-2"></i>Googleã§ãƒ­ã‚°ã‚¤ãƒ³';
                    // è¨­å®šä¸å®Œäº†ãƒ•ãƒ©ã‚°ã‚’å‰Šé™¤
                    signinBtn.removeAttribute('data-config-incomplete');
                }
            }
            
            // FirebaseçŠ¶æ…‹ç®¡ç†ãƒ¡ã‚½ãƒƒãƒ‰
            updateFirebaseStatus(status) {
                const statusElement = document.getElementById('firebase-status');
                const statusMap = {
                    'pending': { text: 'æ¥ç¶šä¸­...', class: 'text-yellow-600', icon: 'fas fa-spinner fa-spin' },
                    'success': { text: 'åŒæœŸä¸­', class: 'text-green-600', icon: 'fas fa-check-circle' },
                    'error': { text: 'æ¥ç¶šã‚¨ãƒ©ãƒ¼', class: 'text-red-600', icon: 'fas fa-exclamation-circle' },
                    'blocked': { text: 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰', class: 'text-orange-600', icon: 'fas fa-wifi-slash' }
                };
                
                if (statusElement && statusMap[status]) {
                    const { text, class: className, icon } = statusMap[status];
                    statusElement.innerHTML = `<i class="${icon} mr-1"></i>${text}`;
                    statusElement.className = `text-sm ${className}`;
                }
            }
            
            showOfflineModeNotification() {
                // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚’è¡¨ç¤º
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4 rounded-md shadow-lg z-50 max-w-md';
                notification.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-wifi-slash mr-2"></i>
                        <div>
                            <h4 class="font-medium">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰</h4>
                            <p class="text-sm mt-1">Firebaseæ¥ç¶šãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚AdBlockerç­‰ã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ã”ç¢ºèªãã ã•ã„ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-orange-500 hover:text-orange-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // 10ç§’å¾Œã«è‡ªå‹•ã§æ¶ˆå»
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 10000);
            }
            
            showGoogleAuthPrompt() {
                console.log('ğŸ” Googleèªè¨¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤º');
                // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹ã«ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿ƒã™
                this.enableGoogleSigninBtn();
            }
            
            enableGoogleSigninBtnWithConfig() {
                // Firebaseè¨­å®šãŒæœªå®Œäº†ã§ã‚‚èªè¨¼ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–ï¼ˆè¨­å®šç”»é¢ã¸ã®èª˜å°ä»˜ãï¼‰
                console.log('ğŸ”§ enableGoogleSigninBtnWithConfig() å®Ÿè¡Œ');
                const signinBtn = document.getElementById('google-signin-btn');
                if (signinBtn) {
                    signinBtn.disabled = false;
                    signinBtn.innerHTML = '<i class="fas fa-cog mr-2"></i>ã¾ãšFirebaseè¨­å®šã‚’å®Œäº†';
                    // ãƒ‡ãƒ¼ã‚¿å±æ€§ã§è¨­å®šä¸å®Œäº†çŠ¶æ…‹ã‚’ãƒãƒ¼ã‚¯
                    signinBtn.setAttribute('data-config-incomplete', 'true');
                    console.log('âœ… Googleèªè¨¼ãƒœã‚¿ãƒ³ã‚’è¨­å®šèª˜å°ãƒ¢ãƒ¼ãƒ‰ã«å¤‰æ›´');
                } else {
                    console.error('âŒ Googleèªè¨¼ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            }
            
            async signInWithGoogle() {
                try {
                    // è¨­å®šä¸å®Œäº†çŠ¶æ…‹ã®æ—©æœŸãƒã‚§ãƒƒã‚¯
                    const signinBtn = document.getElementById('google-signin-btn');
                    if (signinBtn && signinBtn.getAttribute('data-config-incomplete') === 'true') {
                        // Firebaseè¨­å®šãƒ‘ãƒãƒ«ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                        const configPanel = document.getElementById('firebase-config');
                        if (configPanel) {
                            configPanel.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            setTimeout(() => {
                                const apiKeyField = document.getElementById('firebase-api-key');
                                if (apiKeyField) {
                                    apiKeyField.focus();
                                }
                            }, 500);
                        }
                        return; // å‡¦ç†ã‚’åœæ­¢
                    }

                    console.log('ğŸ” Googleèªè¨¼é–‹å§‹...');
                    
                    // FirebaseåˆæœŸåŒ–çŠ¶æ³ã®è©³ç´°ç¢ºèª
                    console.log('ğŸ” FirebaseçŠ¶æ…‹ç¢ºèª:', {
                        firebaseApp: !!this.firebaseApp,
                        auth: !!this.auth,
                        firestore: !!this.firestore,
                        config: !!this.firebaseConfig,
                        authReady: this.auth && typeof this.auth.currentUser !== 'undefined'
                    });
                    
                    // FirebaseæœªåˆæœŸåŒ–ã®å ´åˆã¯å¼·åˆ¶åˆæœŸåŒ–
                    if (!this.firebaseApp || !this.auth) {
                        console.log('ğŸ”„ Firebaseå¼·åˆ¶åˆæœŸåŒ–å®Ÿè¡Œ...');
                        
                        if (!this.firebaseConfig) {
                            // Firebaseè¨­å®šãƒ‘ãƒãƒ«ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å½“ã¦ã‚‹
                            const configPanel = document.getElementById('firebase-config');
                            if (configPanel) {
                                configPanel.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                
                                // APIã‚­ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                                setTimeout(() => {
                                    const apiKeyField = document.getElementById('firebase-api-key');
                                    if (apiKeyField) {
                                        apiKeyField.focus();
                                        apiKeyField.style.borderColor = '#f59e0b';
                                        apiKeyField.style.boxShadow = '0 0 0 3px rgba(245, 158, 11, 0.1)';
                                    }
                                }, 500);
                            }
                            
                            alert('âŒ Firebaseè¨­å®šãŒå¿…è¦ã§ã™ã€‚\n\n1. ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã«API Key ã‚’å…¥åŠ›\n2. Project ID ã‚’å…¥åŠ›\n3. ã€Œè¨­å®šä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯\n\nãã®å¾Œã€Googleèªè¨¼ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚');
                            return;
                        }
                        
                        // å¼·åˆ¶çš„ã«Firebaseã‚’åˆæœŸåŒ–
                        await this.initializeFirebase();
                        
                        // åˆæœŸåŒ–å®Œäº†ã¾ã§å°‘ã—å¾…æ©Ÿ
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        if (!this.auth) {
                            alert('âŒ FirebaseåˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
                            return;
                        }
                    }
                    
                    // Firebase SDKç¢ºèª
                    if (!window.FirebaseSDK || !window.FirebaseSDK.GoogleAuthProvider) {
                        // Firebase SDKæœªèª­ã¿è¾¼ã¿
                        alert('âŒ ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }
                    
                    // ãƒ–ãƒ©ã‚¦ã‚¶æ¤œå‡º
                    const isArcBrowser = navigator.userAgent.includes('Arc') || 
                                       /Arc\//.test(navigator.userAgent);
                    
                    // Arcå¯¾å¿œã®å¼·åŒ–
                    if (isArcBrowser) {
                        console.log('ğŸŒ Arcãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–');
                        
                        // Arcã§ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯å¯¾ç­–
                        const enablePopup = confirm(
                            'ğŸŒ Arcãƒ–ãƒ©ã‚¦ã‚¶ã§ã®èªè¨¼è¨­å®š\n\n' +
                            'ä»¥ä¸‹ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š\n' +
                            '1. ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¨±å¯\n' +
                            '2. JavaScriptã‚’æœ‰åŠ¹åŒ–\n' +
                            '3. ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£Cookieã‚’è¨±å¯\n\n' +
                            'è¨­å®šå®Œäº†å¾Œã€ŒOKã€ã‚’æŠ¼ã—ã¦ãã ã•ã„'
                        );
                        
                        if (!enablePopup) {
                            alert('Arcè¨­å®šã‚’ç¢ºèªã—ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„');
                            return;
                        }
                    }
                    
                    const { GoogleAuthProvider, signInWithRedirect, getRedirectResult, signInWithPopup } = window.FirebaseSDK;
                    const provider = new GoogleAuthProvider();
                    
                    // Arcå°‚ç”¨ã®è¨­å®š
                    if (isArcBrowser) {
                        // å¿…è¦æœ€å°é™ã®ã‚¹ã‚³ãƒ¼ãƒ—
                        provider.addScope('profile');
                        provider.addScope('email');
                        provider.setCustomParameters({
                            prompt: 'select_account',
                            include_granted_scopes: true,
                            access_type: 'online'  // Arcã®åˆ¶é™ã«å¯¾å¿œ
                        });
                        console.log('ğŸ”§ Arcå°‚ç”¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®šå®Œäº†');
                    }
                    
                    // æ—¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆçµæœãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                    try {
                        const result = await getRedirectResult(this.auth);
                        
                        if (result) {
                            const user = result.user;
                            console.log('âœ… Googleèªè¨¼æˆåŠŸï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰:', user.email);
                            this.updateGoogleAuthUI(user);
                            return;
                        }
                    } catch (redirectError) {
                        console.log('â„¹ï¸ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆçµæœç¢ºèªã‚¨ãƒ©ãƒ¼ï¼ˆæ­£å¸¸ï¼‰:', redirectError.message);
                    }
                    
                    // Arcå°‚ç”¨ã®èªè¨¼æˆ¦ç•¥
                    if (isArcBrowser) {
                        console.log('ğŸ”„ Arcå°‚ç”¨èªè¨¼ãƒ•ãƒ­ãƒ¼é–‹å§‹');
                        
                        // æ–¹æ³•1: ã¾ãšãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è©¦è¡Œï¼ˆArcæœ€æ–°ç‰ˆå¯¾å¿œï¼‰
                        try {
                            console.log('ğŸªŸ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—èªè¨¼ã‚’è©¦è¡Œ...');
                            const popupResult = await signInWithPopup(this.auth, provider);
                            const user = popupResult.user;
                            console.log('âœ… Arc ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—èªè¨¼æˆåŠŸ:', user.email);
                            this.updateGoogleAuthUI(user);
                            return;
                            
                        } catch (popupError) {
                            console.log('âš ï¸ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å¤±æ•—ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã«åˆ‡ã‚Šæ›¿ãˆ:', popupError.code);
                            
                            if (popupError.code === 'auth/popup-blocked' || 
                                popupError.code === 'auth/popup-closed-by-user' ||
                                popupError.code === 'auth/cancelled-popup-request') {
                                
                                // æ–¹æ³•2: ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã«åˆ‡ã‚Šæ›¿ãˆ
                                console.log('ğŸ”„ Arcãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆèªè¨¼ã«åˆ‡ã‚Šæ›¿ãˆ');
                                
                                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’èª¬æ˜
                                const proceedRedirect = confirm(
                                    'ğŸ”„ èªè¨¼æ–¹å¼åˆ‡ã‚Šæ›¿ãˆ\n\n' +
                                    'ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚\n' +
                                    'Googleãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚\n\n' +
                                    'OK â†’ Googleèªè¨¼ãƒšãƒ¼ã‚¸ã¸ç§»å‹•\n' +
                                    'ã‚­ãƒ£ãƒ³ã‚»ãƒ« â†’ èªè¨¼ã‚’ä¸­æ­¢'
                                );
                                
                                if (proceedRedirect) {
                                    await signInWithRedirect(this.auth, provider);
                                } else {
                                    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèªè¨¼ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«');
                                }
                                return;
                            } else {
                                throw popupError; // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ã¯å¤–å´ã§ã‚­ãƒ£ãƒƒãƒ
                            }
                        }
                    }
                    
                    // ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è©¦è¡Œ
                    try {
                        const { signInWithPopup } = window.FirebaseSDK;
                        const popupResult = await signInWithPopup(this.auth, provider);
                        const user = popupResult.user;
                        console.log('âœ… Googleèªè¨¼æˆåŠŸï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼‰:', user.email);
                        this.updateGoogleAuthUI(user);
                        
                    } catch (popupError) {
                        // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å¤±æ•—æ™‚ã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’ä½¿ç”¨
                        console.log('â„¹ï¸ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å¤±æ•—ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã«åˆ‡ã‚Šæ›¿ãˆ');
                        await signInWithRedirect(this.auth, provider);
                    }
                    
                } catch (error) {
                    console.error('âŒ Googleèªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
                    
                    if (error.code === 'auth/unauthorized-domain') {
                        alert(`âŒ ãƒ‰ãƒ¡ã‚¤ãƒ³æ‰¿èªã‚¨ãƒ©ãƒ¼\n\nFirebase Console ã§ä»¥ä¸‹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æ‰¿èªã—ã¦ãã ã•ã„ï¼š\nâ€¢ ${window.location.hostname}\nâ€¢ ${window.location.origin}`);
                    } else if (error.code === 'auth/popup-blocked') {
                        alert('âŒ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ\n\nãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¨­å®šã‚’ç¢ºèªã™ã‚‹ã‹ã€Chrome/Safariã‚’ãŠè©¦ã—ãã ã•ã„ã€‚');
                    } else {
                        alert('âŒ Googleèªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message + '\n\nArcãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãŠä½¿ã„ã®å ´åˆã¯ã€Chrome/Safari/Edgeã‚’ãŠè©¦ã—ãã ã•ã„ã€‚');
                    }
                }
            }
            
            async signOutGoogle() {
                try {
                    const { signOut } = window.FirebaseSDK;
                    await signOut(this.auth);
                    
                    console.log('âœ… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå®Œäº†');
                    this.showGoogleAuthPrompt();
                    
                } catch (error) {
                    console.error('âŒ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            showAdBlockerNotice() {
                // åºƒå‘Šãƒ–ãƒ­ãƒƒã‚«ãƒ¼æ¤œçŸ¥æ™‚ã®é€šçŸ¥
                const notice = document.createElement('div');
                notice.className = 'fixed top-4 right-4 bg-yellow-100 border-l-4 border-yellow-500 p-4 rounded shadow-lg z-50 max-w-sm';
                notice.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-shield-alt text-yellow-500"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-700">
                                <strong>åºƒå‘Šãƒ–ãƒ­ãƒƒã‚«ãƒ¼ã‚’æ¤œçŸ¥</strong><br>
                                åŒæœŸã¯æ­£å¸¸å‹•ä½œä¸­ã§ã™ã€‚ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ç„¡è¦–ã—ã¦å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
                            </p>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                    class="mt-2 text-xs bg-yellow-200 px-2 py-1 rounded">
                                ç†è§£ã—ã¾ã—ãŸ
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(notice);
                
                // 10ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
                setTimeout(() => {
                    if (notice.parentElement) {
                        notice.remove();
                    }
                }, 10000);
            }
            
            startSyncMonitoring() {
                // 30ç§’ã”ã¨ã«åŒæœŸçŠ¶æ…‹ã‚’ãƒ­ã‚°å‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
                if (this.syncMonitorInterval) {
                    clearInterval(this.syncMonitorInterval);
                }
                
                this.syncMonitorInterval = setInterval(() => {
                    if (this.firestore && this.user) {
                        console.log('ğŸ“Š åŒæœŸãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°:', {
                            userId: this.user.uid.substring(0, 8) + '...',
                            lastSyncTime: this.lastSyncTime ? new Date(this.lastSyncTime).toLocaleString() : 'ãªã—',
                            syncInProgress: this.syncInProgress,
                            tasksCount: this.tasks.length,
                            clientsCount: this.clients.length,
                            listenerActive: !!this.unsubscribeFirestore
                        });
                    }
                }, 30000); // 30ç§’é–“éš”
            }
            
            async testFirebaseConnection() {
                const apiKey = document.getElementById('firebase-api-key').value;
                const projectId = document.getElementById('firebase-project-id').value;
                
                if (!apiKey || !projectId) {
                    alert('API Keyã¨Project IDã®ä¸¡æ–¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                try {
                    this.updateFirebaseStatus('syncing');
                    
                    const config = {
                        apiKey: apiKey,
                        authDomain: `${projectId}.firebaseapp.com`,
                        projectId: projectId,
                        storageBucket: `${projectId}.appspot.com`,
                        messagingSenderId: "123456789",
                        appId: "1:123456789:web:abcdef"
                    };
                    
                    // ğŸ”’ ã‚»ã‚­ãƒ¥ã‚¢æ¥ç¶šãƒ†ã‚¹ãƒˆï¼ˆèªè¨¼ä¸è¦ï¼‰
                    console.log('ğŸ”¥ Firebaseæ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹ï¼ˆã‚»ã‚­ãƒ¥ã‚¢ãƒ¢ãƒ¼ãƒ‰ï¼‰');
                    const { initializeApp, getFirestore, getAuth } = window.FirebaseSDK;
                    
                    // FirebaseåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
                    const testApp = initializeApp(config, 'test-app');
                    // Firebase AppåˆæœŸåŒ–æˆåŠŸ
                    
                    // FirestoreåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãªã—ï¼‰
                    const testFirestore = getFirestore(testApp);
                    console.log('âœ… FirestoreåˆæœŸåŒ–æˆåŠŸ');
                    
                    // AuthåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆï¼ˆã‚µã‚¤ãƒ³ã‚¤ãƒ³ãªã—ï¼‰
                    const testAuth = getAuth(testApp);
                    // Firebase AuthåˆæœŸåŒ–æˆåŠŸ
                    
                    // è¨­å®šãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
                    if (!testApp || !testFirestore || !testAuth) {
                        throw new Error('FirebaseåˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    console.log('ğŸ‰ ã™ã¹ã¦ã®Firebaseã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–å®Œäº†');
                    
                    this.firebaseConfig = config;
                    this.updateFirebaseStatus('success');
                    alert('âœ… Firebaseæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸï¼è¨­å®šã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚');
                    
                } catch (error) {
                    // Firebaseæ¥ç¶šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼
                    this.updateFirebaseStatus('error');
                    
                    // ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã«å¿œã˜ãŸå…·ä½“çš„ãªè§£æ±ºç­–ã‚’æç¤º
                    let errorMessage = 'âŒ Firebaseæ¥ç¶šãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\n';
                    let solution = '';
                    
                    if (error.code === 'auth/admin-restricted-operation') {
                        solution = 'ğŸ”¥ Firebase Console ã§ä»¥ä¸‹ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š\n\n' +
                                 '1. Authentication ã‚’æœ‰åŠ¹åŒ–\n' +
                                 '2. Sign-in method ã§ Google ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è¿½åŠ \n' +
                                 '3. æ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³ ã«ç¾åœ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿½åŠ \n\n' +
                                 'è©³ç´°ã¯ docs/FIREBASE-SETUP.md ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚';
                    } else if (error.code === 'auth/invalid-api-key') {
                        solution = 'ğŸ”‘ API Key ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼š\n\n' +
                                 'â€¢ Firebase Console â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š â†’ å…¨èˆ¬\n' +
                                 'â€¢ ã‚¦ã‚§ãƒ– API ã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å†å…¥åŠ›ã—ã¦ãã ã•ã„';
                    } else if (error.code === 'auth/project-not-found') {
                        solution = 'ğŸ“ Project ID ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼š\n\n' +
                                 'â€¢ Firebase Console ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ID ã‚’ç¢ºèª\n' +
                                 'â€¢ æ­£ç¢ºãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ID ã‚’å†å…¥åŠ›ã—ã¦ãã ã•ã„';
                    } else {
                        solution = 'âš ï¸ ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ï¼š\n' + error.message + '\n\n' +
                                 'Firebase Console ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                    }
                    
                    alert(errorMessage + solution);
                }
            }
            
            // ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸæ©Ÿèƒ½ï¼ˆæ—§APIãƒãƒ¼ã‚¸ãƒ§ãƒ³ - éæ¨å¥¨ï¼‰
            async syncWithAPI() {
                if (this.syncInProgress || !this.syncEnabled) return;
                
                this.syncInProgress = true;
                console.log('ğŸ”„ ãƒ‡ãƒ¼ã‚¿åŒæœŸé–‹å§‹...');
                
                try {
                    // ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼šAPIæ¥ç¶šç¢ºèª
                    const testResponse = await fetch('tables/tasks?limit=1');
                    
                    if (testResponse.ok) {
                        // å„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é †ç•ªã«åŒæœŸ
                        await Promise.all([
                            this.syncTable('tasks', this.tasks),
                            this.syncTable('clients', this.clients),
                            this.syncTable('subtasks', this.subtasks),
                            this.syncTable('time_logs', this.timeLogs)
                        ]);
                        
                        this.lastSyncTime = Date.now();
                        this.updateSyncStatus('success', true); // ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¢ãƒ¼ãƒ‰
                        console.log('âœ… ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸå®Œäº†');
                    } else {
                        throw new Error(`API Error: ${testResponse.status}`);
                    }
                    
                } catch (error) {
                    console.error('âŒ åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
                    // APIæ¥ç¶šå¤±æ•—æ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ã§å‹•ä½œ
                    this.lastSyncTime = Date.now();
                    this.updateSyncStatus('success', false); // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰
                    console.log('ğŸ’¾ ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œä¸­');
                } finally {
                    this.syncInProgress = false;
                }
            }
            
            async syncTable(tableName, localData) {
                // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const response = await fetch(`tables/${tableName}`);
                const serverData = await response.json();
                
                // ãƒ­ãƒ¼ã‚«ãƒ«ã¨ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¯”è¼ƒãƒ»ãƒãƒ¼ã‚¸
                const mergedData = this.mergeData(localData, serverData.data || []);
                
                // å·®åˆ†ãŒã‚ã‚Œã°æ›´æ–°
                if (JSON.stringify(localData) !== JSON.stringify(mergedData)) {
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚’æ›´æ–°
                    this.updateLocalData(tableName, mergedData);
                    
                    // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
                    for (const item of mergedData) {
                        if (item._needsSync) {
                            await this.syncItemToServer(tableName, item);
                            delete item._needsSync;
                        }
                    }
                }
                
                return mergedData;
            }
            
            mergeData(localData, serverData) {
                const merged = new Map();
                
                // ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å…ˆã«è¿½åŠ 
                serverData.forEach(item => {
                    merged.set(item.id, { ...item, _source: 'server' });
                });
                
                // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ä¸Šæ›¸ãï¼ˆæ–°ã—ã„ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—å„ªå…ˆï¼‰
                localData.forEach(item => {
                    const existing = merged.get(item.id);
                    if (!existing || (item.updated_at || item.created_at) > (existing.updated_at || existing.created_at)) {
                        merged.set(item.id, { ...item, _source: 'local', _needsSync: true });
                    }
                });
                
                return Array.from(merged.values());
            }
            
            updateLocalData(tableName, data) {
                switch(tableName) {
                    case 'tasks':
                        this.tasks = data;
                        localStorage.setItem('taskflow_tasks', JSON.stringify(this.tasks));
                        break;
                    case 'clients':
                        this.clients = data;
                        localStorage.setItem('taskflow_clients', JSON.stringify(this.clients));
                        break;
                    case 'subtasks':
                        this.subtasks = data;
                        localStorage.setItem('taskflow_subtasks', JSON.stringify(this.subtasks));
                        break;
                    case 'time_logs':
                        this.timeLogs = data;
                        localStorage.setItem('taskflow_time_logs', JSON.stringify(this.timeLogs));
                        break;
                }
            }
            
            async syncItemToServer(tableName, item) {
                try {
                    const cleanItem = { ...item };
                    delete cleanItem._source;
                    delete cleanItem._needsSync;
                    
                    if (cleanItem.id) {
                        // æ—¢å­˜ã‚¢ã‚¤ãƒ†ãƒ ã®æ›´æ–°
                        await fetch(`tables/${tableName}/${cleanItem.id}`, {
                            method: 'PUT',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify(cleanItem)
                        });
                    } else {
                        // æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ ã®ä½œæˆ
                        const response = await fetch(`tables/${tableName}`, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify(cleanItem)
                        });
                        const created = await response.json();
                        // IDã‚’æ›´æ–°
                        item.id = created.id;
                    }
                } catch (error) {
                    console.error(`âŒ ${tableName}åŒæœŸã‚¨ãƒ©ãƒ¼:`, error);
                }
            }
            
            updateSyncStatus(status, isCloudMode = true) {
                const indicator = document.getElementById('sync-indicator');
                if (indicator) {
                    indicator.className = `sync-status ${status} ml-2`;
                    indicator.textContent = status === 'success' ? 'ğŸŸ¢' : status === 'error' ? 'ğŸ”´' : 'ğŸŸ¡';
                    console.log('ğŸ”„ åŒæœŸçŠ¶æ…‹æ›´æ–°:', status, indicator.textContent);
                }
                
                // ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã‚’æ›´æ–°
                const modeText = document.getElementById('sync-mode-text');
                if (modeText) {
                    if (status === 'success') {
                        modeText.textContent = isCloudMode ? 
                            'ğŸŒ ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒã‚¤ã‚¹é–“åŒæœŸæœ‰åŠ¹ï¼‰' : 
                            'ğŸ’¾ ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ãƒ¢ãƒ¼ãƒ‰ï¼ˆå˜ä¸€ãƒ‡ãƒã‚¤ã‚¹å°‚ç”¨ï¼‰';
                    } else {
                        modeText.textContent = 'âš ï¸ åŒæœŸè¨­å®šç¢ºèªä¸­...';
                    }
                }
                
                // æœ€çµ‚åŒæœŸæ™‚åˆ»ã‚’æ›´æ–°
                this.updateLastSyncDisplay();
                
                // è¨­å®šã‚’ä¿å­˜
                this.settings.lastSyncTime = this.lastSyncTime;
                this.settings.syncEnabled = this.syncEnabled;
                localStorage.setItem('taskflow_settings', JSON.stringify(this.settings));
            }
            
            updateLastSyncDisplay() {
                const element = document.getElementById('last-sync-time');
                if (element) {
                    if (this.lastSyncTime) {
                        const date = new Date(this.lastSyncTime);
                        element.textContent = date.toLocaleString('ja-JP');
                    } else {
                        element.textContent = 'æœªåŒæœŸ';
                    }
                }
            }
            
            startAutoSync() {
                if (this.syncInterval) clearInterval(this.syncInterval);
                
                console.log('ğŸš€ è‡ªå‹•åŒæœŸé–‹å§‹');
                // 30ç§’ã”ã¨ã«è‡ªå‹•åŒæœŸ
                this.syncInterval = setInterval(() => {
                    this.syncWithAPI();
                }, 30000);
                
                // åˆå›åŒæœŸ
                this.syncWithAPI();
            }
            
            saveFirebaseSettings() {
                const apiKey = document.getElementById('firebase-api-key').value;
                const projectId = document.getElementById('firebase-project-id').value;
                
                if (!apiKey || !projectId) {
                    alert('API Keyã¨Project IDã®ä¸¡æ–¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                this.firebaseConfig = {
                    apiKey: apiKey,
                    authDomain: `${projectId}.firebaseapp.com`,
                    projectId: projectId,
                    storageBucket: `${projectId}.appspot.com`,
                    messagingSenderId: "123456789",
                    appId: "1:123456789:web:abcdef"
                };
                
                console.log('ğŸ’¾ Firebaseè¨­å®šä¿å­˜:', {
                    projectId: projectId,
                    authDomain: this.firebaseConfig.authDomain
                });
                
                this.firebaseEnabled = true;
                this.saveSettings();
                
                // ãƒœã‚¿ãƒ³ã‚’ä¸€æ™‚ç„¡åŠ¹åŒ–
                this.disableGoogleSigninBtn();
                
                // FirebaseåˆæœŸåŒ–
                this.initializeFirebase().then(() => {
                    // Googleèªè¨¼ãƒœã‚¿ãƒ³ã‚’æ­£å¸¸åŒ–
                    this.enableGoogleSigninBtn();
                    alert('âœ… Firebaseè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚\nã€ŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã€ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚');
                }).catch((error) => {
                    // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹ã«æˆ»ã™ï¼ˆå†è¨­å®šã§ãã‚‹ã‚ˆã†ï¼‰
                    this.enableGoogleSigninBtnWithConfig();
                    alert('âŒ FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ' + error.message);
                });
                
                alert('âœ… Firebaseè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚åŒæœŸã‚’é–‹å§‹ã—ã¾ã™ã€‚');
            }
            
            stopFirebaseSync() {
                if (this.unsubscribeFirestore) {
                    this.unsubscribeFirestore();
                    this.unsubscribeFirestore = null;
                }
                
                this.firebaseApp = null;
                this.firestore = null;
                this.auth = null;
                this.user = null;
                this.firebaseEnabled = false;
                
                this.updateFirebaseStatus('error');
                console.log('ğŸ”¥ FirebaseåŒæœŸã‚’åœæ­¢ã—ã¾ã—ãŸ');
            }
            
            stopAutoSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                    this.syncInterval = null;
                }
            }
            
            bindEvents() {
                // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        // e.currentTargetã‚’ä½¿ç”¨ã—ã¦ãƒœã‚¿ãƒ³è¦ç´ è‡ªä½“ã‚’å–å¾—
                        const tab = e.currentTarget.dataset.tab;
                        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚°ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
                        // console.log('ğŸ¯ ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯:', tab);
                        if (tab) {
                            this.switchTab(tab);
                        }
                    });
                });
                
                // ã‚¿ã‚¹ã‚¯é–¢é€£
                document.getElementById('add-task-btn').addEventListener('click', () => this.openTaskModal());
                document.getElementById('close-modal').addEventListener('click', () => this.closeTaskModal());
                document.getElementById('cancel-btn').addEventListener('click', () => this.closeTaskModal());
                document.getElementById('task-form').addEventListener('submit', (e) => this.handleTaskSubmit(e));
                document.getElementById('add-subtask-btn').addEventListener('click', () => this.addSubtaskInput());
                
                // é¡§å®¢é–¢é€£
                document.getElementById('add-client-btn').addEventListener('click', () => this.openClientModal());
                document.getElementById('close-client-modal').addEventListener('click', () => this.closeClientModal());
                document.getElementById('cancel-client-btn').addEventListener('click', () => this.closeClientModal());
                document.getElementById('client-form').addEventListener('submit', (e) => this.handleClientSubmit(e));
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢
                document.getElementById('search-input').addEventListener('input', () => this.renderTasks());
                document.getElementById('filter-status').addEventListener('change', () => this.renderTasks());
                document.getElementById('filter-priority').addEventListener('change', () => this.renderTasks());
                
                // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ
                document.getElementById('gantt-prev-month').addEventListener('click', () => this.changeGanttMonth(-1));
                document.getElementById('gantt-next-month').addEventListener('click', () => this.changeGanttMonth(1));
                document.getElementById('gantt-today-month').addEventListener('click', () => this.goToCurrentMonth());
                
                // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆåˆæœŸåŒ–æ™‚ã«è¨­å®šï¼‰
                this.bindGanttEvents();
                
                // è¨­å®š
                // ğŸ”¥ Firebaseè¨­å®š
                const firebaseSyncToggle = document.getElementById('firebase-sync-toggle');
                if (firebaseSyncToggle) {
                    firebaseSyncToggle.addEventListener('change', (e) => {
                        const configPanel = document.getElementById('firebase-config');
                        if (e.target.checked) {
                            configPanel.classList.remove('hidden');
                        } else {
                            configPanel.classList.add('hidden');
                            this.firebaseEnabled = false;
                            this.stopFirebaseSync();
                        }
                    });
                }
                
                const firebaseTestBtn = document.getElementById('firebase-test-btn');
                if (firebaseTestBtn) {
                    firebaseTestBtn.addEventListener('click', () => this.testFirebaseConnection());
                }
                
                const firebaseSaveBtn = document.getElementById('firebase-save-btn');
                if (firebaseSaveBtn) {
                    firebaseSaveBtn.addEventListener('click', () => this.saveFirebaseSettings());
                }
                
                const firebaseManualSyncBtn = document.getElementById('firebase-manual-sync-btn');
                if (firebaseManualSyncBtn) {
                    firebaseManualSyncBtn.addEventListener('click', async () => {
                        console.log('ğŸ”„ æ‰‹å‹•åŒæœŸå®Ÿè¡Œ...');
                        firebaseManualSyncBtn.disabled = true;
                        firebaseManualSyncBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>åŒæœŸä¸­...';
                        
                        try {
                            if (this.firestore && this.user) {
                                const { doc, getDoc } = window.FirebaseSDK;
                                const userDocRef = doc(this.firestore, 'users', this.user.uid);
                                const docSnap = await getDoc(userDocRef);
                                
                                if (docSnap.exists()) {
                                    const firebaseData = docSnap.data();
                                    this.lastSyncTime = 0; // å¼·åˆ¶æ›´æ–°
                                    this.mergeFirebaseData(firebaseData);
                                    alert(`âœ… åŒæœŸå®Œäº†ï¼\nã‚¿ã‚¹ã‚¯: ${firebaseData.tasks?.length || 0}ä»¶\né¡§å®¢: ${firebaseData.clients?.length || 0}ä»¶`);
                                } else {
                                    await this.uploadToFirebase();
                                    alert('âœ… ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’Firebaseã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚');
                                }
                            } else {
                                alert('âŒ Firebaseæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                            }
                        } catch (error) {
                            console.error('âŒ æ‰‹å‹•åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
                            alert('âŒ åŒæœŸã‚¨ãƒ©ãƒ¼: ' + error.message);
                        } finally {
                            firebaseManualSyncBtn.disabled = false;
                            firebaseManualSyncBtn.innerHTML = '<i class="fas fa-sync mr-1"></i>æ‰‹å‹•åŒæœŸå®Ÿè¡Œ';
                        }
                    });
                }
                
                // ğŸ” æ—¢å­˜ãƒ‡ãƒ¼ã‚¿æ¤œç´¢ãƒ»å–å¾—æ©Ÿèƒ½ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
                setTimeout(() => {
                    const firebaseSearchBtn = document.getElementById('firebase-search-existing-btn');
                    if (firebaseSearchBtn) {
                        firebaseSearchBtn.addEventListener('click', async () => {
                    console.log('ğŸ” æ—¢å­˜ãƒ‡ãƒ¼ã‚¿æ¤œç´¢é–‹å§‹...');
                    existingDataBtn.disabled = true;
                    existingDataBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>æ¤œç´¢ä¸­...';
                    
                    try {
                        if (!this.firestore) {
                            alert('âŒ Firebaseæœªæ¥ç¶š');
                            return;
                        }
                        
                        const { collection, getDocs } = window.FirebaseSDK;
                        const usersRef = collection(this.firestore, 'users');
                        const snapshot = await getDocs(usersRef);
                        
                        console.log('ğŸ“Š Firebaseãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§:');
                        const availableUsers = [];
                        
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            const userInfo = {
                                userId: doc.id,
                                tasksCount: data.tasks?.length || 0,
                                clientsCount: data.clients?.length || 0,
                                lastModified: data.lastModified ? new Date(data.lastModified).toLocaleString() : 'ãªã—'
                            };
                            console.log(`ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${doc.id}`, userInfo);
                            availableUsers.push({ id: doc.id, data, info: userInfo });
                        });
                        
                        if (availableUsers.length === 0) {
                            alert('ğŸ“„ Firebaseã«ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                            return;
                        }
                        
                        // æœ€ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒå¤šã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ
                        const bestUser = availableUsers.reduce((prev, current) => {
                            const prevTotal = (prev.data.tasks?.length || 0) + (prev.data.clients?.length || 0);
                            const currentTotal = (current.data.tasks?.length || 0) + (current.data.clients?.length || 0);
                            return currentTotal > prevTotal ? current : prev;
                        });
                        
                        console.log('ğŸ¯ æœ€é©ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ:', bestUser.id, bestUser.info);
                        
                        const confirmMsg = `ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼š\n\n` +
                            `ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${bestUser.id}\n` +
                            `ã‚¿ã‚¹ã‚¯: ${bestUser.info.tasksCount}ä»¶\n` +
                            `é¡§å®¢: ${bestUser.info.clientsCount}ä»¶\n` +
                            `æ›´æ–°æ—¥æ™‚: ${bestUser.info.lastModified}\n\n` +
                            `ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã‹ï¼Ÿ`;
                        
                        if (confirm(confirmMsg)) {
                            // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å¤‰æ›´ã—ã¦å–å¾—
                            this.user = { uid: bestUser.id };
                            console.log('ğŸ”„ ãƒ¦ãƒ¼ã‚¶ãƒ¼IDå¤‰æ›´:', bestUser.id);
                            
                            // ãƒ‡ãƒ¼ã‚¿ã‚’å¼·åˆ¶å–å¾—
                            this.lastSyncTime = 0; // å¼·åˆ¶æ›´æ–°
                            this.mergeFirebaseData(bestUser.data);
                            
                            alert('âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—å®Œäº†ï¼ç”»é¢ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                        }
                        
                    } catch (error) {
                        console.error('âŒ ãƒ‡ãƒ¼ã‚¿æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
                        alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
                    } finally {
                        existingDataBtn.disabled = false;
                            firebaseSearchBtn.innerHTML = '<i class="fas fa-search mr-1"></i>æ—¢å­˜ãƒ‡ãƒ¼ã‚¿æ¤œç´¢ãƒ»å–å¾—';
                        }
                    });
                    }
                }, 1000); // DOMèª­ã¿è¾¼ã¿å®Œäº†å¾Œã«å®Ÿè¡Œ
                
                // Googleèªè¨¼ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
                setTimeout(() => {
                    const googleSigninBtn = document.getElementById('google-signin-btn');
                    const googleSignoutBtn = document.getElementById('google-signout-btn');
                    
                    if (googleSigninBtn) {
                        googleSigninBtn.addEventListener('click', () => this.signInWithGoogle());
                    }
                    if (googleSignoutBtn) {
                        googleSignoutBtn.addEventListener('click', () => this.signOutGoogle());
                    }
                }, 1000);
                
                document.getElementById('calendar-sync-toggle').addEventListener('change', (e) => {
                    document.getElementById('calendar-settings').classList.toggle('hidden', !e.target.checked);
                    this.saveSettings();
                });
                

                document.getElementById('google-auth-btn').addEventListener('click', () => this.authenticateGoogleCalendar());
                document.getElementById('test-calendar-connection').addEventListener('click', () => this.testCalendarConnection());
                document.getElementById('sync-tasks-to-calendar').addEventListener('click', () => this.syncTasksToCalendar());
                
                // è‡ªå‹•åŒæœŸãƒˆã‚°ãƒ«
                document.getElementById('auto-sync-toggle').addEventListener('change', (e) => {
                    this.saveSettings();
                    if (e.target.checked) {
                        console.log('âœ… è‡ªå‹•åŒæœŸãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ');
                    } else {
                        console.log('âŒ è‡ªå‹•åŒæœŸãŒç„¡åŠ¹ã«ãªã‚Šã¾ã—ãŸ');
                    }
                });
                
                // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
                document.getElementById('export-data-btn').addEventListener('click', () => this.exportData());
                document.getElementById('import-data-btn').addEventListener('click', () => document.getElementById('import-file-input').click());
                document.getElementById('import-file-input').addEventListener('change', (e) => this.importData(e));
                document.getElementById('clear-data-btn').addEventListener('click', () => this.clearAllData());
                
                // ã‚¿ã‚¹ã‚¯ãƒšãƒ¼ã‚¸ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆæœŸåŒ–
                setTimeout(() => {
                    this.initializeTaskFilters();
                }, 500);
            }
            
            switchTab(tabName) {
                this.currentTab = tabName;
                
                // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.tab === tabName) {
                        btn.classList.add('active');
                    }
                });
                
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤º/éè¡¨ç¤º
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`${tabName}-view`).classList.remove('hidden');
                
                // æ¤œç´¢ãƒãƒ¼è¡¨ç¤ºçŠ¶æ…‹ã‚’ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›
                console.log(`ğŸ“‹ ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ: ${tabName}`);
                const taskSearch = document.getElementById('search-input');
                const ganttSearch = document.getElementById('gantt-search-input');
                console.log(`ã‚¿ã‚¹ã‚¯æ¤œç´¢ãƒãƒ¼è¡¨ç¤ºçŠ¶æ…‹: ${taskSearch ? window.getComputedStyle(taskSearch).display : 'ãªã—'}`);
                console.log(`ã‚¬ãƒ³ãƒˆæ¤œç´¢ãƒãƒ¼è¡¨ç¤ºçŠ¶æ…‹: ${ganttSearch ? window.getComputedStyle(ganttSearch).display : 'ãªã—'}`);
                
                // ã‚¿ãƒ–å›ºæœ‰ã®åˆæœŸåŒ–å‡¦ç†
                switch (tabName) {
                    case 'tasks':
                        this.renderTasks();
                        setTimeout(() => this.initializeTaskFilters(), 100);
                        break;
                    case 'gantt':
                        this.renderGanttChart();
                        this.bindGanttEvents(); // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã‚¿ãƒ–ã§ã‚¤ãƒ™ãƒ³ãƒˆå†è¨­å®š
                        break;
                    case 'clients':
                        this.renderClients();
                        break;
                    case 'reports':
                        this.renderReports();
                        break;
                    case 'settings':
                        this.loadSettings();
                        break;
                }
            }
            
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
            
            addDemoLongNameTasks() {
                const demoTasks = [
                    {
                        id: this.generateId(),
                        title: 'çŸ­ã„ã‚¿ã‚¹ã‚¯å',
                        description: 'ã“ã‚Œã¯çŸ­ã„ã‚¿ã‚¹ã‚¯åã®ãƒ†ã‚¹ãƒˆã§ã™',
                        deadline: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        priority: 'high',
                        status: 'pending',
                        estimated_hours: 2,
                        actual_hours: 0,
                        client_id: null,
                        created_at: new Date().toISOString(),
                        timer_state: 'stopped',
                        is_timing: false,
                        current_timer_start: null,
                        total_timer_seconds: 0
                    },
                    {
                        id: this.generateId(),
                        title: 'ã¨ã¦ã‚‚é•·ã„ã‚¿ã‚¹ã‚¯åã®ä¾‹ï¼šæ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¼ç”»æ›¸ä½œæˆã¨é¡§å®¢å‘ã‘ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è³‡æ–™ã®æº–å‚™åŠã³é–¢ä¿‚è€…ã¨ã®èª¿æ•´æ¥­å‹™ã‚’å«ã‚€åŒ…æ‹¬çš„ãªã‚¿ã‚¹ã‚¯ç®¡ç†',
                        description: 'ã“ã‚Œã¯é•·ã„ã‚¿ã‚¹ã‚¯åã§ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ†ã‚¹ãƒˆã§ã™',
                        deadline: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        priority: 'medium',
                        status: 'in_progress',
                        estimated_hours: 8,
                        actual_hours: 2.5,
                        client_id: null,
                        created_at: new Date().toISOString(),
                        timer_state: 'stopped',
                        is_timing: false,
                        current_timer_start: null,
                        total_timer_seconds: 0
                    },
                    {
                        id: this.generateId(),
                        title: 'æ¥µç«¯ã«é•·ã„ã‚¿ã‚¹ã‚¯åã®ã‚±ãƒ¼ã‚¹ï¼šAIã‚’æ´»ç”¨ã—ãŸæ¥­å‹™åŠ¹ç‡åŒ–ã‚·ã‚¹ãƒ†ãƒ ã®å°å…¥æ¤œè¨ã‹ã‚‰è¦ä»¶å®šç¾©ã€è¨­è¨ˆã€é–‹ç™ºã€ãƒ†ã‚¹ãƒˆã€é‹ç”¨ä¿å®ˆã¾ã§ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å…¨ä½“ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†æ¥­å‹™',
                        description: 'æ¥µç«¯ã«é•·ã„ã‚¿ã‚¹ã‚¯åã§ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹',
                        deadline: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        priority: 'high',
                        status: 'pending',
                        estimated_hours: 40,
                        actual_hours: 0,
                        client_id: null,
                        created_at: new Date().toISOString(),
                        timer_state: 'running',
                        is_timing: true,
                        current_timer_start: new Date().toISOString(),
                        total_timer_seconds: 3600
                    },
                    {
                        id: this.generateId(),
                        title: 'ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºç¢ºèªç”¨ã®ä¸­ç¨‹åº¦ã®é•·ã•ã®ã‚¿ã‚¹ã‚¯åï¼šUIæ”¹å–„ã¨ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ',
                        description: 'ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã®åˆ‡ã‚Šæ¨ã¦æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ',
                        deadline: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        priority: 'low',
                        status: 'completed',
                        estimated_hours: 4,
                        actual_hours: 3.5,
                        client_id: null,
                        created_at: new Date().toISOString(),
                        timer_state: 'stopped',
                        is_timing: false,
                        current_timer_start: null,
                        total_timer_seconds: 0
                    }
                ];
                
                this.tasks.push(...demoTasks);
                localStorage.setItem('taskflow_tasks', JSON.stringify(this.tasks));
                console.log('ğŸ“‹ ãƒ‡ãƒ¢ç”¨é•·ã„ã‚¿ã‚¹ã‚¯åãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
            }
            
            // æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
            formatHoursToHHMM(hours) {
                if (isNaN(hours) || hours < 0) return '0:00';
                
                const totalMinutes = Math.round(hours * 60);
                const h = Math.floor(totalMinutes / 60);
                const m = totalMinutes % 60;
                
                return `${h}:${m.toString().padStart(2, '0')}`;
            }
            
            formatHoursToReadable(hours) {
                if (isNaN(hours) || hours < 0) return '0æ™‚é–“0åˆ†';
                
                const totalMinutes = Math.round(hours * 60);
                const h = Math.floor(totalMinutes / 60);
                const m = totalMinutes % 60;
                
                if (h > 0 && m > 0) {
                    return `${h}æ™‚é–“${m}åˆ†`;
                } else if (h > 0) {
                    return `${h}æ™‚é–“`;
                } else {
                    return `${m}åˆ†`;
                }
            }

            linkifyText(text) {
                // URLæ¤œå‡ºã®ãŸã‚ã®æ­£è¦è¡¨ç¾
                const urlRegex = /(https?:\/\/[^\s<>"{}|\\^`[\]]*)/gi;
                
                return text.replace(urlRegex, (url) => {
                    // URLã‚’å®‰å…¨ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
                    const safeUrl = url.replace(/"/g, '&quot;');
                    return `<a href="${safeUrl}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 underline break-all" onclick="event.stopPropagation()">${url}</a>`;
                });
            }
            
            saveData() {
                // ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ï¼šå­˜åœ¨ã—ãªã„è¦ªã‚¿ã‚¹ã‚¯IDã‚’æŒã¤ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤
                const validTaskIds = this.tasks.map(t => t.id);
                this.subtasks = this.subtasks.filter(st => validTaskIds.includes(st.parent_task_id));
                
                localStorage.setItem('taskflow_tasks', JSON.stringify(this.tasks));
                localStorage.setItem('taskflow_clients', JSON.stringify(this.clients));
                localStorage.setItem('taskflow_subtasks', JSON.stringify(this.subtasks));
                localStorage.setItem('taskflow_time_logs', JSON.stringify(this.timeLogs));
                
                // ğŸ”¥ FirebaseåŒæœŸãƒˆãƒªã‚¬ãƒ¼
                if (this.firebaseEnabled && this.firestore && this.user && !this.syncInProgress) {
                    setTimeout(() => this.uploadToFirebase(), 500); // 0.5ç§’å¾Œã«åŒæœŸ
                }
            }
            
            saveSettings() {
                const settings = {
                    calendarSync: document.getElementById('calendar-sync-toggle').checked,
                    autoSync: document.getElementById('auto-sync-toggle').checked,
                    calendarId: document.getElementById('calendar-id').value,
                    googleApiKey: document.getElementById('google-api-key').value,
                    googleClientId: document.getElementById('google-client-id').value,

                    // ğŸ”¥ Firebaseè¨­å®šã‚’è¿½åŠ 
                    firebaseEnabled: this.firebaseEnabled,
                    firebaseConfig: this.firebaseConfig,
                    lastSyncTime: this.lastSyncTime
                };
                this.settings = settings;
                localStorage.setItem('taskflow_settings', JSON.stringify(settings));
            }
            
            loadSettings() {
                // ğŸ”¥ Firebaseè¨­å®šã®èª­ã¿è¾¼ã¿
                const firebaseSyncToggle = document.getElementById('firebase-sync-toggle');
                if (firebaseSyncToggle) {
                    firebaseSyncToggle.checked = this.firebaseEnabled;
                    if (this.firebaseEnabled) {
                        document.getElementById('firebase-config').classList.remove('hidden');
                    }
                }
                
                if (this.firebaseConfig) {
                    const apiKeyField = document.getElementById('firebase-api-key');
                    const projectIdField = document.getElementById('firebase-project-id');
                    
                    if (apiKeyField && this.firebaseConfig.apiKey) {
                        apiKeyField.value = this.firebaseConfig.apiKey;
                    }
                    if (projectIdField && this.firebaseConfig.projectId) {
                        projectIdField.value = this.firebaseConfig.projectId;
                    }
                }
                
                this.updateLastSyncDisplay();
                
                if (this.settings.calendarSync) {
                    document.getElementById('calendar-sync-toggle').checked = true;
                    document.getElementById('calendar-settings').classList.remove('hidden');
                }
                if (this.settings.calendarId) {
                    document.getElementById('calendar-id').value = this.settings.calendarId;
                }
                if (this.settings.googleApiKey) {
                    document.getElementById('google-api-key').value = this.settings.googleApiKey;
                }
                if (this.settings.googleClientId) {
                    document.getElementById('google-client-id').value = this.settings.googleClientId;
                }

                if (this.settings.autoSync !== undefined) {
                    document.getElementById('auto-sync-toggle').checked = this.settings.autoSync;
                } else {
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è‡ªå‹•åŒæœŸã‚’æœ‰åŠ¹ã«
                    document.getElementById('auto-sync-toggle').checked = true;
                }
                
                // Google Calendar APIã®åˆæœŸåŒ–
                if (this.settings.googleApiKey && this.settings.googleClientId) {
                    this.initializeGoogleCalendarAPI();
                }
            }
            
            // ã‚¿ã‚¹ã‚¯ç®¡ç†æ©Ÿèƒ½
            openTaskModal(task = null) {
                this.currentEditingTask = task;
                const modal = document.getElementById('task-modal');
                const title = document.getElementById('modal-title');
                
                // ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚³ãƒ³ãƒ†ãƒŠã‚’å¿…ãšã‚¯ãƒªã‚¢
                document.getElementById('subtasks-container').innerHTML = '';
                
                if (task) {
                    title.textContent = 'ã‚¿ã‚¹ã‚¯ã‚’ç·¨é›†';
                    // å…ˆã«é¡§å®¢é¸æŠè‚¢ã‚’ä½œæˆï¼ˆç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹é¡§å®¢IDã‚’æ¸¡ã™ï¼‰
                    this.populateClientSelect(task.client_id);
                    this.populateTaskForm(task);
                } else {
                    title.textContent = 'æ–°ã—ã„ã‚¿ã‚¹ã‚¯';
                    document.getElementById('task-form').reset();
                    // æ–°è¦ä½œæˆæ™‚ã¯é€šå¸¸ã®é¡§å®¢é¸æŠè‚¢ã‚’ä½œæˆ
                    this.populateClientSelect();
                }
                
                modal.classList.remove('hidden');
                
                // ğŸ”§ ãƒ¢ãƒ¼ãƒ€ãƒ«UXå‘ä¸Šæ©Ÿèƒ½
                // Escapeã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                this.handleModalKeydown = (e) => {
                    if (e.key === 'Escape') {
                        this.closeTaskModal();
                    }
                };
                document.addEventListener('keydown', this.handleModalKeydown);
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®æœ€åˆã®å…¥åŠ›è¦ç´ ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
                setTimeout(() => {
                    const firstInput = modal.querySelector('input, select, textarea');
                    if (firstInput) {
                        firstInput.focus();
                    }
                    
                    // ğŸ¯ PCç”»é¢ï¼ˆ769pxä»¥ä¸Šï¼‰ã§ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã‚’90%å¹…ã«å¼·åˆ¶è¨­å®š
                    this.applyModalFormWidth();
                    
                    // ğŸ”§ ãƒ‡ãƒãƒƒã‚°ï¼šã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®šã®ç¢ºèª
                    const modalContent = modal.querySelector('.bg-white');
                    if (modalContent) {
                        console.log('ğŸ” ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®šç¢ºèª:', {
                            overflowY: getComputedStyle(modalContent).overflowY,
                            maxHeight: getComputedStyle(modalContent).maxHeight,
                            height: getComputedStyle(modalContent).height,
                            scrollHeight: modalContent.scrollHeight,
                            clientHeight: modalContent.clientHeight,
                            display: getComputedStyle(modalContent).display,
                            isScrollable: modalContent.scrollHeight > modalContent.clientHeight
                        });
                        
                        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãŒå¿…è¦ã‹ãƒ†ã‚¹ãƒˆ
                        if (modalContent.scrollHeight <= modalContent.clientHeight) {
                            console.warn('âš ï¸ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¸è¦ã‚µã‚¤ã‚ºã§ã™ã€‚ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’é•·ãã—ã¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚');
                        }
                        
                        // ğŸ”§ å¸¸ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å¼·åˆ¶çš„ã«æœ‰åŠ¹åŒ–ï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚µã‚¤ã‚ºã«é–¢ä¿‚ãªãï¼‰
                        modalContent.style.setProperty('overflow-y', 'auto', 'important'); // scroll â†’ autoï¼ˆã‚ˆã‚Šè‡ªç„¶ï¼‰
                        modalContent.style.setProperty('overflow-x', 'hidden', 'important');
                        modalContent.style.setProperty('display', 'block', 'important');
                        modalContent.style.setProperty('max-height', '85vh', 'important'); // 60vh â†’ 85vhï¼ˆã‚ˆã‚Šå®Ÿç”¨çš„ï¼‰
                        modalContent.style.setProperty('min-height', '400px', 'important');
                        
                        // è¦ªè¦ç´ ã®ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹è¨­å®šã‚‚ä¸Šæ›¸ã
                        const parentModal = document.getElementById('task-modal');
                        if (parentModal) {
                            parentModal.style.setProperty('align-items', 'flex-start', 'important');
                        }
                        
                        console.log('âœ… JavaScriptã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å¼·åˆ¶æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸï¼ˆ60vhåˆ¶é™ï¼‰');
                            
                        // ãƒ†ã‚¹ãƒˆç”¨ï¼šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä¸€æ™‚çš„ã«é•·ãã™ã‚‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ã®ã¿ï¼‰
                        if (window.location.search.includes('debug=scroll')) {
                            const testContent = document.createElement('div');
                            testContent.innerHTML = '<div style="height: 1500px; background: linear-gradient(to bottom, #f0f0f0, #e0e0e0); margin: 20px 0; padding: 20px; border: 2px dashed #ccc;">ğŸ” ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆç”¨ã®é•·ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„<br><br>ã“ã®ç¸¦é•·ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚<br><br>â¬‡ï¸ ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã¾ã§ç§»å‹•ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>';
                            const form = modalContent.querySelector('form');
                            if (form) {
                                form.appendChild(testContent);
                            } else {
                                modalContent.appendChild(testContent);
                            }
                            console.log('ğŸ§ª ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼šã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆç”¨é•·ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼ˆ?debug=scrollï¼‰');
                        }
                    }
                }, 100);
            }
            
            closeTaskModal() {
                document.getElementById('task-modal').classList.add('hidden');
                this.currentEditingTask = null;
                // Escapeã‚­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
                document.removeEventListener('keydown', this.handleModalKeydown);
            }
            
            populateTaskForm(task) {
                document.getElementById('task-id').value = task.id;
                document.getElementById('task-title').value = task.title || '';
                document.getElementById('task-deadline').value = task.deadline || '';
                document.getElementById('task-priority').value = task.priority || 'medium';
                
                if (task.scheduled_date) {
                    // datetime-localãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãŸã‚ã«ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã¨ã—ã¦è¡¨ç¤º
                    // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚ªãƒ•ã‚»ãƒƒãƒˆã¯æ‰‹å‹•èª¿æ•´ã›ãšã€ãƒ–ãƒ©ã‚¦ã‚¶ã®è‡ªå‹•å¤‰æ›ã«ä»»ã›ã‚‹
                    const scheduledDate = new Date(task.scheduled_date);
                    if (!isNaN(scheduledDate.getTime())) {
                        // ISOå½¢å¼ã®æœ€åˆã®16æ–‡å­—ï¼ˆYYYY-MM-DDTHH:mmï¼‰ã‚’ä½¿ç”¨
                        document.getElementById('task-scheduled').value = scheduledDate.toISOString().slice(0, 16);
                    } else {
                        document.getElementById('task-scheduled').value = '';
                    }
                } else {
                    document.getElementById('task-scheduled').value = '';
                }
                
                document.getElementById('task-description').value = task.description || '';
                // é¡§å®¢é¸æŠï¼ˆäºŒé‡ä¿è¨¼ã®ãŸã‚å†è¨­å®šï¼‰
                document.getElementById('task-client').value = task.client_id || '';
                document.getElementById('task-estimated-hours').value = task.estimated_hours || '';
                
                // ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚’èª­ã¿è¾¼ã¿
                const taskSubtasks = this.subtasks.filter(st => st.parent_task_id === task.id);
                console.log(`ã‚¿ã‚¹ã‚¯ID ${task.id} ã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯æ•°: ${taskSubtasks.length}`);
                taskSubtasks.forEach(subtask => {
                    console.log(`ã‚µãƒ–ã‚¿ã‚¹ã‚¯è¿½åŠ : ${subtask.title} (parent: ${subtask.parent_task_id})`);
                    this.addSubtaskInput(subtask.title, subtask.completed, subtask.deadline);
                });
                
                // æ™‚é–“ãƒ­ã‚°ã‚’è¡¨ç¤º
                this.displayTimeLogs(task);
            }
            
            displayTimeLogs(task) {
                const timeLogsSection = document.getElementById('time-logs-section');
                const timeLogsContainer = document.getElementById('time-logs-container');
                const totalHoursDisplay = document.getElementById('total-hours-display');
                
                // æ™‚é–“ãƒ­ã‚°ãŒã‚ã‚‹å ´åˆã®ã¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                const timeSessions = task.time_sessions || [];
                
                if (timeSessions.length > 0) {
                    timeLogsSection.classList.remove('hidden');
                    
                    // åˆè¨ˆæ™‚é–“ã‚’è¨ˆç®—
                    const totalHours = timeSessions.reduce((sum, session) => sum + (session.hours || 0), 0);
                    totalHoursDisplay.textContent = this.formatHoursToReadable(totalHours);
                    
                    // ãƒ­ã‚°ã‚’è¡¨ç¤º
                    timeLogsContainer.innerHTML = '';
                    timeSessions.forEach(session => {
                        const logDiv = document.createElement('div');
                        logDiv.className = 'bg-gray-50 rounded-lg p-3 border';
                        
                        const startDate = new Date(session.start_time);
                        const endDate = new Date(session.end_time);
                        
                        logDiv.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="text-sm text-gray-600">
                                        ${startDate.toLocaleDateString('ja-JP')} 
                                        ${startDate.toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit'})} - 
                                        ${endDate.toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit'})}
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">
                                        ${this.formatHoursToReadable(session.hours)}
                                        ${session.action === 'pause' ? '(ä¸€æ™‚åœæ­¢)' : ''}
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="app.editTimeLog('${session.id}', '${task.id}')" 
                                            class="text-blue-600 hover:text-blue-700 text-sm">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="app.deleteTimeLog('${session.id}', '${task.id}')" 
                                            class="text-red-600 hover:text-red-700 text-sm">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        
                        timeLogsContainer.appendChild(logDiv);
                    });
                } else {
                    timeLogsSection.classList.add('hidden');
                }
            }
            
            populateClientSelect(selectedClientId = null) {
                const select = document.getElementById('task-client');
                const currentValue = selectedClientId || select.value;
                select.innerHTML = '<option value="">é¡§å®¢ã‚’é¸æŠ</option>';
                
                this.clients.forEach(client => {
                    const option = document.createElement('option');
                    option.value = client.id;
                    option.textContent = `${client.name}${client.company ? ` (${client.company})` : ''}`;
                    if (client.id === currentValue) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
            }
            
            addSubtaskInput(title = '', completed = false, deadline = '') {
                const container = document.getElementById('subtasks-container');
                const subtaskDiv = document.createElement('div');
                // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã®ã‚¯ãƒ©ã‚¹ã‚’é©ç”¨
                subtaskDiv.className = 'subtask-item flex items-center gap-2 mb-2 w-full';
                
                subtaskDiv.innerHTML = `
                    <input type="checkbox" ${completed ? 'checked' : ''} class="custom-checkbox subtask-checkbox flex-shrink-0">
                    <input type="text" placeholder="ã‚µãƒ–ã‚¿ã‚¹ã‚¯" value="${title}" class="subtask-title px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <input type="date" value="${deadline}" class="subtask-date px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <button type="button" class="text-red-500 hover:text-red-700 remove-subtask flex-shrink-0 p-1 rounded hover:bg-red-50 transition-colors">
                        <i class="fas fa-trash text-sm"></i>
                    </button>
                `;
                
                subtaskDiv.querySelector('.remove-subtask').addEventListener('click', () => {
                    subtaskDiv.remove();
                });
                
                container.appendChild(subtaskDiv);
            }
            
            handleTaskSubmit(e) {
                e.preventDefault();
                
                const taskData = {
                    id: this.currentEditingTask ? this.currentEditingTask.id : this.generateId(),
                    title: document.getElementById('task-title').value,
                    deadline: document.getElementById('task-deadline').value,
                    priority: document.getElementById('task-priority').value,
                    scheduled_date: document.getElementById('task-scheduled').value || null,
                    description: document.getElementById('task-description').value || '',
                    client_id: document.getElementById('task-client').value || null,
                    estimated_hours: parseFloat(document.getElementById('task-estimated-hours').value) || 0,
                    status: this.currentEditingTask ? this.currentEditingTask.status : 'pending',
                    actual_hours: this.currentEditingTask ? this.currentEditingTask.actual_hours : 0,
                    is_timing: this.currentEditingTask ? this.currentEditingTask.is_timing : false,
                    current_timer_start: this.currentEditingTask ? this.currentEditingTask.current_timer_start : null,
                    created_at: this.currentEditingTask ? this.currentEditingTask.created_at : new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                
                // å…¥åŠ›æ¤œè¨¼
                if (!taskData.title.trim()) {
                    alert('ã‚¿ã‚¹ã‚¯åã¯å¿…é ˆã§ã™');
                    return;
                }
                
                if (!taskData.deadline) {
                    alert('æœŸé™ã¯å¿…é ˆã§ã™');
                    return;
                }
                
                // ã‚µãƒ–ã‚¿ã‚¹ã‚¯å‡¦ç†
                const subtaskElements = document.querySelectorAll('#subtasks-container > div');
                const taskSubtasks = [];
                
                subtaskElements.forEach(element => {
                    const titleInput = element.querySelector('input[type="text"]');
                    const completedInput = element.querySelector('input[type="checkbox"]');
                    const deadlineInput = element.querySelector('input[type="date"]');
                    
                    if (titleInput.value.trim()) {
                        taskSubtasks.push({
                            id: this.generateId(),
                            parent_task_id: taskData.id,
                            title: titleInput.value.trim(),
                            completed: completedInput.checked,
                            deadline: deadlineInput.value || null,
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString()
                        });
                    }
                });
                
                // ã‚¿ã‚¹ã‚¯ã®ä¿å­˜ã¾ãŸã¯æ›´æ–°
                if (this.currentEditingTask) {
                    const index = this.tasks.findIndex(t => t.id === taskData.id);
                    this.tasks[index] = taskData;
                } else {
                    this.tasks.push(taskData);
                }
                
                // æ—¢å­˜ã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¦æ–°ã—ã„ã‚‚ã®ã‚’è¿½åŠ 
                this.subtasks = this.subtasks.filter(st => st.parent_task_id !== taskData.id);
                if (taskSubtasks.length > 0) {
                    this.subtasks.push(...taskSubtasks);
                }
                
                this.saveData();
                this.closeTaskModal();
                this.renderTasks();
                
                // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯æ›´æ–°
                if (this.currentTab === 'gantt') {
                    this.renderGanttChart();
                }
                
                // è‡ªå‹•åŒæœŸã‚’å®Ÿè¡Œ
                this.autoSyncToCalendar(taskData.id);
            }
            
            deleteTask(taskId) {
                if (confirm('ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    this.tasks = this.tasks.filter(t => t.id !== taskId);
                    this.subtasks = this.subtasks.filter(st => st.parent_task_id !== taskId);
                    this.timeLogs = this.timeLogs.filter(tl => tl.task_id !== taskId);
                    this.saveData();
                    this.renderTasks();
                    
                    if (this.currentTab === 'gantt') {
                        this.renderGanttChart();
                    }
                    
                    // è‡ªå‹•åŒæœŸã‚’å®Ÿè¡Œï¼ˆå‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚‚å«ã‚€ï¼‰
                    this.autoSyncToCalendar();
                }
            }
            
            toggleTaskStatus(taskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (task) {
                    if (task.status === 'completed') {
                        task.status = 'pending';
                    } else {
                        task.status = 'completed';
                    }
                    task.updated_at = new Date().toISOString();
                    this.saveData();
                    this.renderTasks();
                    
                    if (this.currentTab === 'gantt') {
                        this.renderGanttChart();
                    }
                    
                    // è‡ªå‹•åŒæœŸã‚’å®Ÿè¡Œï¼ˆå®Œäº†çŠ¶æ…‹ã®å¤‰æ›´ã‚’åæ˜ ï¼‰
                    this.autoSyncToCalendar(taskId);
                }
            }
            
            // æ™‚é–“è¿½è·¡æ©Ÿèƒ½ï¼ˆæ‹¡å¼µç‰ˆï¼šé–‹å§‹ãƒ»åœæ­¢ãƒ»ä¸­æ–­ãƒ»å†é–‹ï¼‰
            toggleTimer(taskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                // ã‚¿ã‚¤ãƒãƒ¼çŠ¶æ…‹ã®åˆæœŸåŒ–
                if (!task.timer_state) {
                    task.timer_state = 'stopped'; // stopped, running, paused
                }
                if (!task.time_sessions) {
                    task.time_sessions = [];
                }
                
                if (task.timer_state === 'running') {
                    // å®Ÿè¡Œä¸­â†’åœæ­¢
                    this.stopTimer(taskId);
                } else if (task.timer_state === 'paused') {
                    // ä¸€æ™‚åœæ­¢ä¸­â†’å†é–‹
                    this.resumeTimer(taskId);
                } else {
                    // åœæ­¢ä¸­â†’é–‹å§‹
                    this.startTimer(taskId);
                }
            }
            
            startTimer(taskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                // ä»–ã®ã‚¿ã‚¹ã‚¯ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
                this.tasks.forEach(t => {
                    if (t.timer_state === 'running' && t.id !== taskId) {
                        this.pauseTimer(t.id);
                    }
                });
                
                task.timer_state = 'running';
                task.current_timer_start = new Date().toISOString();
                task.is_timing = true;
                
                if (task.status === 'pending') {
                    task.status = 'in_progress';
                }
                
                task.updated_at = new Date().toISOString();
                this.saveData();
                this.renderTasks();
            }
            
            stopTimer(taskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (!task || (task.timer_state !== 'running' && task.timer_state !== 'paused')) return;
                
                // pausedçŠ¶æ…‹ã‹ã‚‰åœæ­¢ã™ã‚‹å ´åˆã¯ã€è¿½åŠ ã®æ™‚é–“è¨˜éŒ²ã¯ä¸è¦ï¼ˆæ—¢ã«pauseã§è¨˜éŒ²æ¸ˆã¿ï¼‰
                if (task.timer_state === 'running') {
                    const startTime = new Date(task.current_timer_start);
                    const endTime = new Date();
                    const elapsedHours = (endTime.getTime() - startTime.getTime()) / (1000 * 60 * 60);
                    
                    // å®Ÿç¸¾æ™‚é–“ã«è¿½åŠ 
                    task.actual_hours = (task.actual_hours || 0) + elapsedHours;
                    
                    // æ™‚é–“ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ­ã‚°è¨˜éŒ²
                    const session = {
                        id: this.generateId(),
                        task_id: taskId,
                        start_time: startTime.toISOString(),
                        end_time: endTime.toISOString(),
                        hours: elapsedHours,
                        action: 'stop',
                        created_at: new Date().toISOString(),
                        editable: true
                    };
                    
                    if (!task.time_sessions) task.time_sessions = [];
                    task.time_sessions.push(session);
                    
                    // ä¸‹ä½äº’æ›æ€§ã®ãŸã‚å¾“æ¥ã®timeLogsã‚‚æ›´æ–°
                    this.timeLogs.push({
                        id: session.id,
                        task_id: taskId,
                        start_time: session.start_time,
                        end_time: session.end_time,
                        hours: elapsedHours,
                        created_at: session.created_at
                    });
                }
                
                // çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
                task.timer_state = 'stopped';
                task.is_timing = false;
                task.current_timer_start = null;
                task.updated_at = new Date().toISOString();
                this.saveData();
                this.renderTasks();
            }
            
            pauseTimer(taskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (!task || task.timer_state !== 'running') return;
                
                const startTime = new Date(task.current_timer_start);
                const pauseTime = new Date();
                const elapsedHours = (pauseTime.getTime() - startTime.getTime()) / (1000 * 60 * 60);
                
                // å®Ÿç¸¾æ™‚é–“ã«è¿½åŠ 
                task.actual_hours = (task.actual_hours || 0) + elapsedHours;
                task.timer_state = 'paused';
                task.is_timing = false;
                
                // ä¸€æ™‚åœæ­¢ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨˜éŒ²
                const session = {
                    id: this.generateId(),
                    task_id: taskId,
                    start_time: startTime.toISOString(),
                    end_time: pauseTime.toISOString(),
                    hours: elapsedHours,
                    action: 'pause',
                    created_at: new Date().toISOString(),
                    editable: true
                };
                
                if (!task.time_sessions) task.time_sessions = [];
                task.time_sessions.push(session);
                
                task.current_timer_start = null;
                task.updated_at = new Date().toISOString();
                this.saveData();
                this.renderTasks();
            }
            
            resumeTimer(taskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (!task || task.timer_state !== 'paused') return;
                
                // ä»–ã®ã‚¿ã‚¹ã‚¯ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
                this.tasks.forEach(t => {
                    if (t.timer_state === 'running' && t.id !== taskId) {
                        this.pauseTimer(t.id);
                    }
                });
                
                task.timer_state = 'running';
                task.current_timer_start = new Date().toISOString();
                task.is_timing = true;
                
                task.updated_at = new Date().toISOString();
                this.saveData();
                this.renderTasks();
            }
            
            editTimeLog(sessionId, taskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (!task || !task.time_sessions) return;
                
                const session = task.time_sessions.find(s => s.id === sessionId);
                if (!session) return;
                
                const startTime = new Date(session.start_time);
                const endTime = new Date(session.end_time);
                
                const newStartTime = prompt('é–‹å§‹æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (YYYY-MM-DD HH:MM)', 
                    startTime.toISOString().slice(0, 16).replace('T', ' '));
                
                if (newStartTime && newStartTime !== startTime.toISOString().slice(0, 16).replace('T', ' ')) {
                    const newEndTime = prompt('çµ‚äº†æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (YYYY-MM-DD HH:MM)', 
                        endTime.toISOString().slice(0, 16).replace('T', ' '));
                    
                    if (newEndTime) {
                        const newStart = new Date(newStartTime.replace(' ', 'T'));
                        const newEnd = new Date(newEndTime.replace(' ', 'T'));
                        
                        if (newStart < newEnd) {
                            const oldHours = session.hours;
                            const newHours = (newEnd.getTime() - newStart.getTime()) / (1000 * 60 * 60);
                            
                            // å®Ÿç¸¾æ™‚é–“ã‚’èª¿æ•´
                            task.actual_hours = (task.actual_hours || 0) - oldHours + newHours;
                            
                            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
                            session.start_time = newStart.toISOString();
                            session.end_time = newEnd.toISOString();
                            session.hours = newHours;
                            session.updated_at = new Date().toISOString();
                            
                            task.updated_at = new Date().toISOString();
                            this.saveData();
                            
                            // ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆã¯å†è¡¨ç¤º
                            if (this.currentEditingTask && this.currentEditingTask.id === taskId) {
                                this.displayTimeLogs(task);
                            }
                            
                            this.renderTasks();
                        } else {
                            alert('çµ‚äº†æ™‚åˆ»ã¯é–‹å§‹æ™‚åˆ»ã‚ˆã‚Šå¾Œã«ã—ã¦ãã ã•ã„ã€‚');
                        }
                    }
                }
            }
            
            deleteTimeLog(sessionId, taskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (!task || !task.time_sessions) return;
                
                const sessionIndex = task.time_sessions.findIndex(s => s.id === sessionId);
                if (sessionIndex === -1) return;
                
                if (confirm('ã“ã®ä½œæ¥­ãƒ­ã‚°ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    const session = task.time_sessions[sessionIndex];
                    
                    // å®Ÿç¸¾æ™‚é–“ã‹ã‚‰å‰Šé™¤
                    task.actual_hours = (task.actual_hours || 0) - (session.hours || 0);
                    if (task.actual_hours < 0) task.actual_hours = 0;
                    
                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
                    task.time_sessions.splice(sessionIndex, 1);
                    
                    // ä¸‹ä½äº’æ›æ€§ã®ãŸã‚timeLogsã‹ã‚‰ã‚‚å‰Šé™¤
                    const timeLogIndex = this.timeLogs.findIndex(log => log.id === sessionId);
                    if (timeLogIndex !== -1) {
                        this.timeLogs.splice(timeLogIndex, 1);
                    }
                    
                    task.updated_at = new Date().toISOString();
                    this.saveData();
                    
                    // ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆã¯å†è¡¨ç¤º
                    if (this.currentEditingTask && this.currentEditingTask.id === taskId) {
                        this.displayTimeLogs(task);
                    }
                    
                    this.renderTasks();
                }
            }
            
            startTimerUpdates() {
                setInterval(() => {
                    this.updateTimerDisplays();
                }, 1000);
            }
            
            updateTimerDisplays() {
                this.tasks.forEach(task => {
                    if (task.is_timing) {
                        const timerElement = document.querySelector(`[data-timer-task="${task.id}"]`);
                        if (timerElement) {
                            const elapsed = (Date.now() - new Date(task.current_timer_start).getTime()) / 1000;
                            const hours = Math.floor(elapsed / 3600);
                            const minutes = Math.floor((elapsed % 3600) / 60);
                            const seconds = Math.floor(elapsed % 60);
                            timerElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        }
                    }
                });
            }
            
            initializeTaskFilters() {
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«æ–°ã—ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                this.updateStatusFilterOptions();
                
                // é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’åˆæœŸåŒ–
                this.updateTaskClientFilter();
                
                // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
                const searchInput = document.getElementById('search-input');
                const filterStatus = document.getElementById('filter-status');
                const filterPriority = document.getElementById('filter-priority');
                const filterClient = document.getElementById('filter-client');
                
                if (searchInput) {
                    searchInput.addEventListener('input', () => this.renderTasks());
                }
                if (filterStatus) {
                    filterStatus.addEventListener('change', () => {
                        console.log('ğŸ” ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´:', filterStatus.value);
                        this.renderTasks();
                    });
                }
                if (filterPriority) {
                    filterPriority.addEventListener('change', () => this.renderTasks());
                }
                if (filterClient) {
                    filterClient.addEventListener('change', () => {
                        console.log('ğŸ” é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´:', filterClient.value);
                        this.renderTasks();
                    });
                }
                
                console.log('âœ… ã‚¿ã‚¹ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ');
            }
            
            updateStatusFilterOptions() {
                const filterStatus = document.getElementById('filter-status');
                if (!filterStatus) return;
                
                // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä¿å­˜
                const currentValue = filterStatus.value;
                
                // æ–°ã—ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
                filterStatus.innerHTML = `
                    <option value="">å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
                    <option value="active">æœªç€æ‰‹ã¨é€²è¡Œä¸­ã®ã¿</option>
                    <option value="pending">æœªç€æ‰‹</option>
                    <option value="in_progress">é€²è¡Œä¸­</option>
                    <option value="completed">å®Œäº†</option>
                `;
                
                // å‰ã®é¸æŠå€¤ã‚’å¾©å…ƒ
                filterStatus.value = currentValue;
                
                console.log('ğŸ”„ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            }
            
            updateTaskClientFilter() {
                const filterClient = document.getElementById('filter-client');
                if (!filterClient) return;
                
                // ç¾åœ¨ã®é¸æŠå€¤ã‚’ä¿å­˜
                const currentValue = filterClient.value;
                
                // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢ã—ã¦åŸºæœ¬ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                filterClient.innerHTML = '<option value="">å…¨é¡§å®¢</option>';
                
                // é¡§å®¢ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«è¿½åŠ 
                this.clients.forEach(client => {
                    const option = document.createElement('option');
                    option.value = client.id;
                    option.textContent = `${client.name}${client.company ? ` (${client.company})` : ''}`;
                    filterClient.appendChild(option);
                });
                
                // ã€Œé¡§å®¢æœªæŒ‡å®šã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                const unspecifiedOption = document.createElement('option');
                unspecifiedOption.value = 'unspecified';
                unspecifiedOption.textContent = 'é¡§å®¢æœªæŒ‡å®š';
                filterClient.appendChild(unspecifiedOption);
                
                // å‰ã®é¸æŠå€¤ã‚’å¾©å…ƒ
                filterClient.value = currentValue;
                
                console.log('ğŸ”„ é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            }
            
            renderTasks() {
                const container = document.getElementById('tasks-container');
                const searchTerm = document.getElementById('search-input').value.toLowerCase();
                const statusFilter = document.getElementById('filter-status').value;
                const priorityFilter = document.getElementById('filter-priority').value;
                const clientFilter = document.getElementById('filter-client').value;
                
                let filteredTasks = this.tasks.filter(task => {
                    const matchSearch = task.title.toLowerCase().includes(searchTerm) || 
                                      (task.description && task.description.toLowerCase().includes(searchTerm));
                    
                    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å‡¦ç†ã‚’æ‹¡å¼µ
                    let matchStatus = true;
                    if (statusFilter) {
                        if (statusFilter === 'active') {
                            // "æœªç€æ‰‹ã¨é€²è¡Œä¸­ã®ã¿"ã®å ´åˆ
                            matchStatus = task.status === 'pending' || task.status === 'in_progress';
                        } else {
                            // é€šå¸¸ã®å€‹åˆ¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
                            matchStatus = task.status === statusFilter;
                        }
                    }
                    
                    const matchPriority = !priorityFilter || task.priority === priorityFilter;
                    
                    // é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å‡¦ç†
                    let matchClient = true;
                    if (clientFilter) {
                        if (clientFilter === 'unspecified') {
                            // é¡§å®¢æœªæŒ‡å®š
                            matchClient = !task.client_id;
                        } else {
                            // æŒ‡å®šã•ã‚ŒãŸé¡§å®¢
                            matchClient = task.client_id === clientFilter;
                        }
                    }
                    
                    return matchSearch && matchStatus && matchPriority && matchClient;
                });
                
                // æœŸé™ã¨å„ªå…ˆåº¦ã§ã‚½ãƒ¼ãƒˆ
                filteredTasks.sort((a, b) => {
                    const priorityOrder = { high: 3, medium: 2, low: 1 };
                    if (a.priority !== b.priority) {
                        return priorityOrder[b.priority] - priorityOrder[a.priority];
                    }
                    return new Date(a.deadline) - new Date(b.deadline);
                });
                
                container.innerHTML = '';
                
                if (filteredTasks.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12 text-gray-500">
                            <i class="fas fa-tasks text-4xl mb-4"></i>
                            <p class="text-lg">ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</p>
                            <p class="text-sm">æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†</p>
                        </div>
                    `;
                    return;
                }
                
                filteredTasks.forEach(task => {
                    const taskCard = this.createTaskCard(task);
                    container.appendChild(taskCard);
                });
            }
            
            createTaskCard(task) {
                const card = document.createElement('div');
                card.className = 'task-item bg-white rounded-lg shadow-sm border border-gray-200 p-3 hover:shadow-md transition-shadow';
                
                const client = task.client_id ? this.clients.find(c => c.id === task.client_id) : null;
                const taskSubtasks = this.subtasks.filter(st => st.parent_task_id === task.id);
                const completedSubtasks = taskSubtasks.filter(st => st.completed);
                
                const statusClass = {
                    pending: 'bg-yellow-100 text-yellow-800',
                    in_progress: 'bg-blue-100 text-blue-800',
                    completed: 'bg-green-100 text-green-800'
                };
                
                const priorityClass = {
                    high: 'bg-red-100 text-red-800',
                    medium: 'bg-orange-100 text-orange-800',
                    low: 'bg-gray-100 text-gray-800'
                };
                
                const statusText = {
                    pending: 'æœªç€æ‰‹',
                    in_progress: 'é€²è¡Œä¸­',
                    completed: 'å®Œäº†'
                };
                
                const priorityText = {
                    high: 'é«˜',
                    medium: 'ä¸­',
                    low: 'ä½'
                };
                
                // æœŸé™ã¾ã§ã®æ—¥æ•°è¨ˆç®—
                const today = new Date();
                const deadline = new Date(task.deadline);
                const daysUntilDeadline = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
                
                let deadlineClass = 'text-gray-600';
                let deadlineText = `${daysUntilDeadline}æ—¥å¾Œ`;
                
                if (daysUntilDeadline < 0) {
                    deadlineClass = 'text-red-600 font-semibold';
                    deadlineText = `${Math.abs(daysUntilDeadline)}æ—¥é…ã‚Œ`;
                } else if (daysUntilDeadline === 0) {
                    deadlineClass = 'text-red-600 font-semibold';
                    deadlineText = 'ä»Šæ—¥ãŒæœŸé™';
                } else if (daysUntilDeadline <= 3) {
                    deadlineClass = 'text-orange-600 font-semibold';
                }
                
                // ç¾åœ¨ã®ä½œæ¥­æ™‚é–“è¡¨ç¤º
                let currentTime = '';
                if (task.is_timing) {
                    currentTime = `<span data-timer-task="${task.id}" class="text-red-600 font-mono">è¨ˆæ¸¬ä¸­...</span>`;
                }
                
                card.innerHTML = `
                    <div class="flex items-start justify-between min-w-0">
                        <div class="task-checkbox flex-shrink-0">
                            <button class="custom-checkbox ${task.status === 'completed' ? 'checked' : ''}" 
                                    onclick="app.toggleTaskStatus('${task.id}')"></button>
                        </div>
                        
                        <div class="task-content flex-1 min-w-0">
                            <h3 class="task-title text-lg font-semibold text-gray-900 ${task.status === 'completed' ? 'line-through' : ''}">${task.title}</h3>
                            ${client ? `<p class="task-client text-blue-600 text-sm mt-1"><i class="fas fa-user mr-1"></i>${client.name}${client.company ? ` (${client.company})` : ''}</p>` : ''}
                            
                            <div class="task-meta">
                                <span class="task-status inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusClass[task.status]}">
                                    ${statusText[task.status]}
                                </span>
                                <span class="task-priority inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${priorityClass[task.priority]}">
                                    ${priorityText[task.priority]}
                                </span>
                                <span class="task-deadline text-xs ${deadlineClass}">
                                    <i class="fas fa-calendar mr-1"></i>${deadlineText}
                                </span>
                                ${task.estimated_hours > 0 ? `
                                    <span class="task-time text-xs text-gray-600">
                                        <i class="fas fa-clock mr-1"></i>äºˆæƒ³: ${this.formatHoursToReadable(task.estimated_hours)}
                                    </span>
                                ` : ''}
                                ${task.actual_hours > 0 ? `
                                    <span class="task-time text-xs text-gray-600">
                                        <i class="fas fa-hourglass-half mr-1"></i>å®Ÿç¸¾: ${this.formatHoursToReadable(task.actual_hours)}
                                    </span>
                                ` : ''}
                                ${currentTime}
                            </div>
                            
                            ${taskSubtasks.length > 0 ? `
                                <div class="mt-3">
                                    <div class="text-xs text-gray-600 mb-2">
                                        ã‚µãƒ–ã‚¿ã‚¹ã‚¯: ${completedSubtasks.length}/${taskSubtasks.length} å®Œäº†
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: ${taskSubtasks.length > 0 ? (completedSubtasks.length / taskSubtasks.length) * 100 : 0}%"></div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="task-actions flex-shrink-0">
                            ${this.renderTimerButtons(task)}
                            <button class="p-2 rounded-lg border border-gray-300 hover:bg-gray-50"
                                    onclick="app.openTaskModal(app.tasks.find(t => t.id === '${task.id}'))" title="ç·¨é›†">
                                <i class="fas fa-edit text-sm text-gray-600"></i>
                            </button>
                            <button class="p-2 rounded-lg border border-gray-300 hover:bg-gray-50 text-red-600"
                                    onclick="app.deleteTask('${task.id}')" title="å‰Šé™¤">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                return card;
            }
            
            renderTimerButtons(task) {
                if (!task.timer_state) {
                    task.timer_state = 'stopped';
                }
                
                let buttons = '';
                
                if (task.timer_state === 'running') {
                    // å®Ÿè¡Œä¸­ï¼šåœæ­¢ã¨ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³
                    buttons = `
                        <button class="timer-btn p-2 rounded-lg border border-gray-300 hover:bg-gray-50 running"
                                onclick="app.toggleTimer('${task.id}')" title="ã‚¿ã‚¤ãƒãƒ¼åœæ­¢">
                            <i class="fas fa-stop text-sm text-red-600"></i>
                        </button>
                        <button class="p-2 rounded-lg border border-gray-300 hover:bg-gray-50"
                                onclick="app.pauseTimer('${task.id}')" title="ä¸€æ™‚åœæ­¢">
                            <i class="fas fa-pause text-sm text-orange-600"></i>
                        </button>
                    `;
                } else if (task.timer_state === 'paused') {
                    // ä¸€æ™‚åœæ­¢ä¸­ï¼šå†é–‹ã¨åœæ­¢ãƒœã‚¿ãƒ³
                    buttons = `
                        <button class="timer-btn p-2 rounded-lg border border-gray-300 hover:bg-gray-50 paused"
                                onclick="app.toggleTimer('${task.id}')" title="å†é–‹">
                            <i class="fas fa-play text-sm text-green-600"></i>
                        </button>
                        <button class="p-2 rounded-lg border border-gray-300 hover:bg-gray-50"
                                onclick="app.stopTimer('${task.id}')" title="åœæ­¢">
                            <i class="fas fa-stop text-sm text-red-600"></i>
                        </button>
                    `;
                } else {
                    // åœæ­¢ä¸­ï¼šé–‹å§‹ãƒœã‚¿ãƒ³ã®ã¿
                    buttons = `
                        <button class="timer-btn p-2 rounded-lg border border-gray-300 hover:bg-gray-50"
                                onclick="app.toggleTimer('${task.id}')" title="ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹">
                            <i class="fas fa-play text-sm text-blue-600"></i>
                        </button>
                    `;
                }
                
                return buttons;
            }
            
            // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆæ©Ÿèƒ½
            changeGanttMonth(direction) {
                this.ganttCurrentDate.setMonth(this.ganttCurrentDate.getMonth() + direction);
                this.renderGanttChart();
            }
            
            goToCurrentMonth() {
                this.ganttCurrentDate = new Date();
                this.renderGanttChart();
                
                // ä»Šæ—¥ã®æ—¥ä»˜ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹
                setTimeout(() => this.scrollToToday(), 300);
            }

            scrollToToday() {
                const today = new Date();
                const currentMonth = this.ganttCurrentDate.getMonth();
                const currentYear = this.ganttCurrentDate.getFullYear();
                
                // ä»ŠæœˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                if (today.getMonth() === currentMonth && today.getFullYear() === currentYear) {
                    const todayColumn = today.getDate();
                    const columnWidth = 40; // æ—¥ä»˜åˆ—ã®å¹…
                    const scrollPosition = (todayColumn - 1) * columnWidth - 150; // ä¸­å¤®ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
                    
                    const timeline = document.getElementById('gantt-timeline');
                    if (timeline) {
                        timeline.scrollLeft = Math.max(0, scrollPosition);
                        console.log(`ğŸ“… ä»Šæ—¥(${todayColumn}æ—¥)ã®ä½ç½®ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¾ã—ãŸ`);
                    }
                }
            }
            
            bindGanttEvents() {
                // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
                try {
                    // å°‘ã—é…å»¶ã—ã¦DOMãŒå®Œå…¨ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã®ã‚’å¾…ã¤
                    setTimeout(() => {
                        const searchInput = document.getElementById('gantt-search-input');
                        const clientFilter = document.getElementById('gantt-filter-client');
                        const statusFilter = document.getElementById('gantt-filter-status');
                        const subtaskToggle = document.getElementById('gantt-show-subtasks');
                        
                        console.log('ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®šå¯¾è±¡è¦ç´ :', {
                            searchInput: !!searchInput,
                            clientFilter: !!clientFilter, 
                            statusFilter: !!statusFilter,
                            subtaskToggle: !!subtaskToggle
                        });
                        
                        if (searchInput) {
                            // æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¯ãƒªã‚¢
                            searchInput.removeEventListener('input', this.handleGanttSearch);
                            this.handleGanttSearch = () => {
                                console.log('ã‚¬ãƒ³ãƒˆæ¤œç´¢:', searchInput.value);
                                this.renderGanttChart();
                            };
                            searchInput.addEventListener('input', this.handleGanttSearch);
                        }
                        
                        if (clientFilter) {
                            // æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¯ãƒªã‚¢
                            clientFilter.removeEventListener('change', this.handleClientFilter);
                            this.handleClientFilter = (e) => {
                                console.log('ğŸ‘¥ é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´:', e.target.value);
                                console.log('âœ… ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ!', new Date().toISOString());
                                this.renderGanttChart();
                            };
                            clientFilter.addEventListener('change', this.handleClientFilter);
                            
                            // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
                            clientFilter.addEventListener('click', () => {
                                console.log('ğŸ“Œ é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
                            });
                            
                            clientFilter.addEventListener('focus', () => {
                                console.log('ğŸ” é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹');
                            });
                            
                            clientFilter.addEventListener('blur', () => {
                                console.log('ğŸ”² é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‹ã‚‰ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå¤–ã‚Œã¾ã—ãŸ');
                            });
                            
                            // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©åˆ‡ã«è¨­å®šï¼ˆz-indexç«¶åˆã‚’é¿ã‘ã‚‹ï¼‰
                            clientFilter.style.cssText += `
                                position: relative !important;
                                pointer-events: auto !important;
                                background-color: white !important;
                                cursor: pointer !important;
                                appearance: none !important;
                                -webkit-appearance: none !important;
                                -moz-appearance: none !important;
                                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e") !important;
                                background-position: right 10px center !important;
                                background-repeat: no-repeat !important;
                                background-size: 14px 14px !important;
                                padding-right: 36px !important;
                            `;
                            
                            console.log('ğŸ› ï¸ é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®šå®Œäº†:', clientFilter.style.cssText);
                        }
                        
                        if (statusFilter) {
                            statusFilter.removeEventListener('change', this.handleStatusFilter);
                            this.handleStatusFilter = () => {
                                console.log('ğŸ” ã‚¬ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´:', statusFilter.value);
                                this.renderGanttChart();
                            };
                            statusFilter.addEventListener('change', this.handleStatusFilter);
                        }
                        
                        if (subtaskToggle) {
                            subtaskToggle.removeEventListener('change', this.handleSubtaskToggle);
                            this.handleSubtaskToggle = () => {
                                console.log('ã‚µãƒ–ã‚¿ã‚¹ã‚¯è¡¨ç¤ºå¤‰æ›´:', subtaskToggle.checked);
                                this.renderGanttChart();
                            };
                            subtaskToggle.addEventListener('change', this.handleSubtaskToggle);
                        }
                        
                        console.log('ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');
                    }, 100);
                    
                } catch (error) {
                    console.error('ã‚¬ãƒ³ãƒˆã‚¤ãƒ™ãƒ³ãƒˆè¨­å®šã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            populateGanttClientFilter() {
                const select = document.getElementById('gantt-filter-client');
                if (!select) {
                    console.warn('ã‚¬ãƒ³ãƒˆé¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const currentValue = select.value; // ç¾åœ¨ã®é¸æŠå€¤ã‚’ä¿æŒ
                select.innerHTML = '<option value="">å…¨é¡§å®¢</option>';
                
                console.log(`ğŸ‘¥ é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ›´æ–°: ${this.clients.length}ä»¶ã®é¡§å®¢ã‚’è¿½åŠ `);
                
                this.clients.forEach(client => {
                    const option = document.createElement('option');
                    option.value = client.id;
                    option.textContent = `${client.name}${client.company ? ` (${client.company})` : ''}`;
                    select.appendChild(option);
                });
                
                // å‰ã®é¸æŠå€¤ã‚’å¾©å…ƒï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
                if (currentValue && this.clients.some(c => c.id === currentValue)) {
                    select.value = currentValue;
                }
            }
            
            updateGanttStatusFilter() {
                const statusSelect = document.getElementById('gantt-filter-status');
                if (!statusSelect) {
                    console.warn('ã‚¬ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                // ç¾åœ¨ã®é¸æŠå€¤ã‚’ä¿æŒ
                const currentValue = statusSelect.value;
                
                // ã‚¿ã‚¹ã‚¯ãƒšãƒ¼ã‚¸ã¨åŒã˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
                statusSelect.innerHTML = `
                    <option value="">å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
                    <option value="active">æœªç€æ‰‹ã¨é€²è¡Œä¸­ã®ã¿</option>
                    <option value="pending">æœªç€æ‰‹</option>
                    <option value="in_progress">é€²è¡Œä¸­</option>
                    <option value="completed">å®Œäº†</option>
                `;
                
                // å‰ã®é¸æŠå€¤ã‚’å¾©å…ƒ
                statusSelect.value = currentValue;
                
                console.log('ğŸ”„ ã‚¬ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            }
            
            updateAllClientFilters() {
                // ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é¡§å®¢é¸æŠã‚’æ›´æ–°ï¼ˆç¾åœ¨å€¤ã‚’ä¿æŒï¼‰
                const currentClientValue = document.getElementById('task-client')?.value;
                this.populateClientSelect(currentClientValue);
                
                // ã‚¿ã‚¹ã‚¯ãƒšãƒ¼ã‚¸ã®é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æ›´æ–°
                this.updateTaskClientFilter();
                
                // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æ›´æ–°
                this.populateGanttClientFilter();
                
                console.log('ğŸ”„ å…¨é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            }
            
            getFilteredGanttTasks() {
                const searchTerm = document.getElementById('gantt-search-input').value.toLowerCase();
                const clientFilter = document.getElementById('gantt-filter-client').value;
                const statusFilter = document.getElementById('gantt-filter-status').value;
                
                console.log('ã‚¬ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶:', { searchTerm, clientFilter, statusFilter });
                
                const filtered = this.tasks.filter(task => {
                    const matchSearch = task.title.toLowerCase().includes(searchTerm) || 
                                      (task.description && task.description.toLowerCase().includes(searchTerm));
                    const matchClient = !clientFilter || task.client_id === clientFilter;
                    
                    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å‡¦ç†ã‚’æ‹¡å¼µï¼ˆã‚¿ã‚¹ã‚¯ãƒšãƒ¼ã‚¸ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
                    let matchStatus = true;
                    if (statusFilter) {
                        if (statusFilter === 'active') {
                            // "æœªç€æ‰‹ã¨é€²è¡Œä¸­ã®ã¿"ã®å ´åˆ
                            matchStatus = task.status === 'pending' || task.status === 'in_progress';
                        } else {
                            // é€šå¸¸ã®å€‹åˆ¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
                            matchStatus = task.status === statusFilter;
                        }
                    }
                    
                    const matches = matchSearch && matchClient && matchStatus;
                    if (clientFilter && task.client_id === clientFilter) {
                        console.log(`ã‚¿ã‚¹ã‚¯ "${task.title}" ãŒé¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ãƒãƒƒãƒ: ${matches}`);
                    }
                    
                    return matches;
                });
                
                console.log(`ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çµæœ: ${this.tasks.length}å€‹ä¸­${filtered.length}å€‹ã‚’è¡¨ç¤º`);
                return filtered;
            }
            
            renderGanttChart() {
                const container = document.getElementById('gantt-container');
                const currentMonthText = document.getElementById('gantt-current-month');
                
                console.log(`ğŸ“ˆ ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆæç”»é–‹å§‹: ${this.clients.length}ä»¶ã®é¡§å®¢, ${this.tasks.length}ä»¶ã®ã‚¿ã‚¹ã‚¯`);
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æ›´æ–°
                this.populateGanttClientFilter();
                this.updateGanttStatusFilter();
                
                const year = this.ganttCurrentDate.getFullYear();
                const month = this.ganttCurrentDate.getMonth();
                
                currentMonthText.textContent = `${year}å¹´${month + 1}æœˆ`;
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’å–å¾—
                const filteredTasks = this.getFilteredGanttTasks();
                const showSubtasks = document.getElementById('gantt-show-subtasks').checked;
                
                // æœˆã®æ—¥æ•°ã‚’å–å¾—
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const firstDay = new Date(year, month, 1);
                
                // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆHTMLç”Ÿæˆ
                let ganttHTML = `
                    <div class="gantt-wrapper">
                        <div class="gantt-fixed-column">
                            <div class="gantt-header-row flex items-center" style="height: 48px; min-height: 48px; max-height: 48px; padding: 0 16px; background: #f9fafb; border-bottom: 1px solid #e5e7eb; border-right: 2px solid #3b82f6; position: absolute; top: 0; left: 0; right: 0; z-index: 15; box-sizing: border-box;">
                                <div class="text-sm font-semibold text-gray-700">ã‚¿ã‚¹ã‚¯</div>
                            </div>
                            <div class="gantt-fixed-content" id="gantt-task-list" style="padding-top: 48px; padding-bottom: 20px; height: 100%; overflow-y: auto; overflow-x: hidden;">
                `;
                
                // ã‚¿ã‚¹ã‚¯ãŒç©ºã®å ´åˆã¯æœ€å°é«˜ã•ã‚’ç¢ºä¿
                if (filteredTasks.length === 0) {
                    ganttHTML += `
                        <div class="gantt-row px-4 py-8 text-center text-gray-500">
                            <div class="text-sm">è¡¨ç¤ºã™ã‚‹ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</div>
                        </div>
                    `;
                }
                
                // ã‚¿ã‚¹ã‚¯ã”ã¨ã®è¡Œã‚’ç”Ÿæˆ
                console.log(`ğŸ” å·¦å´ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆç”Ÿæˆé–‹å§‹: ${filteredTasks.length}ä»¶ã®ã‚¿ã‚¹ã‚¯`);
                filteredTasks.forEach((task, taskIndex) => {
                    const client = task.client_id ? this.clients.find(c => c.id === task.client_id) : null;
                    const taskSubtasks = showSubtasks ? this.subtasks.filter(st => st.parent_task_id === task.id) : [];
                    console.log(`ã‚¿ã‚¹ã‚¯${taskIndex + 1}: "${task.title}" - ã‚µãƒ–ã‚¿ã‚¹ã‚¯${taskSubtasks.length}ä»¶`);
                    
                    // æœŸé™ã¾ã§ã®æ—¥æ•°è¨ˆç®—
                    const today = new Date();
                    const deadline = new Date(task.deadline);
                    const daysUntilDeadline = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
                    
                    let deadlineClass = 'text-gray-500';
                    let deadlineText = `${Math.abs(daysUntilDeadline)}æ—¥`;
                    
                    if (daysUntilDeadline < 0) {
                        deadlineClass = 'text-red-600';
                        deadlineText = `${Math.abs(daysUntilDeadline)}æ—¥é…ã‚Œ`;
                    } else if (daysUntilDeadline === 0) {
                        deadlineClass = 'text-red-600';
                        deadlineText = 'ä»Šæ—¥';
                    } else if (daysUntilDeadline <= 3) {
                        deadlineClass = 'text-orange-600';
                        deadlineText = `${daysUntilDeadline}æ—¥å¾Œ`;
                    } else {
                        deadlineText = `${daysUntilDeadline}æ—¥å¾Œ`;
                    }
                    
                    const clientName = client ? (client.name + (client.company ? ` (${client.company})` : '')) : '';
                    
                    ganttHTML += `
                        <div class="gantt-task-row" onclick="app.openTaskModal(app.tasks.find(t => t.id === '${task.id}'))">
                            <div class="text-xs font-semibold text-gray-900 truncate" style="line-height: 1.2; margin-bottom: 1px;">${task.title}</div>
                            <div class="flex items-center justify-between" style="line-height: 1.1;">
                                <span class="${deadlineClass} font-medium" style="font-size: 10px;">
                                    <i class="fas fa-calendar mr-1"></i>${deadlineText}
                                </span>
                                ${clientName ? `<span class="text-blue-600 truncate flex-shrink-0 max-w-28" style="font-size: 10px;"><i class="fas fa-user mr-1"></i>${clientName}</span>` : ''}
                            </div>
                        </div>
                    `;
                    
                    // ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚’è¡¨ç¤º
                    taskSubtasks.forEach(subtask => {
                        ganttHTML += `
                            <div class="gantt-subtask" style="height: 48px; min-height: 48px; max-height: 48px; display: flex; align-items: center; margin: 0; padding: 0 8px; border-bottom: 1px solid #f3f4f6; background-color: #fafafa;">
                                <div class="text-xs text-gray-500 truncate leading-tight">
                                    ${subtask.title}
                                </div>
                            </div>
                        `;
                    });
                });
                
                ganttHTML += `
                            </div>
                        </div>
                        <div class="gantt-scrollable-wrapper">
                            <div class="gantt-header-row flex">
                `;
                
                // æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼‰
                const totalWidth = daysInMonth * 40; // å„æ—¥ä»˜åˆ—40px
                console.log(`ğŸ“… æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆ: ${year}å¹´${month + 1}æœˆ (æ—¥æ•°: ${daysInMonth})`); 
                ganttHTML += `<div style="width: ${totalWidth}px; display: flex; height: 32px;">`;
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                    const isToday = date.toDateString() === new Date().toDateString();
                    
                    ganttHTML += `
                        <div class="gantt-day-column gantt-header-cell ${isWeekend ? 'gantt-weekend' : ''} ${isToday ? 'gantt-today' : ''}" style="height: 48px; min-height: 48px; max-height: 48px; min-width: 40px; width: 40px; max-width: 40px; flex: 0 0 40px; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #f9fafb; border-right: 1px solid #e5e7eb; padding: 0; box-sizing: border-box;">
                            <div style="font-size: 11px; font-weight: 600; color: #111827; line-height: 1;">${day}</div>
                            <div style="font-size: 10px; color: #6b7280; line-height: 1;">${['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'][date.getDay()]}</div>
                        </div>
                    `;
                }
                
                ganttHTML += `</div>`;
                
                ganttHTML += `
                            </div>
                            <div class="gantt-scrollable-area" id="gantt-timeline">
                `;
                
                // ã‚¿ã‚¹ã‚¯ãŒç©ºã®å ´åˆã¯æœ€å°é«˜ã•ã‚’ç¢ºä¿
                if (filteredTasks.length === 0) {
                    ganttHTML += `
                        <div class="gantt-row" style="width: ${totalWidth}px; display: flex; height: 48px;">
                            ${Array.from({length: daysInMonth}, () => '<div class="gantt-day-column"></div>').join('')}
                        </div>
                    `;
                }
                
                // ã‚¿ã‚¹ã‚¯ãƒãƒ¼ç”Ÿæˆï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼‰
                // â€»é‡è¦ï¼šå·¦å´ã¨å®Œå…¨ã«åŒã˜é †åºã§å‡¦ç†ã™ã‚‹
                filteredTasks.forEach((task, taskIndex) => {
                    // æ—¥ä»˜ã‚’æ­£ç¢ºã«æ‰±ã†ãŸã‚ã«Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚³ãƒ”ãƒ¼
                    const taskStartDate = task.scheduled_date ? new Date(task.scheduled_date) : new Date(task.deadline);
                    const taskEndDate = new Date(task.deadline);
                    const taskSubtasks = showSubtasks ? this.subtasks.filter(st => st.parent_task_id === task.id) : [];
                    console.log(`ãƒ—ãƒ­ãƒƒãƒˆã‚¿ã‚¹ã‚¯${taskIndex + 1}: "${task.title}" - ã‚µãƒ–ã‚¿ã‚¹ã‚¯${taskSubtasks.length}ä»¶`);
                    
                    // æ—¥ä»˜æ¯”è¼ƒç”¨ã«æ­£è¦åŒ–ã—ãŸæ—¥ä»˜ã‚’ä½œæˆï¼ˆæ™‚åˆ»ã‚’é™¤å»ï¼‰
                    const startDateOnly = new Date(taskStartDate.getFullYear(), taskStartDate.getMonth(), taskStartDate.getDate());
                    const endDateOnly = new Date(taskEndDate.getFullYear(), taskEndDate.getMonth(), taskEndDate.getDate());
                    
                    console.log(`ğŸ“… ã‚¿ã‚¹ã‚¯ "${task.title}" - é–‹å§‹: ${startDateOnly.toISOString().split('T')[0]}, çµ‚äº†: ${endDateOnly.toISOString().split('T')[0]}`);
                    
                    // ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¹ã‚¯ãƒãƒ¼
                    ganttHTML += `<div class="gantt-row" style="width: ${totalWidth}px; display: flex; height: 48px; align-items: center;">`;
                    
                    for (let day = 1; day <= daysInMonth; day++) {
                        const currentDate = new Date(year, month, day);
                        
                        // ãƒ‡ãƒãƒƒã‚°: æ—¥ä»˜æ¯”è¼ƒã®è©³ç´°ã‚’ãƒ­ã‚°å‡ºåŠ›
                        if (task.title.includes('ã‚¹ãƒˆãƒ©ã‚¤ãƒ—') && (day === 17 || day === 18)) {
                            console.log(`ğŸ” ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ã‚¿ã‚¹ã‚¯ - ${day}æ—¥ç›®`);
                            console.log(`  ç¾åœ¨ã®æ—¥ä»˜: ${currentDate.toISOString().split('T')[0]}`);
                            console.log(`  é–‹å§‹æ—¥: ${startDateOnly.toISOString().split('T')[0]}`);
                            console.log(`  çµ‚äº†æ—¥: ${endDateOnly.toISOString().split('T')[0]}`);
                            console.log(`  ã‚¿ã‚¹ã‚¯å¯¾è±¡æ—¥?: ${currentDate >= startDateOnly && currentDate <= endDateOnly}`);
                        }
                        
                        // æ­£ç¢ºãªæ—¥ä»˜æ¯”è¼ƒï¼ˆæ™‚åˆ»ã‚’é™¤ã„ãŸæ—¥ä»˜ã®ã¿ï¼‰
                        const isTaskDay = currentDate >= startDateOnly && currentDate <= endDateOnly;
                        
                        if (isTaskDay) {
                            const isStart = currentDate.getTime() === startDateOnly.getTime();
                            const isEnd = currentDate.getTime() === endDateOnly.getTime();
                            const priorityClass = task.priority === 'high' ? 'high-priority' : '';
                            const completedClass = task.status === 'completed' ? 'completed' : '';
                            
                            // ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã®è¡¨ç¤ºå†…å®¹ã¨è§’ä¸¸ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ±ºå®š
                            let barContent = '';
                            let borderRadiusStyle = '';
                            
                            if (isStart && isEnd) {
                                // 1æ—¥ã ã‘ã®ã‚¿ã‚¹ã‚¯ - ä¸¡ç«¯è§’ä¸¸
                                barContent = task.title.substring(0, 4) + (task.title.length > 4 ? '..' : '');
                                borderRadiusStyle = 'border-radius: 3px;';
                            } else if (isStart) {
                                // é–‹å§‹æ—¥ - å·¦ç«¯ã®ã¿è§’ä¸¸
                                barContent = task.title.substring(0, 3) + (task.title.length > 3 ? '..' : '');
                                borderRadiusStyle = 'border-top-left-radius: 3px; border-bottom-left-radius: 3px;';
                            } else if (isEnd) {
                                // çµ‚äº†æ—¥ - å³ç«¯ã®ã¿è§’ä¸¸
                                barContent = 'â–¶';
                                borderRadiusStyle = 'border-top-right-radius: 3px; border-bottom-right-radius: 3px;';
                            } else {
                                // ä¸­é–“æ—¥ - è§’ä¸¸ãªã—
                                barContent = '';
                            }
                            
                            ganttHTML += `
                                <div class="gantt-day-column" style="min-width: 40px; width: 40px; max-width: 40px; flex: 0 0 40px; padding: 0; box-sizing: border-box; border-right: 1px solid #e5e7eb;">
                                    <div class="gantt-task-bar ${priorityClass} ${completedClass}" 
                                         style="${borderRadiusStyle}"
                                         title="${task.title} (é–‹å§‹: ${startDateOnly.toLocaleDateString()}, çµ‚äº†: ${endDateOnly.toLocaleDateString()})" 
                                         onclick="app.openTaskModal(app.tasks.find(t => t.id === '${task.id}'))">
                                        ${barContent}
                                    </div>
                                </div>
                            `;
                        } else {
                            ganttHTML += `<div class="gantt-day-column" style="min-width: 40px; width: 40px; max-width: 40px; flex: 0 0 40px; padding: 0; box-sizing: border-box; border-right: 1px solid #e5e7eb;"></div>`;
                        }
                    }
                    
                    ganttHTML += `</div>`;
                    
                    // ã‚µãƒ–ã‚¿ã‚¹ã‚¯ãƒãƒ¼
                    taskSubtasks.forEach(subtask => {
                        ganttHTML += `<div class="gantt-row gantt-subtask" style="width: ${totalWidth}px; display: flex; height: 48px; align-items: center; margin: 0; padding: 0;">`;
                        
                        for (let day = 1; day <= daysInMonth; day++) {
                            const currentDate = new Date(year, month, day);
                            
                            if (subtask.deadline) {
                                // æ—¥ä»˜æ–‡å­—åˆ—ã®æ­£ç¢ºãªãƒ‘ãƒ¼ã‚¹ï¼ˆã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®å½±éŸ¿ã‚’é¿ã‘ã‚‹ï¼‰
                                const deadlineParts = subtask.deadline.split('-');
                                if (deadlineParts.length === 3) {
                                    const subtaskYear = parseInt(deadlineParts[0]);
                                    const subtaskMonth = parseInt(deadlineParts[1]) - 1; // æœˆã¯0ãƒ™ãƒ¼ã‚¹
                                    const subtaskDay = parseInt(deadlineParts[2]);
                                    const subtaskDateOnly = new Date(subtaskYear, subtaskMonth, subtaskDay);
                                    
                                    const currentDateOnly = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate());
                                    const isSubtaskDay = currentDateOnly.getTime() === subtaskDateOnly.getTime();
                                
                                    // ãƒ‡ãƒãƒƒã‚°: ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã®æ—¥ä»˜ç¢ºèª
                                    if (subtask.title.includes('ã‚¹ãƒˆãƒ©ã‚¤ãƒ—') && (day === 16 || day === 17 || day === 18)) {
                                        console.log(`ğŸ”´ ã‚µãƒ–ã‚¿ã‚¹ã‚¯ "${subtask.title}" - ${day}æ—¥ç›®`);
                                        console.log(`  ç¾åœ¨ã®æ—¥ä»˜: ${currentDateOnly.toISOString().split('T')[0]}`);
                                        console.log(`  æœŸé™æ—¥: ${subtaskDateOnly.toISOString().split('T')[0]}`);
                                        console.log(`  ãƒ—ãƒ­ãƒƒãƒˆå¯¾è±¡?: ${isSubtaskDay}`);
                                        console.log(`  æœŸé™æ–‡å­—åˆ—: ${subtask.deadline}`);
                                        console.log(`  ãƒ‘ãƒ¼ã‚¹çµæœ: ${subtaskYear}/${subtaskMonth + 1}/${subtaskDay}`);
                                    }
                                    
                                    if (isSubtaskDay) {
                                        ganttHTML += `
                                            <div class="gantt-day-column" style="min-width: 40px; width: 40px; max-width: 40px; flex: 0 0 40px; padding: 0; box-sizing: border-box; border-right: 1px solid #e5e7eb;">
                                                <div class="gantt-subtask-bar ${subtask.completed ? 'completed' : ''}" 
                                                     title="${subtask.title} (æœŸé™: ${subtaskDateOnly.toLocaleDateString()})">
                                                    ${subtask.title.substring(0, 3) + (subtask.title.length > 3 ? '..' : '')}
                                                </div>
                                            </div>
                                        `;
                                    } else {
                                        ganttHTML += `<div class="gantt-day-column" style="min-width: 40px; width: 40px; max-width: 40px; flex: 0 0 40px; padding: 0; box-sizing: border-box; border-right: 1px solid #e5e7eb;"></div>`;
                                    }
                                } else {
                                    ganttHTML += `<div class="gantt-day-column" style="min-width: 40px; width: 40px; max-width: 40px; flex: 0 0 40px; padding: 0; box-sizing: border-box; border-right: 1px solid #e5e7eb;"></div>`;
                                }
                            } else {
                                ganttHTML += `<div class="gantt-day-column" style="min-width: 40px; width: 40px; max-width: 40px; flex: 0 0 40px; padding: 0; box-sizing: border-box; border-right: 1px solid #e5e7eb;"></div>`;
                            }
                        }
                        
                        ganttHTML += `</div>`;
                    });
                });
                
                ganttHTML += `
                            </div>
                        </div>
                    </div>
                `;
                
                container.innerHTML = ganttHTML;
                
                // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€£å‹•ã‚’è¨­å®š
                this.setupGanttScrollSync();
                

            }

            setupGanttScrollSync() {
                const taskList = document.getElementById('gantt-task-list');
                const timeline = document.getElementById('gantt-timeline');
                const scrollableWrapper = document.querySelector('.gantt-scrollable-wrapper');
                const dateHeader = document.querySelector('.gantt-scrollable-wrapper .gantt-header-row');
                
                if (!taskList || !timeline || !scrollableWrapper) {
                    console.warn('âš ï¸ ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€£å‹•è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    console.log('taskList:', taskList, 'timeline:', timeline, 'scrollableWrapper:', scrollableWrapper);
                    return;
                }
                
                let isTaskListScrolling = false;
                let isTimelineScrolling = false;
                
                // ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« â†’ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¯é€£å‹•ã—ãªã„ï¼‰
                taskList.addEventListener('scroll', () => {
                    if (isTimelineScrolling) return;
                    isTaskListScrolling = true;
                    timeline.scrollTop = taskList.scrollTop;
                    requestAnimationFrame(() => { isTaskListScrolling = false; });
                });
                
                // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« â†’ ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¯é€£å‹•ã—ãªã„ï¼‰
                timeline.addEventListener('scroll', () => {
                    if (isTaskListScrolling) return;
                    isTimelineScrolling = true;
                    
                    // ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸã®ã¿ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¯åŒæœŸã—ãªã„ï¼‰
                    taskList.scrollTop = timeline.scrollTop;
                    
                    // æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ—ãƒ­ãƒƒãƒˆã‚¨ãƒªã‚¢ã®æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸ
                    if (dateHeader && dateHeader.firstElementChild) {
                        dateHeader.firstElementChild.style.transform = `translateX(-${timeline.scrollLeft}px)`;
                    }
                    
                    requestAnimationFrame(() => { isTimelineScrolling = false; });
                });
                
                console.log('âœ… æ­£ã—ã„ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€£å‹•ã‚’è¨­å®šã—ã¾ã—ãŸ');
                console.log('â€¢ ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«: ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ â†” ãƒ—ãƒ­ãƒƒãƒˆã‚¨ãƒªã‚¢');
                console.log('â€¢ æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«: æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ â†” ãƒ—ãƒ­ãƒƒãƒˆã‚¨ãƒªã‚¢');
            }
            
            // é¡§å®¢ç®¡ç†æ©Ÿèƒ½
            openClientModal(client = null) {
                this.currentEditingClient = client;
                const modal = document.getElementById('client-modal');
                const title = document.getElementById('client-modal-title');
                
                if (client) {
                    title.textContent = 'é¡§å®¢ã‚’ç·¨é›†';
                    this.populateClientForm(client);
                } else {
                    title.textContent = 'æ–°ã—ã„é¡§å®¢';
                    document.getElementById('client-form').reset();
                }
                
                modal.classList.remove('hidden');
                
                // ğŸ”§ ãƒ¢ãƒ¼ãƒ€ãƒ«UXå‘ä¸Šæ©Ÿèƒ½
                // Escapeã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                this.handleClientModalKeydown = (e) => {
                    if (e.key === 'Escape') {
                        this.closeClientModal();
                    }
                };
                document.addEventListener('keydown', this.handleClientModalKeydown);
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®æœ€åˆã®å…¥åŠ›è¦ç´ ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
                setTimeout(() => {
                    const firstInput = modal.querySelector('input, select, textarea');
                    if (firstInput) {
                        firstInput.focus();
                    }
                    
                    // ğŸ¯ PCç”»é¢ï¼ˆ769pxä»¥ä¸Šï¼‰ã§é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ã‚’å¼·åˆ¶æœ‰åŠ¹åŒ–
                    this.applyClientModalFormWidth();
                    
                    // ğŸ”§ ãƒ‡ãƒãƒƒã‚°ï¼šé¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®šã®ç¢ºèª
                    const modalContent = modal.querySelector('.bg-white');
                    if (modalContent) {
                        console.log('ğŸ” é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®šç¢ºèª:', {
                            overflowY: getComputedStyle(modalContent).overflowY,
                            maxHeight: getComputedStyle(modalContent).maxHeight,
                            height: getComputedStyle(modalContent).height,
                            scrollHeight: modalContent.scrollHeight,
                            clientHeight: modalContent.clientHeight,
                            display: getComputedStyle(modalContent).display,
                            isScrollable: modalContent.scrollHeight > modalContent.clientHeight
                        });
                        
                        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãŒå¿…è¦ã‹ãƒ†ã‚¹ãƒˆ
                        if (modalContent.scrollHeight <= modalContent.clientHeight) {
                            console.warn('âš ï¸ é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¸è¦ã‚µã‚¤ã‚ºã§ã™ã€‚');
                        }
                        
                        // ğŸ”§ å¸¸ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å¼·åˆ¶çš„ã«æœ‰åŠ¹åŒ–ï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚µã‚¤ã‚ºã«é–¢ä¿‚ãªãï¼‰
                        modalContent.style.setProperty('overflow-y', 'auto', 'important');
                        modalContent.style.setProperty('overflow-x', 'hidden', 'important');
                        modalContent.style.setProperty('display', 'block', 'important');
                        modalContent.style.setProperty('max-height', '85vh', 'important');
                        modalContent.style.setProperty('min-height', '400px', 'important');
                        
                        // è¦ªè¦ç´ ã®ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹è¨­å®šã‚‚ä¸Šæ›¸ã
                        const parentModal = document.getElementById('client-modal');
                        if (parentModal) {
                            parentModal.style.setProperty('align-items', 'flex-start', 'important');
                        }
                        
                        console.log('âœ… é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å¼·åˆ¶æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸï¼ˆ85vhåˆ¶é™ï¼‰');
                        
                        // ãƒ†ã‚¹ãƒˆç”¨ï¼šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä¸€æ™‚çš„ã«é•·ãã™ã‚‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ã®ã¿ï¼‰
                        if (window.location.search.includes('debug=scroll')) {
                            const testContent = document.createElement('div');
                            testContent.innerHTML = '<div style="height: 1000px; background: linear-gradient(to bottom, #f8f9fa, #e9ecef); margin: 20px 0; padding: 20px; border: 2px dashed #6c757d;">ğŸ” é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ« ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„<br><br>ã“ã®ç¸¦é•·ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§é¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚<br><br>â¬‡ï¸ ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã¾ã§ç§»å‹•ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>';
                            const form = modalContent.querySelector('form');
                            if (form) {
                                form.appendChild(testContent);
                            } else {
                                modalContent.appendChild(testContent);
                            }
                            console.log('ğŸ§ª ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼šé¡§å®¢ãƒ¢ãƒ¼ãƒ€ãƒ« ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆç”¨é•·ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼ˆ?debug=scrollï¼‰');
                        }
                    }
                }, 100);
            }
            
            closeClientModal() {
                document.getElementById('client-modal').classList.add('hidden');
                this.currentEditingClient = null;
                // Escapeã‚­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
                document.removeEventListener('keydown', this.handleClientModalKeydown);
            }
            
            populateClientForm(client) {
                document.getElementById('client-id').value = client.id;
                document.getElementById('client-name').value = client.name || '';
                document.getElementById('client-company').value = client.company || '';
                document.getElementById('client-email').value = client.email || '';
                document.getElementById('client-phone').value = client.phone || '';
                document.getElementById('client-notes').value = client.notes || '';
            }
            
            handleClientSubmit(e) {
                e.preventDefault();
                
                const clientData = {
                    id: this.currentEditingClient ? this.currentEditingClient.id : this.generateId(),
                    name: document.getElementById('client-name').value,
                    company: document.getElementById('client-company').value,
                    email: document.getElementById('client-email').value,
                    phone: document.getElementById('client-phone').value,
                    notes: document.getElementById('client-notes').value,
                    created_at: this.currentEditingClient ? this.currentEditingClient.created_at : new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                
                if (!clientData.name.trim()) {
                    alert('ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåã¯å¿…é ˆã§ã™');
                    return;
                }
                
                if (this.currentEditingClient) {
                    const index = this.clients.findIndex(c => c.id === clientData.id);
                    this.clients[index] = clientData;
                } else {
                    this.clients.push(clientData);
                }
                
                this.saveData();
                this.closeClientModal();
                this.renderClients();
                
                // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚‚æ›´æ–°
                this.updateAllClientFilters();
            }
            
            deleteClient(clientId) {
                if (confirm('ã“ã®é¡§å®¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    this.clients = this.clients.filter(c => c.id !== clientId);
                    
                    // é–¢é€£ã™ã‚‹ã‚¿ã‚¹ã‚¯ã®client_idã‚’ã‚¯ãƒªã‚¢
                    this.tasks.forEach(task => {
                        if (task.client_id === clientId) {
                            task.client_id = null;
                        }
                    });
                    
                    this.saveData();
                    this.renderClients();
                    
                    // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚‚æ›´æ–°
                    this.updateAllClientFilters();
                }
            }
            
            renderClients() {
                const tableBody = document.getElementById('clients-table-body');
                const emptyState = document.getElementById('clients-empty-state');
                
                if (this.clients.length === 0) {
                    tableBody.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    return;
                }
                
                emptyState.classList.add('hidden');
                tableBody.innerHTML = '';
                
                this.clients.forEach(client => {
                    const clientTasks = this.tasks.filter(t => t.client_id === client.id);
                    const completedTasks = clientTasks.filter(t => t.status === 'completed');
                    const totalHours = clientTasks.reduce((sum, task) => sum + (task.actual_hours || 0), 0);
                    
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors';
                    
                    const contactInfo = [];
                    if (client.email) contactInfo.push(`<div class="text-xs text-gray-600"><i class="fas fa-envelope mr-1"></i>${client.email}</div>`);
                    if (client.phone) contactInfo.push(`<div class="text-xs text-gray-600"><i class="fas fa-phone mr-1"></i>${client.phone}</div>`);
                    
                    row.innerHTML = `
                        <td class="px-4 py-3">
                            <div class="font-medium text-gray-900">${client.name}</div>
                            ${client.notes ? `<div class="text-xs text-gray-500 mt-1 truncate" title="${client.notes}">${client.notes}</div>` : ''}
                        </td>
                        <td class="px-4 py-3">
                            <div class="text-sm text-gray-900">${client.company || '-'}</div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="space-y-1">
                                ${contactInfo.join('') || '<span class="text-gray-400 text-xs">-</span>'}
                            </div>
                        </td>
                        <td class="px-4 py-3 text-center">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                ${clientTasks.length}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-center">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                ${completedTasks.length}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-center">
                            <span class="text-sm font-medium text-gray-900">${this.formatHoursToHHMM(totalHours)}</span>
                        </td>
                        <td class="px-4 py-3 text-center">
                            <div class="flex justify-center space-x-1">
                                <button class="p-1.5 rounded-md border border-gray-300 hover:bg-gray-50 transition-colors"
                                        onclick="app.openClientModal(app.clients.find(c => c.id === '${client.id}'))" 
                                        title="ç·¨é›†">
                                    <i class="fas fa-edit text-xs text-gray-600"></i>
                                </button>
                                <button class="p-1.5 rounded-md border border-gray-300 hover:bg-red-50 transition-colors text-red-600"
                                        onclick="app.deleteClient('${client.id}')" 
                                        title="å‰Šé™¤">
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
            
            // ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½
            renderReports() {
                this.updateReportStats();
                this.renderCharts();
                this.initializeMonthlyReport();
            }
            
            updateReportStats() {
                const totalTasks = this.tasks.length;
                const completedTasks = this.tasks.filter(t => t.status === 'completed').length;
                const totalHours = this.tasks.reduce((sum, task) => sum + (task.actual_hours || 0), 0);
                const totalClients = this.clients.length;
                
                document.getElementById('total-tasks').textContent = totalTasks;
                document.getElementById('completed-tasks').textContent = completedTasks;
                document.getElementById('total-hours').textContent = this.formatHoursToReadable(totalHours);
                document.getElementById('total-clients').textContent = totalClients;
            }
            
            renderCharts() {
                this.renderStatusChart();
                this.renderPriorityChart();
                this.renderMonthlyHoursChart();
            }
            
            renderStatusChart() {
                const ctx = document.getElementById('status-chart').getContext('2d');
                
                const statusCounts = {
                    pending: this.tasks.filter(t => t.status === 'pending').length,
                    in_progress: this.tasks.filter(t => t.status === 'in_progress').length,
                    completed: this.tasks.filter(t => t.status === 'completed').length
                };
                
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['æœªç€æ‰‹', 'é€²è¡Œä¸­', 'å®Œäº†'],
                        datasets: [{
                            data: [statusCounts.pending, statusCounts.in_progress, statusCounts.completed],
                            backgroundColor: ['#FEF3C7', '#DBEAFE', '#D1FAE5'],
                            borderColor: ['#F59E0B', '#3B82F6', '#10B981'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            renderPriorityChart() {
                const ctx = document.getElementById('priority-chart').getContext('2d');
                
                const priorityCounts = {
                    high: this.tasks.filter(t => t.priority === 'high').length,
                    medium: this.tasks.filter(t => t.priority === 'medium').length,
                    low: this.tasks.filter(t => t.priority === 'low').length
                };
                
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['é«˜', 'ä¸­', 'ä½'],
                        datasets: [{
                            label: 'ã‚¿ã‚¹ã‚¯æ•°',
                            data: [priorityCounts.high, priorityCounts.medium, priorityCounts.low],
                            backgroundColor: ['#FEE2E2', '#FED7AA', '#F3F4F6'],
                            borderColor: ['#EF4444', '#F97316', '#6B7280'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            renderMonthlyHoursChart() {
                const ctx = document.getElementById('monthly-hours-chart').getContext('2d');
                
                // éå»6ãƒ¶æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
                const months = [];
                const hoursData = [];
                const today = new Date();
                
                for (let i = 5; i >= 0; i--) {
                    const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
                    const monthStr = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    months.push(`${date.getMonth() + 1}æœˆ`);
                    
                    // ãã®æœˆã«å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã®ä½œæ¥­æ™‚é–“ã‚’åˆè¨ˆ
                    const monthHours = this.tasks
                        .filter(task => {
                            if (task.status !== 'completed' || !task.updated_at) return false;
                            const taskMonth = task.updated_at.substring(0, 7);
                            return taskMonth === monthStr;
                        })
                        .reduce((sum, task) => sum + (task.actual_hours || 0), 0);
                    
                    hoursData.push(monthHours);
                }
                
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'ä½œæ¥­æ™‚é–“',
                            data: hoursData,
                            borderColor: '#3B82F6',
                            backgroundColor: '#DBEAFE',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'æ™‚é–“'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // æœˆæ¬¡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆ¥ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½
            initializeMonthlyReport() {
                // å¹´é¸æŠã®åˆæœŸåŒ–
                const yearSelect = document.getElementById('report-year');
                const monthSelect = document.getElementById('report-month');
                const currentYear = new Date().getFullYear();
                const currentMonth = new Date().getMonth() + 1;
                
                // å¹´ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆï¼ˆç¾åœ¨å¹´Â±2å¹´ï¼‰
                yearSelect.innerHTML = '';
                for (let year = currentYear - 2; year <= currentYear + 1; year++) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = `${year}å¹´`;
                    if (year === currentYear) option.selected = true;
                    yearSelect.appendChild(option);
                }
                
                // æœˆã®åˆæœŸé¸æŠ
                monthSelect.value = currentMonth;
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ 
                yearSelect.addEventListener('change', () => this.updateMonthlyReport());
                monthSelect.addEventListener('change', () => this.updateMonthlyReport());
                
                // åˆæœŸè¡¨ç¤º
                this.updateMonthlyReport();
            }
            
            updateMonthlyReport() {
                const year = parseInt(document.getElementById('report-year').value);
                const month = parseInt(document.getElementById('report-month').value);
                
                const startDate = new Date(year, month - 1, 1);
                const endDate = new Date(year, month, 0, 23, 59, 59);
                
                // æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
                const monthlyData = this.generateMonthlyClientReport(startDate, endDate);
                
                // ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
                this.renderClientMonthlySummary(monthlyData);
                
                // ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
                this.renderMonthlyReportTable(monthlyData);
            }
            
            generateMonthlyClientReport(startDate, endDate) {
                const clientData = {};
                
                this.tasks.forEach(task => {
                    if (!task.time_sessions || task.time_sessions.length === 0) return;
                    
                    const client = task.client_id ? 
                        this.clients.find(c => c.id === task.client_id) || { name: 'æœªæŒ‡å®šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ', id: 'unspecified' } :
                        { name: 'æœªæŒ‡å®šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ', id: 'unspecified' };
                    
                    if (!clientData[client.id]) {
                        clientData[client.id] = {
                            client: client,
                            totalHours: 0,
                            totalSessions: 0,
                            tasks: {},
                            lastUpdated: null
                        };
                    }
                    
                    task.time_sessions.forEach(session => {
                        const sessionDate = new Date(session.start_time);
                        
                        if (sessionDate >= startDate && sessionDate <= endDate) {
                            clientData[client.id].totalHours += session.hours || 0;
                            clientData[client.id].totalSessions += 1;
                            
                            if (!clientData[client.id].tasks[task.id]) {
                                clientData[client.id].tasks[task.id] = {
                                    task: task,
                                    hours: 0,
                                    sessions: 0,
                                    lastUpdated: null
                                };
                            }
                            
                            clientData[client.id].tasks[task.id].hours += session.hours || 0;
                            clientData[client.id].tasks[task.id].sessions += 1;
                            
                            const sessionUpdateTime = new Date(session.created_at || session.start_time);
                            if (!clientData[client.id].lastUpdated || sessionUpdateTime > clientData[client.id].lastUpdated) {
                                clientData[client.id].lastUpdated = sessionUpdateTime;
                            }
                            if (!clientData[client.id].tasks[task.id].lastUpdated || sessionUpdateTime > clientData[client.id].tasks[task.id].lastUpdated) {
                                clientData[client.id].tasks[task.id].lastUpdated = sessionUpdateTime;
                            }
                        }
                    });
                });
                
                return Object.values(clientData).filter(data => data.totalHours > 0);
            }
            
            renderClientMonthlySummary(monthlyData) {
                const summaryContainer = document.getElementById('client-monthly-summary');
                summaryContainer.innerHTML = '';
                
                if (monthlyData.length === 0) {
                    summaryContainer.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">é¸æŠã•ã‚ŒãŸæœˆã®ä½œæ¥­ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                    return;
                }
                
                // ä½œæ¥­æ™‚é–“é †ã«ã‚½ãƒ¼ãƒˆ
                monthlyData.sort((a, b) => b.totalHours - a.totalHours);
                
                monthlyData.forEach(clientData => {
                    const card = document.createElement('div');
                    card.className = 'bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-2 border border-blue-200';
                    
                    card.innerHTML = `
                        <div class="flex items-center justify-between mb-1">
                            <h4 class="font-semibold text-gray-900 text-sm">${clientData.client.name}</h4>
                            <i class="fas fa-user-circle text-blue-600 text-sm"></i>
                        </div>
                        <div class="space-y-0.5 text-xs">
                            <div class="flex justify-between">
                                <span class="text-gray-600">ä½œæ¥­æ™‚é–“:</span>
                                <span class="font-semibold text-blue-700">${this.formatHoursToReadable(clientData.totalHours)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°:</span>
                                <span class="font-medium text-gray-700">${clientData.totalSessions}å›</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ã‚¿ã‚¹ã‚¯æ•°:</span>
                                <span class="font-medium text-gray-700">${Object.keys(clientData.tasks).length}å€‹</span>
                            </div>
                        </div>
                    `;
                    
                    summaryContainer.appendChild(card);
                });
            }
            
            renderMonthlyReportTable(monthlyData) {
                const tableBody = document.getElementById('monthly-report-table');
                tableBody.innerHTML = '';
                
                if (monthlyData.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                    return;
                }
                
                monthlyData.forEach(clientData => {
                    Object.values(clientData.tasks).forEach(taskData => {
                        const row = document.createElement('tr');
                        row.className = 'hover:bg-gray-50';
                        
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                ${clientData.client.name}
                                ${clientData.client.company ? `<br><span class="text-xs text-gray-500">${clientData.client.company}</span>` : ''}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                ${taskData.task.title}
                                <br><span class="text-xs text-gray-500">${taskData.task.status === 'completed' ? 'å®Œäº†' : taskData.task.status === 'in_progress' ? 'é€²è¡Œä¸­' : 'æœªç€æ‰‹'}</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">
                                ${this.formatHoursToReadable(taskData.hours)}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                ${taskData.sessions}ã‚»ãƒƒã‚·ãƒ§ãƒ³
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                ${taskData.lastUpdated ? taskData.lastUpdated.toLocaleDateString('ja-JP') : 'N/A'}
                            </td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                });
            }
            
            // Google Calendar APIçµ±åˆæ©Ÿèƒ½
            async initializeGoogleCalendarAPI() {
                try {
                    const apiKey = this.settings.googleApiKey;
                    const clientId = this.settings.googleClientId;
                    
                    if (!apiKey || !clientId) {
                        this.updateCalendarStatus('APIã‚­ãƒ¼ã¾ãŸã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                        return;
                    }
                    
                    // Google API ClientåˆæœŸåŒ–
                    await new Promise((resolve) => {
                        if (window.gapi) {
                            gapi.load('client', resolve);
                        } else {
                            this.updateCalendarStatus('Google API Clientã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                        }
                    });
                    
                    await gapi.client.init({
                        apiKey: apiKey,
                        discoveryDocs: [
                            'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest',
                            'https://www.googleapis.com/discovery/v1/apis/tasks/v1/rest'
                        ]
                    });
                    
                    // Google Identity ServicesåˆæœŸåŒ–
                    if (window.google && window.google.accounts) {
                        this.googleTokenClient = google.accounts.oauth2.initTokenClient({
                            client_id: clientId,
                            scope: 'https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/tasks',
                            callback: (tokenResponse) => {
                                this.googleAccessToken = tokenResponse.access_token;
                                gapi.client.setToken({access_token: tokenResponse.access_token});
                                this.updateCalendarStatus('Google Calendarã«æ­£å¸¸ã«æ¥ç¶šã•ã‚Œã¾ã—ãŸ', 'success');
                                document.getElementById('sync-tasks-to-calendar').disabled = false;
                            }
                        });
                    }
                    
                    this.isGoogleCalendarInitialized = true;
                    this.updateCalendarStatus('Google Calendar APIåˆæœŸåŒ–å®Œäº†', 'success');
                    
                } catch (error) {
                    console.error('Google Calendar APIåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                    this.updateCalendarStatus(`åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }
            
            updateCalendarStatus(message, type) {
                const statusElement = document.getElementById('calendar-status');
                statusElement.textContent = message;
                statusElement.className = `text-sm ${
                    type === 'success' ? 'text-green-600' : 
                    type === 'error' ? 'text-red-600' : 
                    'text-blue-600'
                }`;
            }
            
            async authenticateGoogleCalendar() {
                try {
                    this.saveSettings(); // ç¾åœ¨ã®è¨­å®šã‚’ä¿å­˜
                    
                    if (!this.isGoogleCalendarInitialized) {
                        await this.initializeGoogleCalendarAPI();
                    }
                    
                    if (this.googleTokenClient) {
                        this.updateCalendarStatus('èªè¨¼ä¸­...', 'info');
                        this.googleTokenClient.requestAccessToken();
                    } else {
                        this.updateCalendarStatus('Google OAuth2ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    }
                } catch (error) {
                    console.error('Googleèªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
                    this.updateCalendarStatus(`èªè¨¼ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }
            
            async testCalendarConnection() {
                try {
                    if (!this.googleAccessToken) {
                        this.updateCalendarStatus('ã¾ãšGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„', 'error');
                        return;
                    }
                    
                    const calendarId = document.getElementById('calendar-id').value || 'primary';
                    
                    this.updateCalendarStatus('æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...', 'info');
                    
                    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¦ãƒ†ã‚¹ãƒˆ
                    const response = await gapi.client.calendar.calendars.get({
                        calendarId: calendarId
                    });
                    
                    if (response.status === 200) {
                        const calendarName = response.result.summary;
                        this.updateCalendarStatus(`æ¥ç¶šæˆåŠŸ: ${calendarName}`, 'success');
                        document.getElementById('sync-tasks-to-calendar').disabled = false;
                    }
                    
                } catch (error) {
                    console.error('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ¥ç¶šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                    this.updateCalendarStatus(`æ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
                }
            }
            
            async syncTasksToCalendar() {
                try {
                    // é‡è¤‡å®Ÿè¡Œé˜²æ­¢ãƒã‚§ãƒƒã‚¯
                    if (this.calendarSyncInProgress) {
                        console.warn('âš ï¸ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŒæœŸãŒæ—¢ã«é€²è¡Œä¸­ã§ã™ã€‚é‡è¤‡å®Ÿè¡Œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã€‚');
                        this.updateCalendarStatus('åŒæœŸãŒæ—¢ã«é€²è¡Œä¸­ã§ã™', 'warning');
                        return;
                    }
                    
                    if (!this.googleAccessToken) {
                        this.updateCalendarStatus('Googleèªè¨¼ãŒå¿…è¦ã§ã™', 'error');
                        return;
                    }
                    
                    // åŒæœŸé–‹å§‹ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
                    this.calendarSyncInProgress = true;
                    const syncButton = document.getElementById('sync-tasks-to-calendar');
                    if (syncButton) {
                        syncButton.disabled = true;
                        syncButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>åŒæœŸä¸­...';
                    }
                    
                    const calendarId = document.getElementById('calendar-id').value || 'primary';
                    console.log(`ğŸš€ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŒæœŸé–‹å§‹ [ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ID: ${calendarId}]`);
                    // äºˆå®šé–‹å§‹æ—¥æ™‚ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‚¿ã‚¹ã‚¯ï¼ˆå®Œäº†ãƒ»æœªå®Œäº†å•ã‚ãšï¼‰ã‚’åŒæœŸ
                    const syncableTasks = this.tasks.filter(task => 
                        task.scheduled_date
                    );
                    
                    this.updateCalendarStatus(`${syncableTasks.length}å€‹ã®ã‚¿ã‚¹ã‚¯ã‚’åŒæœŸä¸­...`, 'info');
                    
                    let syncedCount = 0;
                    let errorCount = 0;
                    
                    // ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¹ã‚¯ã®åŒæœŸ
                    for (const task of syncableTasks) {
                        try {
                            await this.syncMainTaskToCalendar(task, calendarId);
                            syncedCount++;
                        } catch (taskError) {
                            console.error(`ã‚¿ã‚¹ã‚¯ ${task.title} ã®åŒæœŸã‚¨ãƒ©ãƒ¼:`, taskError);
                            errorCount++;
                        }
                    }
                    
                    // ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã®åŒæœŸ
                    for (const task of syncableTasks) {
                        if (task.subtasks && task.subtasks.length > 0) {
                            for (const subtask of task.subtasks) {
                                if (subtask.deadline) {
                                    try {
                                        await this.syncSubtaskToCalendar(subtask, task, calendarId);
                                        syncedCount++;
                                    } catch (subtaskError) {
                                        console.error(`ã‚µãƒ–ã‚¿ã‚¹ã‚¯ ${subtask.title} ã®åŒæœŸã‚¨ãƒ©ãƒ¼:`, subtaskError);
                                        errorCount++;
                                    }
                                }
                            }
                        }
                    }
                    
                    // äºˆå®šé–‹å§‹æ—¥æ™‚ãŒå‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤
                    await this.cleanupRemovedSchedules(calendarId);
                    
                    const resultMessage = `åŒæœŸå®Œäº†: ${syncedCount}å€‹æˆåŠŸ`;
                    const errorMessage = errorCount > 0 ? `, ${errorCount}å€‹ã‚¨ãƒ©ãƒ¼` : '';
                    this.updateCalendarStatus(resultMessage + errorMessage, syncedCount > 0 ? 'success' : 'error');
                    
                } catch (error) {
                    console.error('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
                    this.updateCalendarStatus(`åŒæœŸã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                } finally {
                    // åŒæœŸå®Œäº†ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
                    this.calendarSyncInProgress = false;
                    const syncButton = document.getElementById('sync-tasks-to-calendar');
                    if (syncButton) {
                        syncButton.disabled = false;
                        syncButton.innerHTML = '<i class="fas fa-sync mr-1"></i>ã‚¿ã‚¹ã‚¯ã‚’åŒæœŸ';
                    }
                    console.log('ğŸ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŒæœŸå‡¦ç†å®Œäº†');
                }
            }
            
            createEventDescription(task) {
                const client = task.client_id ? this.clients.find(c => c.id === task.client_id) : null;
                const priorityText = { high: 'é«˜', medium: 'ä¸­', low: 'ä½' };
                
                let description = `TaskFlow Pro ã‹ã‚‰åŒæœŸ\n\n`;
                description += `å„ªå…ˆåº¦: ${priorityText[task.priority]}\n`;
                description += `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${task.status === 'pending' ? 'æœªç€æ‰‹' : task.status === 'in_progress' ? 'é€²è¡Œä¸­' : 'å®Œäº†'}\n`;
                
                if (client) {
                    description += `é¡§å®¢: ${client.name}`;
                    if (client.company) description += ` (${client.company})`;
                    description += `\n`;
                }
                
                if (task.estimated_hours > 0) {
                    description += `äºˆæƒ³ä½œæ¥­æ™‚é–“: ${this.formatHoursToReadable(task.estimated_hours)}\n`;
                }
                
                if (task.description) {
                    description += `\nèª¬æ˜:\n${task.description}`;
                }
                
                return description;
            }
            
            // è‡ªå‹•åŒæœŸæ©Ÿèƒ½
            async autoSyncToCalendar(taskId = null) {
                // è‡ªå‹•åŒæœŸãŒç„¡åŠ¹ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„
                if (!document.getElementById('auto-sync-toggle').checked) {
                    console.log('è‡ªå‹•åŒæœŸãŒç„¡åŠ¹ã®ãŸã‚ã€åŒæœŸã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ');
                    return;
                }
                
                // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŒæœŸãŒæœ‰åŠ¹ã§ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
                if (!document.getElementById('calendar-sync-toggle').checked) {
                    console.log('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŒæœŸãŒç„¡åŠ¹ã®ãŸã‚ã€è‡ªå‹•åŒæœŸã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ');
                    return;
                }
                
                // Googleèªè¨¼ãŒã•ã‚Œã¦ã„ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
                if (!this.googleAccessToken) {
                    console.log('Googleèªè¨¼ãŒå¿…è¦ãªãŸã‚ã€è‡ªå‹•åŒæœŸã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ');
                    return;
                }
                
                try {
                    console.log(`ğŸ”„ è‡ªå‹•åŒæœŸé–‹å§‹ ${taskId ? `(ã‚¿ã‚¹ã‚¯ID: ${taskId})` : '(å…¨ã‚¿ã‚¹ã‚¯)'}`);
                    
                    // åŒæœŸçŠ¶æ³ã‚’è¡¨ç¤º
                    this.updateCalendarStatus('è‡ªå‹•åŒæœŸä¸­...', 'info');
                    
                    // çŸ­ã„é…å»¶ã‚’å…¥ã‚Œã¦ã€UIæ›´æ–°ã¨ã®ç«¶åˆã‚’é¿ã‘ã‚‹
                    setTimeout(async () => {
                        try {
                            await this.syncTasksToCalendar();
                            console.log('âœ… è‡ªå‹•åŒæœŸå®Œäº†');
                        } catch (error) {
                            console.error('è‡ªå‹•åŒæœŸã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                            this.updateCalendarStatus('è‡ªå‹•åŒæœŸã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
                        }
                    }, 500);
                    
                } catch (error) {
                    console.error('è‡ªå‹•åŒæœŸã®æº–å‚™ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                }
            }
            
            async syncMainTaskToCalendar(task, calendarId) {
                // äºˆå®šé–‹å§‹æ—¥æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                if (!task.scheduled_date) {
                    console.log(`â­ï¸ ã‚¹ã‚­ãƒƒãƒ—: ${task.title} - äºˆå®šé–‹å§‹æ—¥æ™‚ãŒæœªè¨­å®š`);
                    return;
                }
                
                // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®æ¤œè¨¼ã¨ä¿®æ­£
                let scheduledDateTime = task.scheduled_date;
                let startDateTime;
                
                // ISOæ—¥ä»˜æ™‚åˆ»å½¢å¼ (2025-09-17T07:13) ã®å ´åˆã¯æ™‚åˆ»æƒ…å ±ã‚’ä¿æŒ
                if (/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/.test(scheduledDateTime)) {
                    // æ™‚åˆ»æƒ…å ±ãŒã‚ã‚‹å ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨ï¼ˆç§’æƒ…å ±ãŒãªã„å ´åˆã¯è¿½åŠ ï¼‰
                    if (!scheduledDateTime.includes(':00', scheduledDateTime.lastIndexOf(':'))) {
                        scheduledDateTime += ':00'; // ç§’æƒ…å ±ã‚’è¿½åŠ 
                    }
                    
                    // æ—¥æœ¬æ™‚é–“ã¨ã—ã¦è§£é‡ˆã™ã‚‹ãŸã‚ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚ªãƒ•ã‚»ãƒƒãƒˆãªã—ã§å‡¦ç†
                    startDateTime = new Date(scheduledDateTime);
                    
                    // ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã¨ã—ã¦è§£é‡ˆã•ã‚ŒãŸæ—¥ä»˜ãŒæ­£ã—ã„ã‹ãƒã‚§ãƒƒã‚¯
                    if (isNaN(startDateTime.getTime())) {
                        console.warn(`âš ï¸ æ—¥æ™‚è§£æã‚¨ãƒ©ãƒ¼: ${task.title} - ${scheduledDateTime}`);
                        return;
                    }
                    
                    console.log(`ğŸ“… æ™‚åˆ»æƒ…å ±ã‚’ä¿æŒ: ${task.title}`);
                    console.log(`   - å…ƒãƒ‡ãƒ¼ã‚¿: ${task.scheduled_date}`);
                    console.log(`   - å‡¦ç†å¾Œ: ${scheduledDateTime}`);
                    console.log(`   - æ—¥æœ¬æ™‚é–“: ${startDateTime.toLocaleString('ja-JP')}`);
                    console.log(`   - UTCæ™‚é–“: ${startDateTime.toISOString()}`);
                } else if (/^\d{4}-\d{2}-\d{2}$/.test(scheduledDateTime)) {
                    // æ—¥ä»˜ã®ã¿ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§9:00é–‹å§‹
                    startDateTime = new Date(scheduledDateTime + 'T09:00:00');
                    console.log(`ğŸ“… æ—¥ä»˜ã®ã¿ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ9:00é–‹å§‹: ${task.title} - ${scheduledDateTime} (${startDateTime.toLocaleString('ja-JP')})`);
                } else {
                    console.warn(`âš ï¸ ä¸æ­£ãªæ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: ${task.title} - ${scheduledDateTime}`);
                    return;
                }
                
                // ã‚¿ã‚¹ã‚¯åï¼šæœŸé™ ã®å½¢å¼ã§ä»¶åã‚’ä½œæˆï¼ˆå®Œäº†ã®å ´åˆã¯âœ…ã‚’è¿½åŠ ï¼‰
                let summary = task.status === 'completed' ? 'âœ… ' : '';
                summary += task.title;
                if (task.deadline) {
                    summary += ` : æœŸé™ ${task.deadline}`;
                }
                
                // äºˆå®šé–‹å§‹æ—¥æ™‚ã¨çµ‚äº†æ™‚é–“ã‚’è¨ˆç®—
                
                // æ—¥ä»˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æœ‰åŠ¹æ€§ã‚’ãƒã‚§ãƒƒã‚¯
                if (isNaN(startDateTime.getTime())) {
                    console.error(`âŒ ç„¡åŠ¹ãªé–‹å§‹æ—¥æ™‚: ${task.title} - ${scheduledDate}`);
                    return;
                }
                
                let endDateTime;
                if (task.estimated_hours && task.estimated_hours > 0) {
                    // äºˆæƒ³ä½œæ¥­æ™‚é–“ã«å¿œã˜ã¦çµ‚äº†æ™‚é–“ã‚’è¨­å®š
                    endDateTime = new Date(startDateTime.getTime() + (task.estimated_hours * 60 * 60 * 1000));
                } else {
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§1æ™‚é–“å¾Œ
                    endDateTime = new Date(startDateTime.getTime() + (1 * 60 * 60 * 1000));
                }
                
                // çµ‚äº†æ—¥æ™‚ã®æœ‰åŠ¹æ€§ã‚‚ãƒã‚§ãƒƒã‚¯
                if (isNaN(endDateTime.getTime())) {
                    console.error(`âŒ ç„¡åŠ¹ãªçµ‚äº†æ—¥æ™‚: ${task.title} - äºˆæƒ³ä½œæ¥­æ™‚é–“: ${task.estimated_hours}`);
                    return;
                }
                
                console.log(`ğŸ—“ï¸ Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆæº–å‚™: ${task.title}`);
                console.log(`   - é–‹å§‹æ™‚åˆ»ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰: ${startDateTime.toLocaleString('ja-JP')}`);
                console.log(`   - é–‹å§‹æ™‚åˆ»ï¼ˆISOï¼‰: ${startDateTime.toISOString()}`);
                console.log(`   - çµ‚äº†æ™‚åˆ»ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰: ${endDateTime.toLocaleString('ja-JP')}`);
                console.log(`   - çµ‚äº†æ™‚åˆ»ï¼ˆISOï¼‰: ${endDateTime.toISOString()}`);

                const eventResource = {
                    summary: summary,
                    description: this.createEventDescription(task),
                    start: {
                        dateTime: startDateTime.toISOString(),
                        timeZone: 'Asia/Tokyo'
                    },
                    end: {
                        dateTime: endDateTime.toISOString(),
                        timeZone: 'Asia/Tokyo'
                    },
                    reminders: {
                        useDefault: false,
                        overrides: [
                            {method: 'popup', minutes: 30},
                            {method: 'popup', minutes: 10}
                        ]
                    },
                    extendedProperties: {
                        private: {
                            taskflow_task_id: task.id,
                            taskflow_type: 'main_task',
                            taskflow_sync: 'true'
                        }
                    }
                };
                
                // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆTaskFlow IDã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ã«è­˜åˆ¥ï¼‰
                // ã‚ˆã‚Šåºƒç¯„å›²ã§é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½
                const searchStartTime = new Date();
                searchStartTime.setFullYear(searchStartTime.getFullYear() - 1); // 1å¹´å‰ã‹ã‚‰
                const searchEndTime = new Date();
                searchEndTime.setFullYear(searchEndTime.getFullYear() + 1); // 1å¹´å¾Œã¾ã§
                
                const existingEvents = await gapi.client.calendar.events.list({
                    calendarId: calendarId,
                    privateExtendedProperty: `taskflow_task_id=${task.id}`,
                    showDeleted: false,
                    singleEvents: true,
                    timeMin: searchStartTime.toISOString(),
                    timeMax: searchEndTime.toISOString(),
                    maxResults: 100 // ååˆ†ãªæ•°ã‚’ç¢ºä¿
                });
                
                console.log(`ğŸ” é‡è¤‡ãƒã‚§ãƒƒã‚¯çµæœ [${task.title}]: æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆæ•° = ${existingEvents.result.items?.length || 0}`);
                
                if (existingEvents.result.items && existingEvents.result.items.length > 0) {
                    // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒè¤‡æ•°ã‚ã‚‹å ´åˆã€é‡è¤‡ã‚’å‰Šé™¤
                    if (existingEvents.result.items.length > 1) {
                        console.warn(`âš ï¸ é‡è¤‡ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡º [${task.title}]: ${existingEvents.result.items.length}å€‹ - é‡è¤‡å‰Šé™¤ä¸­...`);
                        
                        // æœ€åˆã®ã‚¤ãƒ™ãƒ³ãƒˆä»¥å¤–ã‚’å‰Šé™¤
                        for (let i = 1; i < existingEvents.result.items.length; i++) {
                            try {
                                await gapi.client.calendar.events.delete({
                                    calendarId: calendarId,
                                    eventId: existingEvents.result.items[i].id
                                });
                                console.log(`ğŸ—‘ï¸ é‡è¤‡ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤å®Œäº†: ${existingEvents.result.items[i].id}`);
                            } catch (deleteError) {
                                console.error(`âŒ é‡è¤‡ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤ã‚¨ãƒ©ãƒ¼:`, deleteError);
                            }
                        }
                    }
                    
                    // æœ€åˆï¼ˆæ®‹ã£ãŸï¼‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›´æ–°
                    const eventId = existingEvents.result.items[0].id;
                    const existingEvent = existingEvents.result.items[0];
                    
                    console.log(`ğŸ”„ ã‚¿ã‚¹ã‚¯ "${task.title}" ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›´æ–°ä¸­...`);
                    console.log(`   - ã‚¤ãƒ™ãƒ³ãƒˆID: ${eventId}`);
                    console.log(`   - æ—§é–‹å§‹æ™‚é–“: ${existingEvent.start.dateTime || existingEvent.start.date}`);
                    console.log(`   - æ–°é–‹å§‹æ™‚é–“: ${eventResource.start.dateTime}`);
                    console.log(`   - æ—§ä»¶å: ${existingEvent.summary}`);
                    console.log(`   - æ–°ä»¶å: ${eventResource.summary}`);
                    
                    await gapi.client.calendar.events.update({
                        calendarId: calendarId,
                        eventId: eventId,
                        resource: eventResource
                    });
                    
                    console.log(`âœ… ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°å®Œäº†: ${task.title}`);
                } else {
                    // æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆ
                    console.log(`â• æ–°è¦ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ: ${task.title}`);
                    console.log(`   - ã‚¿ã‚¹ã‚¯ID: ${task.id}`);
                    console.log(`   - é–‹å§‹æ™‚é–“: ${eventResource.start.dateTime}`);
                    console.log(`   - ä»¶å: ${eventResource.summary}`);
                    
                    const createdEvent = await gapi.client.calendar.events.insert({
                        calendarId: calendarId,
                        resource: eventResource
                    });
                    
                    console.log(`âœ… ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆå®Œäº†: ${task.title} (EventID: ${createdEvent.result.id})`);
                }
            }
            
            async syncSubtaskToCalendar(subtask, parentTask, calendarId) {
                // Google Calendarã«ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ä½œæˆã™ã‚‹ãŸã‚ã®è¨­å®š
                const taskResource = {
                    title: subtask.title,
                    notes: `è¦ªã‚¿ã‚¹ã‚¯: ${parentTask.title}\næœŸé™: ${subtask.deadline}`,
                    due: subtask.deadline + 'T23:59:59.000Z',
                    status: subtask.completed ? 'completed' : 'needsAction'
                };
                
                // Google Tasks APIã‚’ä½¿ç”¨ã—ã¦ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
                // æ³¨æ„: Google Tasks APIã‚‚æœ‰åŠ¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
                try {
                    // ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆå–å¾—
                    const taskLists = await gapi.client.tasks.tasklists.list();
                    let taskListId = taskLists.result.items[0].id; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ
                    
                    // æ—¢å­˜ã®ã‚¿ã‚¹ã‚¯ã‚’ãƒã‚§ãƒƒã‚¯
                    const existingTasks = await gapi.client.tasks.tasks.list({
                        tasklist: taskListId,
                        showCompleted: true
                    });
                    
                    let existingTask = existingTasks.result.items?.find(t => 
                        t.notes && t.notes.includes(`TaskFlow ID: ${subtask.id || parentTask.id}-${subtask.title}`)
                    );
                    
                    // TaskFlow IDã‚’å«ã‚€ãƒ¡ãƒ¢ã‚’è¿½åŠ 
                    taskResource.notes += `\nTaskFlow ID: ${subtask.id || parentTask.id}-${subtask.title}`;
                    
                    if (existingTask) {
                        // æ—¢å­˜ã®ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°
                        await gapi.client.tasks.tasks.update({
                            tasklist: taskListId,
                            task: existingTask.id,
                            resource: taskResource
                        });
                    } else {
                        // æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
                        await gapi.client.tasks.tasks.insert({
                            tasklist: taskListId,
                            resource: taskResource
                        });
                    }
                } catch (error) {
                    console.warn('Google Tasks APIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦ä½œæˆã—ã¾ã™ã€‚', error);
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦ä½œæˆ
                    await this.createSubtaskAsEvent(subtask, parentTask, calendarId);
                }
            }
            
            async cleanupRemovedSchedules(calendarId) {
                try {
                    console.log('ğŸ§¹ äºˆå®šé–‹å§‹æ—¥æ™‚ãŒå‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­...');
                    
                    // TaskFlowã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—
                    const allTaskFlowEvents = await gapi.client.calendar.events.list({
                        calendarId: calendarId,
                        privateExtendedProperty: 'taskflow_sync=true',
                        showDeleted: false,
                        singleEvents: true,
                        timeMin: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000).toISOString(), // 1å¹´å‰ã‹ã‚‰
                        timeMax: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString()  // 1å¹´å¾Œã¾ã§
                    });
                    
                    let deletedCount = 0;
                    
                    for (const event of allTaskFlowEvents.result.items) {
                        const taskId = event.extendedProperties?.private?.taskflow_task_id;
                        const taskType = event.extendedProperties?.private?.taskflow_type;
                        
                        if (taskId && taskType === 'main_task') {
                            // å¯¾å¿œã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’æ¤œç´¢
                            const task = this.tasks.find(t => t.id === taskId);
                            
                            if (!task) {
                                // ã‚¿ã‚¹ã‚¯ãŒå‰Šé™¤ã•ã‚ŒãŸå ´åˆ
                                console.log(`ğŸ—‘ï¸ å‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤: ${event.summary}`);
                                await gapi.client.calendar.events.delete({
                                    calendarId: calendarId,
                                    eventId: event.id
                                });
                                deletedCount++;
                            } else if (!task.scheduled_date) {
                                // äºˆå®šé–‹å§‹æ—¥æ™‚ãŒå‰Šé™¤ã•ã‚ŒãŸå ´åˆ
                                console.log(`ğŸ“… äºˆå®šé–‹å§‹æ—¥æ™‚ãŒå‰Šé™¤ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤: ${event.summary}`);
                                await gapi.client.calendar.events.delete({
                                    calendarId: calendarId,
                                    eventId: event.id
                                });
                                deletedCount++;
                            }
                        }
                    }
                    
                    if (deletedCount > 0) {
                        console.log(`âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†: ${deletedCount}å€‹ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤`);
                    }
                    
                } catch (error) {
                    console.error('ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                }
            }
            
            async createSubtaskAsEvent(subtask, parentTask, calendarId) {
                const completedMark = subtask.completed ? 'âœ… ' : '';
                const eventResource = {
                    summary: `ğŸ“Œ ${completedMark}${subtask.title}`,
                    description: `ã‚µãƒ–ã‚¿ã‚¹ã‚¯\nè¦ªã‚¿ã‚¹ã‚¯: ${parentTask.title}\næœŸé™: ${subtask.deadline}`,
                    start: {
                        date: subtask.deadline
                    },
                    end: {
                        date: subtask.deadline
                    },
                    extendedProperties: {
                        private: {
                            taskflow_subtask_id: subtask.id || `${parentTask.id}-${subtask.title}`,
                            taskflow_type: 'subtask',
                            taskflow_parent_id: parentTask.id,
                            taskflow_sync: 'true'
                        }
                    }
                };
                
                // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒã‚§ãƒƒã‚¯
                const existingEvents = await gapi.client.calendar.events.list({
                    calendarId: calendarId,
                    privateExtendedProperty: `taskflow_subtask_id=${subtask.id || `${parentTask.id}-${subtask.title}`}`
                });
                
                if (existingEvents.result.items.length > 0) {
                    const eventId = existingEvents.result.items[0].id;
                    await gapi.client.calendar.events.update({
                        calendarId: calendarId,
                        eventId: eventId,
                        resource: eventResource
                    });
                } else {
                    await gapi.client.calendar.events.insert({
                        calendarId: calendarId,
                        resource: eventResource
                    });
                }
            }
            
            // ãƒ‡ãƒ¼ã‚¿ç®¡ç†æ©Ÿèƒ½
            exportData() {
                const data = {
                    tasks: this.tasks,
                    clients: this.clients,
                    subtasks: this.subtasks,
                    timeLogs: this.timeLogs,
                    settings: this.settings,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `taskflow-export-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            importData(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        this.showImportOptions(data);
                    } catch (error) {
                        alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ­£ã—ã„JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    }
                };
                reader.readAsText(file);
                
                // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ
                event.target.value = '';
            }
            
            showImportOptions(importData) {
                // ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–¹å¼é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">
                            <i class="fas fa-upload mr-2 text-blue-600"></i>
                            ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–¹å¼ã‚’é¸æŠ
                        </h3>
                        
                        <div class="space-y-4 mb-6">
                            <div class="border border-gray-200 rounded-lg p-3">
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="import-mode" value="merge" class="mr-3" checked>
                                    <div>
                                        <div class="font-medium text-green-700">ğŸ“ˆ å·®åˆ†è¿½åŠ ï¼ˆæ¨å¥¨ï¼‰</div>
                                        <div class="text-sm text-gray-600">é‡è¤‡ã—ã¦ã„ãªã„æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã®ã¿è¿½åŠ </div>
                                    </div>
                                </label>
                            </div>
                            
                            <div class="border border-gray-200 rounded-lg p-3">
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="import-mode" value="replace" class="mr-3">
                                    <div>
                                        <div class="font-medium text-red-700">ğŸ”„ å®Œå…¨ç½®ãæ›ãˆ</div>
                                        <div class="text-sm text-gray-600">ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«ç½®ãæ›ãˆï¼ˆå¾“æ¥æ–¹å¼ï¼‰</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded p-3 mb-4">
                            <div class="text-sm text-blue-800">
                                <strong>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:</strong><br>
                                ã‚¿ã‚¹ã‚¯: ${importData.tasks?.length || 0}ä»¶ã€
                                é¡§å®¢: ${importData.clients?.length || 0}ä»¶ã€
                                ã‚µãƒ–ã‚¿ã‚¹ã‚¯: ${importData.subtasks?.length || 0}ä»¶
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button id="import-cancel-btn" 
                                    class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md">
                                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                            </button>
                            <button id="import-execute-btn" 
                                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                                å®Ÿè¡Œ
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ 
                modal.querySelector('#import-cancel-btn').addEventListener('click', () => {
                    modal.remove();
                });
                
                modal.querySelector('#import-execute-btn').addEventListener('click', () => {
                    const mode = modal.querySelector('input[name="import-mode"]:checked').value;
                    if (mode === 'merge') {
                        this.mergeImportData(importData);
                    } else {
                        this.replaceImportData(importData);
                    }
                    modal.remove();
                });
            }
            
            mergeImportData(importData) {
                let stats = {
                    tasksAdded: 0,
                    clientsAdded: 0,
                    subtasksAdded: 0,
                    timeLogsAdded: 0,
                    duplicatesSkipped: 0
                };
                
                // ã‚¿ã‚¹ã‚¯ã®å·®åˆ†è¿½åŠ 
                if (importData.tasks) {
                    importData.tasks.forEach(newTask => {
                        const exists = this.tasks.find(task => 
                            task.id === newTask.id || 
                            (task.title === newTask.title && task.deadline === newTask.deadline)
                        );
                        if (!exists) {
                            // æ–°ã—ã„IDã‚’ç”Ÿæˆï¼ˆæ—¢å­˜IDã¨ã®é‡è¤‡ã‚’é¿ã‘ã‚‹ï¼‰
                            if (!newTask.id || this.tasks.find(t => t.id === newTask.id)) {
                                newTask.id = 'task_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                            }
                            this.tasks.push(newTask);
                            stats.tasksAdded++;
                        } else {
                            stats.duplicatesSkipped++;
                        }
                    });
                }
                
                // é¡§å®¢ã®å·®åˆ†è¿½åŠ 
                if (importData.clients) {
                    importData.clients.forEach(newClient => {
                        const exists = this.clients.find(client => 
                            client.id === newClient.id || 
                            (client.name === newClient.name && client.company === newClient.company)
                        );
                        if (!exists) {
                            if (!newClient.id || this.clients.find(c => c.id === newClient.id)) {
                                newClient.id = 'client_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                            }
                            this.clients.push(newClient);
                            stats.clientsAdded++;
                        } else {
                            stats.duplicatesSkipped++;
                        }
                    });
                }
                
                // ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã®å·®åˆ†è¿½åŠ 
                if (importData.subtasks) {
                    importData.subtasks.forEach(newSubtask => {
                        const exists = this.subtasks.find(subtask => 
                            subtask.id === newSubtask.id ||
                            (subtask.parent_task_id === newSubtask.parent_task_id && subtask.title === newSubtask.title)
                        );
                        if (!exists) {
                            if (!newSubtask.id || this.subtasks.find(s => s.id === newSubtask.id)) {
                                newSubtask.id = 'subtask_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                            }
                            this.subtasks.push(newSubtask);
                            stats.subtasksAdded++;
                        } else {
                            stats.duplicatesSkipped++;
                        }
                    });
                }
                
                // æ™‚é–“ãƒ­ã‚°ã®å·®åˆ†è¿½åŠ 
                if (importData.timeLogs) {
                    importData.timeLogs.forEach(newLog => {
                        const exists = this.timeLogs.find(log => 
                            log.id === newLog.id ||
                            (log.task_id === newLog.task_id && log.start_time === newLog.start_time)
                        );
                        if (!exists) {
                            if (!newLog.id || this.timeLogs.find(l => l.id === newLog.id)) {
                                newLog.id = 'timelog_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                            }
                            this.timeLogs.push(newLog);
                            stats.timeLogsAdded++;
                        } else {
                            stats.duplicatesSkipped++;
                        }
                    });
                }
                
                // è¨­å®šã¯é‡è¤‡ãƒã‚§ãƒƒã‚¯ã›ãšãƒãƒ¼ã‚¸
                if (importData.settings) {
                    this.settings = { ...this.settings, ...importData.settings };
                }
                
                this.saveData();
                this.loadSettings();
                this.renderTasks();
                this.renderClients();
                
                // è©³ç´°ãªçµæœè¡¨ç¤º
                const message = `ğŸ“ˆ å·®åˆ†ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼

âœ… è¿½åŠ ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿:
â€¢ ã‚¿ã‚¹ã‚¯: ${stats.tasksAdded}ä»¶
â€¢ é¡§å®¢: ${stats.clientsAdded}ä»¶  
â€¢ ã‚µãƒ–ã‚¿ã‚¹ã‚¯: ${stats.subtasksAdded}ä»¶
â€¢ æ™‚é–“ãƒ­ã‚°: ${stats.timeLogsAdded}ä»¶

â­ï¸ ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé‡è¤‡ï¼‰: ${stats.duplicatesSkipped}ä»¶`;
                
                alert(message);
                console.log('ğŸ“Š ã‚¤ãƒ³ãƒãƒ¼ãƒˆçµ±è¨ˆ:', stats);
            }
            
            replaceImportData(importData) {
                if (!confirm('ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«ç½®ãæ›ãˆã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
                    return;
                }
                
                this.tasks = importData.tasks || [];
                this.clients = importData.clients || [];
                this.subtasks = importData.subtasks || [];
                this.timeLogs = importData.timeLogs || [];
                this.settings = importData.settings || {};
                
                this.saveData();
                this.loadSettings();
                this.renderTasks();
                this.renderClients();
                
                alert('ãƒ‡ãƒ¼ã‚¿ã®å®Œå…¨ç½®ãæ›ãˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚');
            }
            
            clearAllData() {
                if (confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
                    if (confirm('æœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                        this.tasks = [];
                        this.clients = [];
                        this.subtasks = [];
                        this.timeLogs = [];
                        this.settings = {};
                        
                        localStorage.removeItem('taskflow_tasks');
                        localStorage.removeItem('taskflow_clients');
                        localStorage.removeItem('taskflow_subtasks');
                        localStorage.removeItem('taskflow_time_logs');
                        localStorage.removeItem('taskflow_settings');
                        
                        this.renderTasks();
                        this.loadSettings();
                        
                        alert('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚');
                    }
                }
            }
        }
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        window.app = new TaskFlowApp();
    </script>
</body>
</html>